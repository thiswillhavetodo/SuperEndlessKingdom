var wallEdgeArray=[0,1,2,3,4],wallArray=[1,3,4,6,7,8,9,10,11,12,13,14,15,16,17,19,20,21,22,23,24],torchArray=[1,3,9,13,17,19],barriers,targets,lights,soundTriggers,tutorialPractice="first",tutorialPracticeSprite,tutorialPracticeSpeechBubble,tutorialPracticeText="",tutorialPracticeText2="",tutorialPracticeText3="",tutorialPracticeText4="",tutorialPracticeText5="",tutorialPracticeText6="",trainerSpeechBubble,trainerText="",trainerText2="",trainerText3="",trainerText4="",trainerText5="",trainerText6="",nextPractice="right",tutorialMusic,tutorialMusicPlaying,successSFX,tutorialState={create:function(){game.add.sprite(0,0,"tutorialBackground"),game.physics.startSystem(Phaser.Physics.ARCADE),1!=tutorialMusicPlaying&&(tutorialMusic=game.add.audio("tutorialMusic"),tutorialMusic.allowMultiple=!1,tutorialMusic.play(),tutorialMusicPlaying=!0),player=game.add.sprite(224,126,"dude"),successSFX=game.add.audio("collect"),game.physics.arcade.enable(player),player.body.setSize(26,30,3,3),player.body.collideWorldBounds=!0,player.isAlive=!0,player.animations.add("left",[9,10,11],10,!0),player.animations.add("right",[3,4,5],10,!0),player.animations.add("up",[0,1,2],10,!0),player.animations.add("down",[6,7,8],10,!0),player.animations.add("stop",[4],10,!0),player.animations.play("stop"),bullets=game.add.group(),bullets.enableBody=!0,barriers=game.add.group(),barriers.enableBody=!0,targets=game.add.group(),targets.enableBody=!0,soundTriggers=game.add.group(),soundTriggers.enableBody=!0,lights=game.add.group();for(var e=0;e<wallEdgeArray.length;e++){var t=barriers.create(128,32*wallEdgeArray[e],"tutorialBarriers32x32");t.frame=4,t.body.immovable=!0;var a=barriers.create(352,32*wallEdgeArray[e],"tutorialBarriers32x32");a.frame=5,a.body.immovable=!0}for(var e=0;e<wallArray.length;e++){var r=barriers.create(32*wallArray[e],160,"tutorialBarriers32x32");r.frame=0,r.body.immovable=!0,e>2&&e<7&&(r=barriers.create(32*wallArray[e],96,"tutorialBarriers32x32"),r.frame=0,r.body.immovable=!0,r=barriers.create(32*wallArray[e],0,"tutorialBarriers32x32"),r.frame=0,r.body.immovable=!0)}r=barriers.create(160,0,"tutorialBarriers32x32"),r.frame=0,r.body.immovable=!0,r=barriers.create(320,0,"tutorialBarriers32x32"),r.frame=0,r.body.immovable=!0;var i=barriers.create(288,64,"tutorialBarriers32x32");i.frame=2,i.body.immovable=!0;var o=barriers.create(192,64,"tutorialBarriers32x32");o.frame=3,o.body.immovable=!0,o=barriers.create(224,64,"tutorialBarriers32x32"),o.frame=3,o.body.immovable=!0,o=barriers.create(256,64,"tutorialBarriers32x32"),o.frame=3,o.body.immovable=!0;var l=barriers.create(0,160,"tutorialBarriers32x32");l.frame=6,l.body.immovable=!0,l=barriers.create(790,160,"tutorialBarriers32x32"),l.frame=6,l.body.immovable=!0;var s=barriers.create(64,160,"tutorialBarriers32x32");s.frame=1,s.body.immovable=!0,s=barriers.create(576,160,"tutorialBarriers32x32"),s.frame=1,s.body.immovable=!0;var n=barriers.create(192,116,"tutorialObstacles32x44");n.frame=0,n.body.immovable=!0;var c=soundTriggers.create(320,128,"tutorialBarriers32x32");c.visible=!1,c=soundTriggers.create(320,32,"tutorialBarriers32x32"),c.visible=!1,c=soundTriggers.create(160,32,"tutorialBarriers32x32"),c.visible=!1,c=soundTriggers.create(160,192,"tutorialBarriers32x32"),c.visible=!1;var d=targets.create(64,352,"tutorialObstacles32x44");d.frame=1,d.body.immovable=!0,d=targets.create(64,446,"tutorialObstacles32x44"),d.frame=1,d.body.immovable=!0,d=targets.create(288,256,"tutorialObstacles32x44"),d.frame=1,d.body.immovable=!0,d=targets.create(288,544,"tutorialObstacles32x44"),d.frame=1,d.body.immovable=!0,d=targets.create(512,256,"tutorialObstacles32x44"),d.frame=1,d.body.immovable=!0,d=targets.create(512,544,"tutorialObstacles32x44"),d.frame=1,d.body.immovable=!0,d=targets.create(768,352,"tutorialObstacles32x44"),d.frame=1,d.body.immovable=!0,d=targets.create(768,446,"tutorialObstacles32x44"),d.frame=1,d.body.immovable=!0;var x=game.add.sprite(196,2,"tutorialDecorations36x32");x.frame=1,x=game.add.sprite(352,162,"tutorialDecorations36x32"),x.frame=1,x=game.add.sprite(672,162,"tutorialDecorations36x32"),x.frame=1;var u=game.add.sprite(286,2,"tutorialDecorations36x32");u.frame=0,u=game.add.sprite(224,162,"tutorialDecorations36x32"),u.frame=0,u=game.add.sprite(478,162,"tutorialDecorations36x32"),u.frame=0,u=game.add.sprite(734,162,"tutorialDecorations36x32"),u.frame=0;for(var e=0;e<torchArray.length;e++)this.torchCreate(32*torchArray[e],160,"centre");this.trainerText(),this.tutorialPracticeText(),this.torchCreate(-4,288,"left"),this.torchCreate(-4,544,"left"),this.torchCreate(799,288,"right"),this.torchCreate(799,544,"right"),cursors=game.input.keyboard.createCursorKeys(),spaceBar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=game.input.keyboard.addKey(Phaser.Keyboard.D)},update:function(){player.body.velocity.x=0,player.body.velocity.y=0,game.physics.arcade.collide(player,barriers),game.physics.arcade.overlap(player,soundTriggers,this.triggerSound,null,this),game.physics.arcade.collide(bullets,targets,this.targetKill,null,this),game.physics.arcade.collide(bullets,barriers,this.bulletKill,null,this),game.physics.arcade.collide(player,door,this.endTutorial,null,this),"first"!=tutorialPractice&&(aKey.isDown?(player.body.velocity.x=-runSpeed,player.animations.play("left"),facing="left"):dKey.isDown?(player.body.velocity.x=runSpeed,player.animations.play("right"),facing="right"):wKey.isDown?(player.body.velocity.y=-runSpeed,player.animations.play("up"),facing="up"):sKey.isDown?(player.body.velocity.y=runSpeed,player.animations.play("down"),facing="down"):player.animations.stop(),(cursors.right.isDown||cursors.left.isDown||cursors.up.isDown||cursors.down.isDown)&&game.time.now>bulletTimer&&player.isAlive&&mana>=5&&this.fire()),spaceBar.isDown&&""!=tutorialPractice&&game.time.now>assistantChangeTimer&&(this.tutorialChange(),assistantChangeTimer=game.time.now+1e3),this.torchUpdate(),this.tutorialShow(),this.trainerPlayerPositionCheck()},trainerText:function(){game.add.sprite(775,165,"trainerSprite"),trainerSpeechBubble=game.add.sprite(-580,35,"speechBubble"),trainerText=game.add.bitmapText(630,45,"fontBorder","",15),trainerText2=game.add.bitmapText(600,60,"fontBorder","",15),trainerText3=game.add.bitmapText(588,75,"fontBorder","",15),trainerText4=game.add.bitmapText(588,90,"fontBorder","",15),trainerText5=game.add.bitmapText(600,105,"fontBorder","",15),trainerText6=game.add.bitmapText(620,120,"fontBorder","",15),trainerText.tint=0,trainerText2.tint=0,trainerText3.tint=0,trainerText4.tint=0,trainerText5.tint=0,trainerText6.tint=0},trainerTextDestroy:function(){trainerText.destroy(),trainerText2.destroy(),trainerText3.destroy(),trainerText4.destroy(),trainerText5.destroy(),trainerText6.destroy()},tutorialPracticeText:function(){tutorialPracticeSpeechBubble=game.add.button(-200,410,"speechBubble",this.tutorialChange,this),tutorialPracticeText=game.add.bitmapText(450,418,"fontBorder","",15),tutorialPracticeText2=game.add.bitmapText(420,435,"fontBorder","",15),tutorialPracticeText3=game.add.bitmapText(408,450,"fontBorder","",15),tutorialPracticeText4=game.add.bitmapText(408,465,"fontBorder","",15),tutorialPracticeText5=game.add.bitmapText(420,480,"fontBorder","",15),tutorialPracticeText6=game.add.bitmapText(440,495,"fontBorder","",15),tutorialPracticeText.tint=0,tutorialPracticeText2.tint=0,tutorialPracticeText3.tint=0,tutorialPracticeText4.tint=0,tutorialPracticeText5.tint=0,tutorialPracticeText6.tint=0},bulletKill:function(e){e.kill()},targetKill:function(e,t){t.isDead?e.kill():(this.smallExplosion(e.x,e.y),e.kill(),t.isDead=!0,player.x<t.x?(t.x+=44,t.y+=12,t.rotation=1.57):(t.x-=12,t.y+=44,t.rotation=-1.57),xp+=1,this.checkLevelUp(),this.checkTutorialComplete())},checkLevelUp:function(){for(;xp>=nextLevelXp;){levelUpImage=game.add.sprite(132,15,"levelUp"),levelUpImage.animations.add("flash",[0,1,2],6,!0),levelUpImage.animations.play("flash");var e=game.add.audio("levelUpSound");e.play(),game.time.events.add(1*Phaser.Timer.SECOND,function(){levelUpImage.kill()}),xp-=nextLevelXp,nextLevelXp+=Math.round(9+playerLevel/2),maxHealth++,maxMana+=2,shotPower+=.05,health=maxHealth,mana=maxMana,playerLevel++}},checkTutorialComplete:function(){xp>=8&&(xp+=5,this.checkLevelUp(),tutorialPractice="second",nextPractice="",player.x<416?(doorway=game.add.sprite(512,352,"doorway"),door=game.add.sprite(512,352,"animateddoor")):(doorway=game.add.sprite(288,352,"doorway"),door=game.add.sprite(288,352,"animateddoor")),door.animations.add("openDoor",[0,1,2,3],4,!1),game.physics.arcade.enable(door),door.body.immovable=!0)},endTutorial:function(){tutorialMusicPlaying=!1,tutorialMusic.destroy(),door.animations.play("openDoor");var e=game.add.audio("creakylightwoodendoor1");e.play(),player.kill(),game.time.events.add(2*Phaser.Timer.SECOND,function(){game.state.start("defence")})},smallExplosion:function(e,t){var a=game.add.sprite(e,t,"explosionMini");a.animations.add("explosion",[0,1,2,3],30,!1),a.animations.play("explosion"),this.shortExplodeSFX(),game.time.events.add(.2*Phaser.Timer.SECOND,function(){a.destroy()})},fire:function(){var e=bullets.create(player.x+10,player.y+15,"bullet");e.animations.add("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],26,!0);var t=game.add.emitter(game.world.centerX,game.world.centerY,20);t.makeParticles("bulletParticles",[0,1,2,3]),t.gravity.y=0,t.forEach(function(e){e.body.allowGravity=!1},this),t.start(!1,500,50),e.addChild(t),t.y=0,t.x=0,t.lifespan=500,e.scale.x=.8,e.scale.y=.8,cursors.left.isDown?(game.physics.arcade.moveToXY(e,0,e.y,shotSpeed),e.animations.play("spin"),e.travel="left",t.minParticleSpeed.set(-shotSpeed,0),t.maxParticleSpeed.set(-shotSpeed,0),t.rotation=3.14,t.x=-14,t.y=-8):cursors.right.isDown?(game.physics.arcade.moveToXY(e,832,e.y,shotSpeed),e.animations.play("spin"),e.travel="right",t.minParticleSpeed.set(shotSpeed,0),t.maxParticleSpeed.set(shotSpeed,0),t.rotation=3.14,t.x=14,t.y=-8):cursors.up.isDown?(game.physics.arcade.moveToXY(e,e.x,0,shotSpeed),e.animations.play("spin"),e.travel="up",t.minParticleSpeed.set(0,-shotSpeed),t.maxParticleSpeed.set(0,-shotSpeed),t.rotation=3.14,t.x=-8,t.y=-14):cursors.down.isDown&&(game.physics.arcade.moveToXY(e,e.x,600,shotSpeed),e.animations.play("spin"),e.travel="down",t.minParticleSpeed.set(0,shotSpeed),t.maxParticleSpeed.set(0,shotSpeed),t.rotation=3.14,t.x=-8,t.y=14),this.pew(),bulletTimer=game.time.now+bulletSpacing},pew:function(){var e=game.add.audio("pew");e.play()},shortExplodeSFX:function(){var e=game.add.audio("shortExplode");e.play()},torchCreate:function(e,t,a){var r=lights.create(e,t,"tutorialDecorations36x32");r.animations.add("centre",[2,3],10,!0),r.animations.add("left",[4,5],10,!0),r.animations.add("right",[6,7],10,!0),"centre"==a?r.direction="centre":"left"==a?r.direction="left":"right"==a&&(r.direction="right")},torchUpdate:function(){lights.forEach(function(e){"centre"==e.direction?e.animations.play("centre"):"left"==e.direction?e.animations.play("left"):"right"==e.direction&&e.animations.play("right")})},tutorialShow:function(){switch(tutorialPractice){case"first":tutorialPracticeSprite=game.add.sprite(550,469,"assistant"),tutorialPracticeSpeechBubble.x=400,tutorialPracticeText.text="  Your Majesty!",tutorialPracticeText2.text=" The Royal Trainer feels",tutorialPracticeText3.text=" of late you have neglected ",tutorialPracticeText4.text=" your training and insists on",tutorialPracticeText5.text=" a refresher before you",tutorialPracticeText6.text="   join the battle.";break;case"second":tutorialPracticeSprite=game.add.sprite(550,469,"assistant"),tutorialPracticeSpeechBubble.x=400,tutorialPracticeText.text="  Excellent,  ",tutorialPracticeText2.text="  Your Majesty. Use the ",tutorialPracticeText3.text="  door when you're ready to",tutorialPracticeText4.text="  lead your troops. Your",tutorialPracticeText5.text="   soldiers await you at",tutorialPracticeText6.text="  the city's edge.";break;case"":tutorialPracticeSprite.destroy(),tutorialPracticeText.text="",tutorialPracticeText2.text="",tutorialPracticeText3.text="",tutorialPracticeText4.text="",tutorialPracticeText5.text="",tutorialPracticeText6.text=""}},tutorialChange:function(){switch(tutorialPractice){case"first":tutorialPractice="trainer",tutorialPracticeSprite.kill(),tutorialPracticeSpeechBubble.kill(),this.tutorialShow(),this.create();break;case"second":tutorialPractice="",tutorialPracticeSprite.kill(),tutorialPracticeSpeechBubble.kill(),this.tutorialShow()}},trainerPlayerPositionCheck:function(){"trainer"==tutorialPractice?(tutorialPractice="",this.trainerUpdate()):player.x>=288&&"right"==nextPractice?(nextPractice="up",this.trainerUpdate()):"up"==nextPractice&&player.y<=32?(nextPractice="left",this.trainerUpdate()):"left"==nextPractice&&player.x<=160?(nextPractice="down",this.trainerUpdate()):"down"==nextPractice&&player.y>=192?(nextPractice="shoot",this.trainerUpdate()):""==nextPractice&&(this.trainerUpdate(),nextPractice="done")},triggerSound:function(e,t){t.kill(),successSFX.play()},trainerUpdate:function(){"right"==nextPractice&&""==tutorialPractice?(trainerSpeechBubble.x=580,trainerText.text=" Your Majesty!",trainerText2.text="   It's been too long.",trainerText3.text="      Let us start with a",trainerText4.text="     review of the basics.",trainerText5.text="    Use the 'D' key to",trainerText6.text="      walk right."):"up"==nextPractice?(this.trainerTextDestroy(),this.trainerText(),trainerText.text="  Excellent!",trainerText2.text="     Now use the 'W' ",trainerText3.text="         key to walk up.",trainerText4.text=" ",trainerText5.text=" ",trainerText6.text=" "):"left"==nextPractice?(trainerText4.text="         And now the 'A'",trainerText5.text="      key to walk left.",trainerText6.text=" "):"down"==nextPractice?(this.trainerTextDestroy(),this.trainerText(),trainerText.text="  Jolly good!",trainerText2.text="    Finally use the 'S'",trainerText3.text="     key to walk down to",trainerText4.text="      the target room for",trainerText5.text="        some shooting",trainerText6.text="        practice."):"shoot"==nextPractice&&""==tutorialPractice?(this.trainerTextDestroy(),this.trainerText(),trainerText.text="  Wonderful!",trainerText2.text="    Now use the four ",trainerText3.text="   arrow keys to shoot in ",trainerText4.text=" each direction. See if you",trainerText5.text="  can hit all eight suits",trainerText6.text="     of armour."):""==nextPractice&&(this.trainerTextDestroy(),this.trainerText(),trainerText.text=" ",trainerText2.text=" ",trainerText3.text="          My work here",trainerText4.text="              is done.",trainerText5.text=" ",trainerText6.text=" ")}};