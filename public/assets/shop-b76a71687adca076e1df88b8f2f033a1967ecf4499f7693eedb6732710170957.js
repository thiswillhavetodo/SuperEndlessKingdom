var shop,close,closeText,shopPopText,shopCoinsText,shopMessageBackground,shopMessageText,taxHolder,taxLevelText,taxPlusButton,taxMinusButton,housingHolder,housingLevelText,housingFunding=40,housingPlusButton,housingMinusButton,commercialHolder,commercialLevelText,commercialFunding=40,commercialPlusButton,commercialMinusButton,industrialHolder,industrialLevelText,industrialFunding=40,industrialPlusButton,industrialMinusButton,educationHolder,educationLevelText,educationFunding=40,educationPlusButton,educationMinusButton,healthHolder,healthLevelText,healthFunding=40,healthPlusButton,healthMinusButton,justiceHolder,justiceLevelText,justiceFunding=40,justicePlusButton,justiceMinusButton,defenceHolder,defenceLevelText,defenceFunding=40,defencePlusButton,defenceMinusButton,utilitiesHolder,utilitiesLevelText,utilitiesFunding=40,utilitiesPlusButton,utilitiesMinusButton,weaponsmithHolder,weaponsmithLevelText,weaponsmithFunding=40,weaponsmithPlusButton,weaponsmithMinusButton,armourerHolder,armourerLevelText,armourerFunding=40,armourerPlusButton,armourerMinusButton,enchanterHolder,enchanterLevelText,enchanterFunding=40,enchanterPlusButton,enchanterMinusButton,trainerHolder,trainerLevelText,trainerFunding=40,trainerPlusButton,trainerMinusButton,averageFunding=40,baseChance,weaponsmithDropReward=0,weaponsmithDRBoost=1,weaponsmithTimer=0,weaponsmithAdTimer=0,wandTimer=0,wandImage,wandPerkButton,wandPerkText,wandPerkText2,wandShotPower=0,wandShotPowerUpgrade,wandShotSpeed=0,wandShotSpeedUpgrade,wandBulletSpacing=0,wandBulletSpacingUpgrade,shieldTimer=0,shieldImage,shieldPerkButton,shieldPerkText,shieldPerkText2,shieldKnockback=0,shieldKnockbackUpgrade,shieldMaxHealth=0,shieldMaxHealthUpgrade,shieldInvulnerableSpacing=0,shieldInvulnerableSpacingUpgrade,armourerDropReward=0,armourerDRBoost=1,armourerTimer=0,armourerAdTimer=0,armourTimer=0,armourImage,armourPerkButton,armourPerkText,armourPerkText2,armourMaxHealth=0,armourMaxHealthUpgrade,armourManaRegenInterval=0,armourManaRegenIntervalUpgrade,armourInvulnerableSpacing=0,armourInvulnerableSpacingUpgrade,hatTimer=0,hatImage,hatPerkButton,hatPerkText,hatPerkText2,hatMaxHealth=0,hatMaxHealthUpgrade,hatManaRegenInterval=0,hatManaRegenIntervalUpgrade,hatMaxMana=0,hatMaxManaUpgrade,bootTimer=0,bootImage,bootPerkButton,bootPerkText,bootPerkText2,bootRunSpeed=0,bootRunSpeedUpgrade,bootManaRegenInterval=0,bootManaRegenIntervalUpgrade,bootInvulnerableSpacing=0,bootInvulnerableSpacingUpgrade,enchanterDropReward=0,enchanterDRBoost=1,enchanterTimer=0,enchanterAdTimer=0,ringTimer=0,ringImage,ringPerkButton,ringPerkText,ringPerkText2,ringShotPower=0,ringShotPowerUpgrade,ringMaxMana=0,ringMaxManaUpgrade,ringKnockback=0,ringKnockbackUpgrade,amuletTimer=0,amuletImage,amuletPerkButton,amuletPerkText,amuletPerkText2,amuletRunSpeed=0,amuletRunSpeedUpgrade,amuletShotSpeed=0,amuletShotSpeedUpgrade,amuletBulletSpacing=0,amuletBulletSpacingUpgrade,trainerDropReward=0,trainerDRBoost=1,trainerTimer=0,trainerAdTimer=0,skillTimer=0,skillImage,skillPerkButton,skillPerkText,skillPerkText2,skillShotPower=0,skillShotPowerUpgrade,skillMaxMana=0,skillMaxManaUpgrade,skillKnockback=0,skillKnockbackUpgrade,enduranceTimer=0,enduranceImage,endurancePerkButton,endurancePerkText,endurancePerkText2,enduranceRunSpeed=0,enduranceRunSpeedUpgrade,enduranceShotSpeed=0,enduranceShotSpeedUpgrade,enduranceBulletSpacing=0,enduranceBulletSpacingUpgrade,maxFunding=!1,wellfunded=!1,priorityService=!0,shopSpeechBubble,shopText="",shopText2="",shopText3="",shopText4="",shopText5="",shopText6="",efffectivenessScoreBackground,efffectivenessScoreText,nextHousing,nextCommercial,nextIndustrial,nextEducation,nextPopHealth,nextJustice,nextDefence,nextUtilities,nextWeaponsmith,nextArmourer,nextEnchanter,nextTrainer,nextPopulation,nextCoins,nextHappiness,nextEconomyMod,nextIncome,nextExpenditure,nextNetIncome,nextYearStatText,nextPopulationStatText,nextIncomeStatText,nextExpenditureStatText,nextNetIncomeStatText,nextBalanceStatText,nextYear,weaponsmithUpgradeText,weaponsmithUpgradeCost=200,armourerUpgradeText,armourerUpgradeCost=200,enchanterUpgradeText,enchanterUpgradeCost=200,trainerUpgradeText,trainerUpgradeCost=200,advert=!1,advertImage,adStopTime,adTimeText,adCloseButton,addStartButton,addStartText,addRejectButton,addRejectText,bonusType="",beamUnlockShown=!1,manaRefillUnlockShown=!1,spaceBar,weaponsmithSkillLevelText,wandPowerText,wandShotSpeedText,wandAttackSpeedText,shieldKnockbackText,shieldHealthText,shieldInvulnerableText,armourerSkillLevelText,armourHealthBonusText,armourManaRegenBonus,armourInvulnerableText,crownHealthText,crownManaRegenText,crownManaText,bootsRunSpeedText,bootManaRegenText,bootsInvulnerableText,enchanterSkillLevelText,ringPowerText,ringManaText,ringKnockbackText,amuletRunSpeedText,amuletShotSpeedText,amuletAttackSpeedText,trainerSkillLevelText,skillPowerText,skillManaText,skillKnockbackText,staminaRunSpeedText,staminaShotSpeedText,staminaAttackSpeedText,increaseSFX,reduceSFX,slotMachineSFX,shopState={create:function(){switch(advert=!1,wellfunded=!1,game.world.removeAll(),increaseSFX=game.add.audio("collect"),reduceSFX=game.add.audio("reduce"),slotMachineSFX=game.add.audio("slotMachine"),game.add.sprite(0,0,"shopBackground"),close=game.add.button(607,565,"blankButton",this.shopClose,this),closeText=game.add.bitmapText(657,595,"font","Return to Town",18),popDisplay=game.add.sprite(130,6,"townWoman"),popDisplay.frame=7,shopPopText=game.add.bitmapText(170,10,"font",population,26),coinDisplay=game.add.sprite(510,8,"coin"),coinDisplay.frame=0,shopCoinsText=game.add.bitmapText(550,10,"font",coins,26),shopMessageBackground=game.add.sprite(-1e3,357,"dialog_box_thin"),shopMessageText=game.add.bitmapText(200,375,"font","",18),game.add.button(0,250,"leftArrow",this.shopLeft,this),game.add.button(755,250,"rightArrow",this.shopRight,this),shopSpeechBubble=game.add.sprite(180,35,"speechBubble"),shopText=game.add.bitmapText(230,45,"fontBorder","",15),shopText2=game.add.bitmapText(200,60,"fontBorder","",15),shopText3=game.add.bitmapText(188,75,"fontBorder","",15),shopText4=game.add.bitmapText(188,90,"fontBorder","",15),shopText5=game.add.bitmapText(200,105,"fontBorder","",15),shopText6=game.add.bitmapText(220,120,"fontBorder","",15),shopText.tint=0,shopText2.tint=0,shopText3.tint=0,shopText4.tint=0,shopText5.tint=0,shopText6.tint=0,efffectivenessScoreBackground=game.add.sprite(500,60,"dbox_thinShort"),efffectivenessScoreText=game.add.bitmapText(515,75,"font","",17),this.dropRewardDiminishingReturns(),spaceBar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),shop){case"castle":taxHolder=game.add.sprite(305,250,"blankButton"),taxLevelText=game.add.bitmapText(360,278,"font","Tax Level: "+tax,20),taxPlusButton=game.add.button(530,250,"plusButton",this.taxPlus,this),taxMinusButton=game.add.button(225,250,"minusButton",this.taxMinus,this),priorityService=!1,efffectivenessScoreText.text="     Approval Rating: "+Math.round((housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12),happiness>1.65*tax+10?(shopText.text=" Your Majesty!",shopText2.text="  I believe the people",shopText3.text="      would be willing to",shopText4.text="  pay higher taxes to help",shopText5.text="       fund our vital",shopText6.text="      services."):happiness<=tax+5?(shopText.text=" Your Majesty!",shopText2.text="Your people are troubled.",shopText3.text="    I'm sure they would",shopText4.text=" welcome a cut in taxes if",shopText5.text="    you feel the treasury",shopText6.text="    can afford it."):(shopText.text=" Your Majesty!",shopText2.text="  The general feeling",shopText3.text="   among your people is",shopText4.text="         that the level of ",shopText5.text="       taxation is just ",shopText6.text="    about right."),game.add.sprite(150,340,"scrollBox"),game.add.bitmapText(180,350,"font","Last Year",18);game.add.bitmapText(165,385,"font","Year: "+(year-1),14),game.add.bitmapText(165,400,"font","Population: "+previousPopulation,14),game.add.bitmapText(165,415,"font","Income: "+Math.round(previousIncome),14),game.add.bitmapText(165,430,"font","Expenditure: "+Math.round(previousExpenditure),14),game.add.bitmapText(165,445,"font","Net Income: "+Math.round(previousNetIncome),14),game.add.bitmapText(165,460,"font","Balance: "+previousCoins,14);game.add.sprite(350,340,"scrollBox"),game.add.bitmapText(380,350,"font","This Year",18);game.add.bitmapText(365,385,"font","Year: "+year,14),game.add.bitmapText(365,400,"font","Population: "+population,14),game.add.bitmapText(365,415,"font","Income: "+Math.round(income),14),game.add.bitmapText(365,430,"font","Expenditure: "+Math.round(expenditure),14),game.add.bitmapText(365,445,"font","Net Income: "+Math.round(netIncome),14),game.add.bitmapText(365,460,"font","Balance: "+coins,14);game.add.sprite(550,340,"scrollBox"),game.add.bitmapText(580,350,"font","Next Year",18),nextYearStatText=game.add.bitmapText(565,385,"font","Year: "+(year+1),14),nextPopulationStatText=game.add.bitmapText(565,400,"font","Population: "+nextPopulation,14),nextIncomeStatText=game.add.bitmapText(565,415,"font","Income: "+Math.round(nextIncome),14),nextExpenditureStatText=game.add.bitmapText(565,430,"font","Expenditure: "+Math.round(nextExpenditure),14),nextNetIncomeStatText=game.add.bitmapText(565,445,"font","Net Income: "+Math.round(nextNetIncome),14),nextBalanceStatText=game.add.bitmapText(565,460,"font","Balance: "+nextCoins,14),this.nextYearEstimate();break;case"housing":housingHolder=game.add.sprite(305,250,"blankButton"),housingLevelText=game.add.bitmapText(325,280,"font","   Homestead Fund: "+housingFunding,16),housingPlusButton=game.add.button(530,250,"plusButton",this.housingPlus,this),housingMinusButton=game.add.button(225,250,"minusButton",this.housingMinus,this),maxFunding=!(housingFunding<100),wellfunded=housingFunding>=averageFunding+1,priorityService=!1,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(housing);break;case"commercial":commercialHolder=game.add.sprite(305,250,"blankButton"),commercialLevelText=game.add.bitmapText(325,280,"font","   City Market Fund: "+commercialFunding,16),commercialPlusButton=game.add.button(530,250,"plusButton",this.commercialPlus,this),commercialMinusButton=game.add.button(225,250,"minusButton",this.commercialMinus,this),maxFunding=!(commercialFunding<100),wellfunded=commercialFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(commercial);break;case"industrial":industrialHolder=game.add.sprite(305,250,"blankButton"),industrialLevelText=game.add.bitmapText(325,280,"font","    Farmland Fund: "+industrialFunding,16),industrialPlusButton=game.add.button(530,250,"plusButton",this.industrialPlus,this),industrialMinusButton=game.add.button(225,250,"minusButton",this.industrialMinus,this),maxFunding=!(industrialFunding<100),wellfunded=industrialFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(industrial);break;case"education":educationHolder=game.add.sprite(305,250,"blankButton"),educationLevelText=game.add.bitmapText(325,280,"font","      School Fund: "+educationFunding,16),educationPlusButton=game.add.button(530,250,"plusButton",this.educationPlus,this),educationMinusButton=game.add.button(225,250,"minusButton",this.educationMinus,this),maxFunding=!(educationFunding<100),wellfunded=educationFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(education);break;case"health":healthHolder=game.add.sprite(305,250,"blankButton"),healthLevelText=game.add.bitmapText(325,280,"font","     Hospital Fund: "+healthFunding,16),healthPlusButton=game.add.button(530,250,"plusButton",this.healthPlus,this),healthMinusButton=game.add.button(225,250,"minusButton",this.healthMinus,this),maxFunding=!(healthFunding<100),wellfunded=healthFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(popHealth);break;case"justice":justiceHolder=game.add.sprite(305,250,"blankButton"),justiceLevelText=game.add.bitmapText(325,280,"font","       Police Fund: "+justiceFunding,16),justicePlusButton=game.add.button(530,250,"plusButton",this.justicePlus,this),justiceMinusButton=game.add.button(225,250,"minusButton",this.justiceMinus,this),maxFunding=!(justiceFunding<100),wellfunded=justiceFunding>=averageFunding+1,priorityService=!1,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(justice);break;case"defence":defenceHolder=game.add.sprite(305,250,"blankButton"),defenceLevelText=game.add.bitmapText(325,280,"font","     Defence Fund: "+defenceFunding,16),defencePlusButton=game.add.button(530,250,"plusButton",this.defencePlus,this),defenceMinusButton=game.add.button(225,250,"minusButton",this.defenceMinus,this),maxFunding=!(defenceFunding<100),wellfunded=defenceFunding>=happiness,priorityService=!0,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(defence);break;case"utilities":utilitiesHolder=game.add.sprite(305,250,"blankButton"),utilitiesLevelText=game.add.bitmapText(325,280,"font","      Sewers Fund: "+utilitiesFunding,16),utilitiesPlusButton=game.add.button(530,250,"plusButton",this.utilitiesPlus,this),utilitiesMinusButton=game.add.button(225,250,"minusButton",this.utilitiesMinus,this),maxFunding=!(utilitiesFunding<100),wellfunded=utilitiesFunding>=averageFunding+1,priorityService=!1,efffectivenessScoreText.text="Department Effectiveness: "+Math.round(utilities);break;case"weaponsmith":weaponsmithHolder=game.add.sprite(129,175,"blankButton"),weaponsmithLevelText=game.add.bitmapText(149,205,"font"," Weaponsmith Fund: "+weaponsmithFunding,16),weaponsmithPlusButton=game.add.button(354,175,"plusButton",this.weaponsmithPlus,this),weaponsmithMinusButton=game.add.button(49,175,"minusButton",this.weaponsmithMinus,this),game.add.sprite(310,410,"ui_213x150"),weaponsmithSkillLevelText=game.add.bitmapText(317,425,"font","Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,14),wandPowerText=game.add.bitmapText(317,450,"font","Wand Power Bonus: "+wandShotPower,14),wandShotSpeedText=game.add.bitmapText(317,465,"font","Wand Shot Speed Bonus: "+wandShotSpeed,14),wandAttackSpeedText=game.add.bitmapText(317,480,"font","Wand Attack Speed Bonus: "+wandBulletSpacing,14),shieldKnockbackText=game.add.bitmapText(317,500,"font","Shield Knockback Bonus: "+shieldKnockback,14),shieldHealthText=game.add.bitmapText(317,515,"font","Shield Health Bonus: "+shieldMaxHealth,14),shieldInvulnerableText=game.add.bitmapText(317,530,"font","Shield Invulnerable Bonus: "+shieldInvulnerableSpacing,14),game.add.sprite(483,175,"blankButton"),weaponsmithUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+weaponsmithUpgradeCost,16),weaponsmithUpgradeCost>=1e6?weaponsmithUpgradeText.text=" Buy Skill Material: "+Math.round(weaponsmithUpgradeCost/1e5)/10+"M":weaponsmithUpgradeText.text=" Buy Skill Material: "+weaponsmithUpgradeCost,game.add.button(708,175,"plusButton",this.weaponsmithUpgrade,this),maxFunding=!(weaponsmithFunding<100),wellfunded=weaponsmithFunding>=averageFunding+1,priorityService=!1,this.weaponsmithImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(weaponsmith),population>111&&weaponsmithTimer>game.time.now&&weaponsmithAdTimer<game.time.now&&(advert=!0);break;case"armourer":armourerHolder=game.add.sprite(129,175,"blankButton"),armourerLevelText=game.add.bitmapText(145,205,"font","     Armourer Fund: "+armourerFunding,16),armourerPlusButton=game.add.button(354,175,"plusButton",this.armourerPlus,this),armourerMinusButton=game.add.button(49,175,"minusButton",this.armourerMinus,this),game.add.sprite(310,410,"ui_213x220"),armourerSkillLevelText=game.add.bitmapText(317,425,"font","Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,14),armourHealthBonusText=game.add.bitmapText(317,455,"font","Armour Health Bonus: "+armourMaxHealth,14),armourManaRegenBonus=game.add.bitmapText(317,470,"font","Armour Mana Regen Bonus: "+armourManaRegenInterval,14),armourInvulnerableText=game.add.bitmapText(317,485,"font","Armour Invulnerable Bonus: "+armourInvulnerableSpacing,14),crownHealthText=game.add.bitmapText(317,510,"font","Crown Health Bonus: "+hatMaxHealth,14),crownManaRegenText=game.add.bitmapText(317,525,"font","Crown Mana Regen Bonus: "+hatManaRegenInterval,14),crownManaText=game.add.bitmapText(317,540,"font","Crown Mana Bonus: "+hatMaxMana,14),bootsRunSpeedText=game.add.bitmapText(317,565,"font","Boots Run Speed Bonus: "+bootRunSpeed,14),bootManaRegenText=game.add.bitmapText(317,580,"font","Boots Mana Regen Bonus: "+bootManaRegenInterval,14),bootsInvulnerableText=game.add.bitmapText(317,595,"font","Boots Invulnerable Bonus: "+bootInvulnerableSpacing,14),game.add.sprite(483,175,"blankButton"),armourerUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+armourerUpgradeCost,16),armourerUpgradeCost>=1e6?armourerUpgradeText.text=" Buy Skill Material: "+Math.round(armourerUpgradeCost/1e5)/10+"M":armourerUpgradeText.text=" Buy Skill Material: "+armourerUpgradeCost,game.add.button(708,175,"plusButton",this.armourerUpgrade,this),maxFunding=!(armourerFunding<100),wellfunded=armourerFunding>=averageFunding+1,priorityService=!1,this.armourerImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(armourer),population>127&&armourerTimer>game.time.now&&armourerAdTimer<game.time.now&&(advert=!0);break;case"enchanter":enchanterHolder=game.add.sprite(129,175,"blankButton"),enchanterLevelText=game.add.bitmapText(149,205,"font","    Enchanter Fund: "+enchanterFunding,16),enchanterPlusButton=game.add.button(354,175,"plusButton",this.enchanterPlus,this),enchanterMinusButton=game.add.button(49,175,"minusButton",this.enchanterMinus,this),game.add.sprite(310,410,"ui_213x150"),enchanterSkillLevelText=game.add.bitmapText(317,425,"font","Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,14),ringPowerText=game.add.bitmapText(317,450,"font","Ring Power Bonus: "+ringShotPower,14),ringManaText=game.add.bitmapText(317,465,"font","Ring Mana Bonus: "+ringMaxMana,14),ringKnockbackText=game.add.bitmapText(317,480,"font","Ring Knockback Bonus: "+ringKnockback,14),amuletRunSpeedText=game.add.bitmapText(317,500,"font","Amulet Run Speed Bonus: "+amuletRunSpeed,14),amuletShotSpeedText=game.add.bitmapText(317,515,"font","Amulet Shot Speed Bonus: "+amuletShotSpeed,14),amuletAttackSpeedText=game.add.bitmapText(317,530,"font","Amulet Attack Speed Bonus: "+amuletBulletSpacing,14),game.add.sprite(483,175,"blankButton"),enchanterUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+enchanterUpgradeCost,16),enchanterUpgradeCost>=1e6?enchanterUpgradeText.text=" Buy Skill Material: "+Math.round(enchanterUpgradeCost/1e5)/10+"M":enchanterUpgradeText.text=" Buy Skill Material: "+enchanterUpgradeCost,game.add.button(708,175,"plusButton",this.enchanterUpgrade,this),maxFunding=!(enchanterFunding<100),wellfunded=enchanterFunding>=averageFunding+1,priorityService=!1,this.enchanterImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(enchanter),population>153&&enchanterTimer>game.time.now&&enchanterAdTimer<game.time.now&&(advert=!0);break;case"trainer":trainerHolder=game.add.sprite(129,175,"blankButton"),trainerLevelText=game.add.bitmapText(149,205,"font","     Trainer Fund: "+trainerFunding,16),trainerPlusButton=game.add.button(354,175,"plusButton",this.trainerPlus,this),trainerMinusButton=game.add.button(49,175,"minusButton",this.trainerMinus,this),game.add.sprite(310,410,"ui_213x150"),trainerSkillLevelText=game.add.bitmapText(317,425,"font","Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,14),skillPowerText=game.add.bitmapText(317,450,"font","Skill Power Bonus: "+skillShotPower,14),skillManaText=game.add.bitmapText(317,465,"font","Skill Mana Bonus: "+skillMaxMana,14),skillKnockbackText=game.add.bitmapText(317,480,"font","Skill Knockback Bonus: "+skillKnockback,14),staminaRunSpeedText=game.add.bitmapText(317,500,"font","Stamina Run Speed Bonus: "+enduranceRunSpeed,14),staminaShotSpeedText=game.add.bitmapText(317,515,"font","Stamina Shot Speed Bonus: "+enduranceShotSpeed,14),staminaAttackSpeedText=game.add.bitmapText(317,530,"font","Stamina Attack Speed Bonus: "+enduranceBulletSpacing,14),game.add.sprite(483,175,"blankButton"),trainerUpgradeText=game.add.bitmapText(503,205,"font"," Buy Skill Material: "+trainerUpgradeCost,16),trainerUpgradeCost>=1e6?trainerUpgradeText.text=" Buy Skill Material: "+Math.round(trainerUpgradeCost/1e5)/10+"M":trainerUpgradeText.text=" Buy Skill Material: "+trainerUpgradeCost,game.add.button(708,175,"plusButton",this.trainerUpgrade,this),maxFunding=!(trainerFunding<100),wellfunded=trainerFunding>=averageFunding+1,priorityService=!1,this.trainerImprove(),efffectivenessScoreText.text="  Artisan Effectiveness: "+Math.round(trainer),population>205&&trainerTimer>game.time.now&&trainerAdTimer<game.time.now&&(advert=!0)}this.shopTextSelect(),this.advertOptions(),this.adTimeUpdate()},update:function(){this.adTimeUpdate(),""!=bonusType&&spaceBar.isDown&&this.create()},shopClose:function(){game.world.removeAll(),game.state.start("city")},taxPlus:function(){tax<100&&happiness>tax?(tax+=1,taxLevelText.text="Tax Level: "+tax,this.nextYearEstimate(),increaseSFX.play(),this.create()):(shopMessageBackground.x=196,shopMessageText.text="              Taxes can't be increased further.")},taxMinus:function(){tax>=10?(tax-=1,taxLevelText.text="Tax Level: "+tax,this.nextYearEstimate(),reduceSFX.play(),this.create()):(shopMessageBackground.x=196,shopMessageText.text="              Taxes can't be decreased further.")},housingPlus:function(){housingFunding<100&&happiness>housingFunding?(housingFunding+=1,housingLevelText.text="   Homestead Fund: "+housingFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},housingMinus:function(){housingFunding>=10?(housingFunding-=1,housingLevelText.text="   Homestead Fund: "+housingFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},commercialPlus:function(){commercialFunding<100&&happiness>commercialFunding?(commercialFunding+=1,commercialLevelText.text="   City Market Fund: "+commercialFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},commercialMinus:function(){commercialFunding>=10?(commercialFunding-=1,commercialLevelText.text="   City Market Fund: "+commercialFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},industrialPlus:function(){industrialFunding<100&&happiness>industrialFunding?(industrialFunding+=1,industrialLevelText.text="    Farmland Fund: "+industrialFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},industrialMinus:function(){industrialFunding>=10?(industrialFunding-=1,industrialLevelText.text="    Farmland Fund: "+industrialFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},educationPlus:function(){educationFunding<100&&happiness>educationFunding?(educationFunding+=1,educationLevelText.text="      School Fund: "+educationFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},educationMinus:function(){educationFunding>=10?(educationFunding-=1,educationLevelText.text="      School Fund: "+educationFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},healthPlus:function(){healthFunding<100&&happiness>healthFunding?(healthFunding+=1,healthLevelText.text="     Hospital Fund: "+healthFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},healthMinus:function(){healthFunding>=10?(healthFunding-=1,reduceSFX.play(),healthLevelText.text="     Hospital Fund: "+healthFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},justicePlus:function(){justiceFunding<100&&happiness>justiceFunding?(justiceFunding+=1,justiceLevelText.text="       Police Fund: "+justiceFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},justiceMinus:function(){justiceFunding>=10?(justiceFunding-=1,reduceSFX.play(),justiceLevelText.text="       Police Fund: "+justiceFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},defencePlus:function(){defenceFunding<100&&happiness>defenceFunding?(defenceFunding+=1,defenceLevelText.text="     Defence Fund: "+defenceFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},defenceMinus:function(){defenceFunding>=10?(defenceFunding-=1,reduceSFX.play(),defenceLevelText.text="     Defence Fund: "+defenceFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},utilitiesPlus:function(){utilitiesFunding<100&&happiness>utilitiesFunding?(utilitiesFunding+=1,utilitiesLevelText.text="      Sewers Fund: "+utilitiesFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},utilitiesMinus:function(){utilitiesFunding>=10?(utilitiesFunding-=1,reduceSFX.play(),utilitiesLevelText.text="      Sewers Fund: "+utilitiesFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},weaponsmithPlus:function(){weaponsmithFunding<100&&happiness>weaponsmithFunding?(weaponsmithFunding+=1,weaponsmithLevelText.text=" Weaponsmith Fund: "+weaponsmithFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},weaponsmithMinus:function(){weaponsmithFunding>=10?(weaponsmithFunding-=1,reduceSFX.play(),weaponsmithLevelText.text=" Weaponsmith Fund: "+weaponsmithFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},armourerPlus:function(){armourerFunding<100&&happiness>armourerFunding?(armourerFunding+=1,armourerLevelText.text="     Armourer Fund: "+armourerFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},armourerMinus:function(){armourerFunding>=10?(armourerFunding-=1,armourerLevelText.text="     Armourer Fund: "+armourerFunding,reduceSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},enchanterPlus:function(){enchanterFunding<100&&happiness>enchanterFunding?(enchanterFunding+=1,enchanterLevelText.text="    Enchanter Fund: "+enchanterFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},enchanterMinus:function(){enchanterFunding>=10?(enchanterFunding-=1,reduceSFX.play(),enchanterLevelText.text="    Enchanter Fund: "+enchanterFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},trainerPlus:function(){trainerFunding<100&&happiness>trainerFunding?(trainerFunding+=1,trainerLevelText.text="     Trainer Fund: "+trainerFunding,increaseSFX.play(),this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be increased further.")},trainerMinus:function(){trainerFunding>=10?(trainerFunding-=1,reduceSFX.play(),trainerLevelText.text="     Trainer Fund: "+trainerFunding,this.create()):(shopMessageBackground.x=196,reduceSFX.play(),shopMessageText.text="              Funding can't be decreased further.")},weaponsmithImprove:function(){game.time.now>weaponsmithTimer&&population>=110?(baseChance=Math.round((.15*popScore+.25*weaponsmith+.6*weaponsmithDropReward)/2),game.add.sprite(100,250,"border"),wandImage=game.add.sprite(108,258,"wandAnimation"),wandImage.frame=0,wandImage.animations.add("spin",[0,1,2,3,4,5],10,!0),wandPerkButton=game.add.button(30,330,"blankButton",this.wandPerk,this),wandPerkText=game.add.bitmapText(100,350,"font","  Request",15),wandPerkText2=game.add.bitmapText(65,370,"font","  Wand Improvement",15),game.add.sprite(650,250,"border"),shieldImage=game.add.sprite(658,258,"shieldAnimation"),shieldImage.frame=0,shieldImage.animations.add("spin",[0,1,2,3,4,5],10,!0),shieldPerkButton=game.add.button(580,330,"blankButton",this.shieldPerk,this),shieldPerkText=game.add.bitmapText(650,350,"font","  Request",15),shieldPerkText2=game.add.bitmapText(615,370,"font"," Shield Improvement",15)):population<110?(shopMessageBackground.x=196,shopMessageText.text="    Weaponsmith Perks unlock at 110 population."):(shopMessageBackground.x=196,shopMessageText.text=" The Weaponsmith offers upgrades every 30 minutes.")},wandPerk:function(){if(game.time.now>wandTimer){wandTimer=game.time.now+18e5,shieldTimer>game.time.now&&wandTimer>game.time.now&&(weaponsmithTimer=game.time.now+18e5);var e=5*Math.random();wandImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(wandShotPowerUpgrade=Math.round(baseChance+e),wandShotPowerUpgrade>wandShotPower?(shotPower+=.01*(wandShotPowerUpgrade-wandShotPower),wandShotPower=wandShotPowerUpgrade,wandImage.animations.stop(),wandImage.frame=0,wandPerkText.text="  Upgrade:",wandPerkText2.text="    Wand Power +"+wandShotPower,wandPowerText.text="Wand Power Bonus: "+wandShotPower,increaseSFX.play()):(wandPerkText.x=70,wandPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,t.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),wandImage.animations.stop(),wandImage.frame=0)):e>=3.34?(wandShotSpeedUpgrade=Math.round(baseChance+e),wandShotSpeedUpgrade>wandShotSpeed?(shotSpeed+=(wandShotSpeedUpgrade-wandShotSpeed)/2,wandShotSpeed=wandShotSpeedUpgrade,wandImage.animations.stop(),wandImage.frame=2,wandPerkText.text="  Upgrade:",wandPerkText2.text=" Projectile Speed +"+wandShotSpeed,wandShotSpeedText.text="Wand Shot Speed Bonus: "+wandShotSpeed,t.bonusCheck(),increaseSFX.play()):(wandPerkText.x=70,wandPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,t.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),wandImage.animations.stop(),wandImage.frame=2)):(wandBulletSpacingUpgrade=Math.round(baseChance+e),wandBulletSpacingUpgrade>wandBulletSpacing?(bulletSpacing-=(wandBulletSpacingUpgrade-wandBulletSpacing)/2.5,wandBulletSpacing=wandBulletSpacingUpgrade,wandImage.animations.stop(),wandImage.frame=4,wandPerkText.text="  Upgrade:",wandPerkText2.text="Wand Attack Speed +"+wandBulletSpacing,wandAttackSpeedText.text="Wand Attack Speed Bonus: "+wandBulletSpacing,increaseSFX.play()):(wandPerkText.x=70,wandPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,t.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),wandImage.animations.stop(),wandImage.frame=4))})}},shieldPerk:function(){if(game.time.now>shieldTimer){shieldTimer=game.time.now+18e5,shieldTimer>game.time.now&&wandTimer>game.time.now&&(weaponsmithTimer=game.time.now+18e5);var e=5*Math.random();shieldImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(shieldKnockbackUpgrade=Math.round(baseChance+e),shieldKnockbackUpgrade>shieldKnockback?(knockback+=.1*(shieldKnockbackUpgrade-shieldKnockback),
shieldKnockback=shieldKnockbackUpgrade,shieldImage.animations.stop(),shieldImage.frame=0,shieldPerkText.text="  Upgrade:",shieldPerkText2.text="Shield Knockback +"+shieldKnockback,shieldKnockbackText.text="Shield Knockback Bonus: "+shieldKnockback,increaseSFX.play()):(shieldPerkText.x=620,shieldPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,t.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),shieldImage.animations.stop(),shieldImage.frame=0)):e>=3.34?(shieldMaxHealthUpgrade=Math.round((baseChance+e)/2),shieldMaxHealthUpgrade>shieldMaxHealth?(maxHealth+=shieldMaxHealthUpgrade-shieldMaxHealth,shieldMaxHealth=shieldMaxHealthUpgrade,shieldImage.animations.stop(),shieldImage.frame=2,shieldPerkText.text="  Upgrade:",shieldPerkText2.text="    Max Health +"+shieldMaxHealth,shieldHealthText.text="Shield Health Bonus: "+shieldMaxHealth,increaseSFX.play()):(shieldPerkText.x=620,shieldPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,t.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),shieldImage.animations.stop(),shieldImage.frame=2)):(shieldInvulnerableSpacingUpgrade=Math.round(baseChance+e),shieldInvulnerableSpacingUpgrade>shieldInvulnerableSpacing?(invulnerableSpacing+=(shieldInvulnerableSpacingUpgrade-shieldInvulnerableSpacing)/2,shieldInvulnerableSpacing=shieldInvulnerableSpacingUpgrade,shieldImage.animations.stop(),shieldImage.frame=4,shieldPerkText.text="  Upgrade:",shieldPerkText2.text="Invincible Period +"+shieldInvulnerableSpacing,shieldInvulnerableText.text="Shield Invulnerable Bonus: "+shieldInvulnerableSpacing,increaseSFX.play()):(shieldPerkText.x=620,shieldPerkText.text="No upgrade this time",weaponsmithDropReward+=weaponsmithDRBoost,t.dropRewardDiminishingReturns(),weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,reduceSFX.play(),shieldImage.animations.stop(),shieldImage.frame=4))})}},weaponsmithUpgrade:function(){if(coins>=weaponsmithUpgradeCost){coins-=weaponsmithUpgradeCost;var e=1.1+weaponsmithUpgradeCost/1e4;weaponsmithUpgradeCost=Math.round(weaponsmithUpgradeCost*e),weaponsmithDropReward+=weaponsmithDRBoost,this.dropRewardDiminishingReturns(),weaponsmithUpgradeCost>=1e6?weaponsmithUpgradeText.text=" Buy Skill Material: "+Math.round(weaponsmithUpgradeCost/1e5)/10+"M":weaponsmithUpgradeText.text=" Buy Skill Material: "+weaponsmithUpgradeCost,shopCoinsText.text=coins,weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,increaseSFX.play(),this.weaponsmithImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},armourerUpgrade:function(){if(coins>=armourerUpgradeCost){coins-=armourerUpgradeCost;var e=1.1+armourerUpgradeCost/1e4;armourerUpgradeCost=Math.round(armourerUpgradeCost*e),armourerDropReward+=armourerDRBoost,this.dropRewardDiminishingReturns(),armourerUpgradeCost>=1e6?armourerUpgradeText.text=" Buy Skill Material: "+Math.round(armourerUpgradeCost/1e5)/10+"M":armourerUpgradeText.text=" Buy Skill Material: "+armourerUpgradeCost,shopCoinsText.text=coins,armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,increaseSFX.play(),this.armourerImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},enchanterUpgrade:function(){if(coins>=enchanterUpgradeCost){coins-=enchanterUpgradeCost;var e=1.1+enchanterUpgradeCost/1e4;enchanterUpgradeCost=Math.round(enchanterUpgradeCost*e),enchanterDropReward+=enchanterDRBoost,this.dropRewardDiminishingReturns(),enchanterUpgradeCost>=1e6?enchanterUpgradeText.text=" Buy Skill Material: "+Math.round(enchanterUpgradeCost/1e5)/10+"M":enchanterUpgradeText.text=" Buy Skill Material: "+enchanterUpgradeCost,shopCoinsText.text=coins,enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,increaseSFX.play(),this.enchanterImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},trainerUpgrade:function(){if(coins>=trainerUpgradeCost){coins-=trainerUpgradeCost;var e=1.1+trainerUpgradeCost/1e4;trainerUpgradeCost=Math.round(trainerUpgradeCost*e),trainerDropReward+=trainerDRBoost,this.dropRewardDiminishingReturns(),trainerUpgradeCost>=1e6?trainerUpgradeText.text=" Buy Skill Material: "+Math.round(trainerUpgradeCost/1e5)/10+"M":trainerUpgradeText.text=" Buy Skill Material: "+trainerUpgradeCost,shopCoinsText.text=coins,trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,increaseSFX.play(),this.trainerImprove()}else shopMessageBackground.x=196,shopMessageText.text="                        Not enough coins.",reduceSFX.play()},armourerImprove:function(){game.time.now>armourerTimer&&population>=125?(baseChance=Math.round((.15*popScore+.25*armourer+.6*armourerDropReward)/2),game.add.sprite(100,250,"border"),armourImage=game.add.sprite(108,258,"armourAnimation"),armourImage.frame=0,armourImage.animations.add("spin",[0,1,2,3,4,5],10,!0),armourPerkButton=game.add.button(30,330,"blankButton",this.armourPerk,this),armourPerkText=game.add.bitmapText(100,350,"font","    Request",15),armourPerkText2=game.add.bitmapText(65,370,"font","  Armour Improvement",15),game.add.sprite(380,250,"border"),hatImage=game.add.sprite(388,258,"hatAnimation"),hatImage.frame=0,hatImage.animations.add("spin",[0,1,2,3,4,5],10,!0),hatPerkButton=game.add.button(310,330,"blankButton",this.hatPerk,this),hatPerkText=game.add.bitmapText(380,350,"font","    Request",15),hatPerkText2=game.add.bitmapText(345,370,"font","   Crown Improvement",15),game.add.sprite(650,250,"border"),bootImage=game.add.sprite(658,258,"bootAnimation"),bootImage.frame=0,bootImage.animations.add("spin",[0,1,2,3,4,5],10,!0),bootPerkButton=game.add.button(580,330,"blankButton",this.bootPerk,this),bootPerkText=game.add.bitmapText(650,350,"font","    Request",15),bootPerkText2=game.add.bitmapText(615,370,"font","    Boots Improvement",15)):population<125?(shopMessageBackground.x=196,shopMessageText.text="     Armourer Perks unlock at 125 population."):(shopMessageBackground.x=196,shopMessageText.text="   The Armourer offers upgrades every 30 minutes.")},armourPerk:function(){if(game.time.now>armourTimer){armourTimer=game.time.now+18e5,bootTimer>game.time.now&&hatTimer>game.time.now&&armourTimer>game.time.now&&(armourerTimer=game.time.now+18e5);var e=5*Math.random();armourImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(armourMaxHealthUpgrade=Math.round((baseChance+e)/2),armourMaxHealthUpgrade>armourMaxHealth?(maxHealth+=armourMaxHealthUpgrade-armourMaxHealth,armourMaxHealth=armourMaxHealthUpgrade,armourImage.animations.stop(),armourImage.frame=0,armourPerkText.text="  Upgrade:",armourPerkText2.text="    Max Health +"+armourMaxHealth,armourHealthBonusText.text="Armour Health Bonus: "+armourMaxHealth,increaseSFX.play()):(armourPerkText.x=70,armourPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),armourImage.animations.stop(),armourImage.frame=0)):e>=3.34?(armourManaRegenIntervalUpgrade=Math.round(baseChance+e),armourManaRegenIntervalUpgrade>armourManaRegenInterval?(manaRegenHolder-=(armourManaRegenIntervalUpgrade-armourManaRegenInterval)/2,armourManaRegenInterval=armourManaRegenIntervalUpgrade,armourImage.animations.stop(),armourImage.frame=2,armourPerkText.text="  Upgrade:",armourPerkText2.text="Mana Regeneration +"+armourManaRegenInterval,armourManaRegenBonus.text="Armour Mana Regen Bonus: "+armourManaRegenInterval,increaseSFX.play(),t.bonusCheck()):(armourPerkText.x=70,armourPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),armourImage.animations.stop(),armourImage.frame=2)):(armourInvulnerableSpacingUpgrade=Math.round(baseChance+e),armourInvulnerableSpacingUpgrade>armourInvulnerableSpacing?(invulnerableSpacing+=(armourInvulnerableSpacingUpgrade-armourInvulnerableSpacing)/2,armourInvulnerableSpacing=armourInvulnerableSpacingUpgrade,armourImage.animations.stop(),armourImage.frame=4,armourPerkText.text="  Upgrade:",armourPerkText2.text=" Invincible Period +"+armourInvulnerableSpacing,armourInvulnerableText.text="Armour Invulnerable Bonus: "+armourInvulnerableSpacing,increaseSFX.play()):(armourPerkText.x=70,armourPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),armourImage.animations.stop(),armourImage.frame=4))})}},hatPerk:function(){if(game.time.now>hatTimer){hatTimer=game.time.now+18e5,bootTimer>game.time.now&&hatTimer>game.time.now&&armourTimer>game.time.now&&(armourerTimer=game.time.now+18e5);var e=5*Math.random();hatImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(hatMaxHealthUpgrade=Math.round((baseChance+e)/2),hatMaxHealthUpgrade>hatMaxHealth?(maxHealth+=hatMaxHealthUpgrade-hatMaxHealth,hatMaxHealth=hatMaxHealthUpgrade,hatImage.animations.stop(),hatImage.frame=0,hatPerkText.text="  Upgrade:",hatPerkText2.text="    Max Health +"+hatMaxHealth,crownHealthText.text="Crown Health Bonus: "+hatMaxHealth,increaseSFX.play()):(hatPerkText.x=350,hatPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),hatImage.animations.stop(),hatImage.frame=0)):e>=3.34?(hatManaRegenIntervalUpgrade=Math.round(baseChance+e),hatManaRegenIntervalUpgrade>hatManaRegenInterval?(manaRegenHolder-=(hatManaRegenIntervalUpgrade-hatManaRegenInterval)/2,hatManaRegenInterval=hatManaRegenIntervalUpgrade,hatImage.animations.stop(),hatImage.frame=2,hatPerkText.text="  Upgrade:",hatPerkText2.text="Mana Regeneration +"+hatManaRegenInterval,crownManaRegenText.text="Crown Mana Regen Bonus: "+hatManaRegenInterval,increaseSFX.play(),t.bonusCheck()):(hatPerkText.x=350,hatPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),hatImage.animations.stop(),hatImage.frame=2)):(hatMaxManaUpgrade=Math.round(baseChance+e),hatMaxManaUpgrade>hatMaxMana?(maxMana+=hatMaxManaUpgrade-hatMaxMana,hatMaxMana=hatMaxManaUpgrade,hatImage.animations.stop(),hatImage.frame=4,hatPerkText.text="  Upgrade:",hatPerkText2.text="    Max Mana +"+hatMaxMana,crownManaText.text="Crown Mana Bonus: "+hatMaxMana,increaseSFX.play()):(hatPerkText.x=350,hatPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),hatImage.animations.stop(),hatImage.frame=4))})}},bootPerk:function(){if(game.time.now>bootTimer){bootTimer=game.time.now+18e5,bootTimer>game.time.now&&hatTimer>game.time.now&&armourTimer>game.time.now&&(armourerTimer=game.time.now+18e5);var e=5*Math.random();bootImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(bootRunSpeedUpgrade=Math.round(baseChance+e),bootRunSpeedUpgrade>bootRunSpeed?(runSpeed+=.1*(bootRunSpeedUpgrade-bootRunSpeed),bootRunSpeed=bootRunSpeedUpgrade,bootImage.animations.stop(),bootImage.frame=0,bootPerkText.text="  Upgrade:",bootPerkText2.text="     Run Speed +"+bootRunSpeed,bootsRunSpeedText.text="Boots Run Speed Bonus: "+bootRunSpeed,increaseSFX.play()):(bootPerkText.x=620,bootPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),bootImage.animations.stop(),bootImage.frame=0)):e>=3.34?(bootManaRegenIntervalUpgrade=Math.round(baseChance+e),bootManaRegenIntervalUpgrade>bootManaRegenInterval?(manaRegenHolder-=(bootManaRegenIntervalUpgrade-bootManaRegenInterval)/2,bootManaRegenInterval=bootManaRegenIntervalUpgrade,bootImage.animations.stop(),bootImage.frame=2,bootPerkText.text="  Upgrade:",bootPerkText2.text="Mana Regeneration +"+bootManaRegenInterval,bootManaRegenText.text="Boots Mana Regen Bonus: "+bootManaRegenInterval,increaseSFX.play(),t.bonusCheck()):(bootPerkText.x=620,bootPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),bootImage.animations.stop(),bootImage.frame=2)):(bootInvulnerableSpacingUpgrade=Math.round(baseChance+e),bootInvulnerableSpacingUpgrade>bootInvulnerableSpacing?(invulnerableSpacing+=(bootInvulnerableSpacingUpgrade-bootInvulnerableSpacing)/2,bootInvulnerableSpacing=bootInvulnerableSpacingUpgrade,bootImage.animations.stop(),bootImage.frame=4,bootPerkText.text="  Upgrade:",bootPerkText2.text=" Invincible Period +"+bootInvulnerableSpacing,bootsInvulnerableText.text="Boots Invulnerable Bonus: "+bootInvulnerableSpacing,increaseSFX.play()):(bootPerkText.x=620,bootPerkText.text="No upgrade this time",armourerDropReward+=armourerDRBoost,t.dropRewardDiminishingReturns(),armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,reduceSFX.play(),bootImage.animations.stop(),bootImage.frame=4))})}},enchanterImprove:function(){game.time.now>enchanterTimer&&population>=150?(baseChance=Math.round((.15*popScore+.25*enchanter+.6*enchanterDropReward)/2),game.add.sprite(100,250,"border"),ringImage=game.add.sprite(108,258,"ringAnimation"),ringImage.frame=0,ringImage.animations.add("spin",[0,1,2,3,4,5],10,!0),ringPerkButton=game.add.button(30,330,"blankButton",this.ringPerk,this),ringPerkText=game.add.bitmapText(100,350,"font","   Request",15),ringPerkText2=game.add.bitmapText(65,370,"font","   Ring Improvement",15),game.add.sprite(650,250,"border"),amuletImage=game.add.sprite(658,258,"amuletAnimation"),amuletImage.frame=0,amuletImage.animations.add("spin",[0,1,2,3,4,5],10,!0),amuletPerkButton=game.add.button(580,330,"blankButton",this.amuletPerk,this),amuletPerkText=game.add.bitmapText(650,350,"font","  Request",15),amuletPerkText2=game.add.bitmapText(615,370,"font","  Amulet Improvement",15)):population<150?(shopMessageBackground.x=196,shopMessageText.text="     Enchanter Perks unlock at 150 population."):(shopMessageBackground.x=196,shopMessageText.text="  The Enchanter offers upgrades every 30 minutes.")},ringPerk:function(){if(game.time.now>ringTimer){ringTimer=game.time.now+18e5,amuletTimer>game.time.now&&ringTimer>game.time.now&&(enchanterTimer=game.time.now+18e5);var e=5*Math.random();ringImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(ringShotPowerUpgrade=Math.round(baseChance+e),ringShotPowerUpgrade>ringShotPower?(shotPower+=.01*(ringShotPowerUpgrade-ringShotPower),ringShotPower=ringShotPowerUpgrade,ringImage.animations.stop(),ringImage.frame=0,ringPerkText.text="  Upgrade:",ringPerkText2.text="   Ring Power +"+ringShotPower,ringPowerText.text="Ring Power Bonus: "+ringShotPower,increaseSFX.play()):(ringPerkText.x=70,ringPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,t.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),ringImage.animations.stop(),ringImage.frame=0)):e>=3.34?(ringMaxManaUpgrade=Math.round(baseChance+e),ringMaxManaUpgrade>ringMaxMana?(maxMana+=ringMaxManaUpgrade-ringMaxMana,ringMaxMana=ringMaxManaUpgrade,ringImage.animations.stop(),ringImage.frame=2,ringPerkText.text="  Upgrade:",ringPerkText2.text="     Max Mana +"+ringMaxMana,ringManaText.text="Ring Mana Bonus: "+ringMaxMana,increaseSFX.play()):(ringPerkText.x=70,ringPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,t.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),ringImage.animations.stop(),ringImage.frame=2)):(ringKnockbackUpgrade=Math.round(baseChance+e),ringKnockbackUpgrade>ringKnockback?(knockback+=.1*(ringKnockbackUpgrade-ringKnockback),ringKnockback=ringKnockbackUpgrade,ringImage.animations.stop(),ringImage.frame=4,ringPerkText.text="  Upgrade:",ringPerkText2.text="   Knockback +"+ringKnockback,ringKnockbackText.text="Ring Knockback Bonus: "+ringKnockback,increaseSFX.play()):(ringPerkText.x=70,ringPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,t.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),ringImage.animations.stop(),ringImage.frame=4))})}},amuletPerk:function(){if(game.time.now>amuletTimer){amuletTimer=game.time.now+18e5,amuletTimer>game.time.now&&ringTimer>game.time.now&&(enchanterTimer=game.time.now+18e5);var e=5*Math.random();amuletImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(amuletRunSpeedUpgrade=Math.round(baseChance+e),amuletRunSpeedUpgrade>amuletRunSpeed?(runSpeed+=.1*(amuletRunSpeedUpgrade-amuletRunSpeed),amuletRunSpeed=amuletRunSpeedUpgrade,amuletImage.animations.stop(),amuletImage.frame=0,amuletPerkText.text="  Upgrade:",amuletPerkText2.text="   Run Speed +"+amuletRunSpeed,amuletRunSpeedText.text="Amulet Run Speed Bonus: "+amuletRunSpeed,increaseSFX.play()):(amuletPerkText.x=620,amuletPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,t.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),amuletImage.animations.stop(),amuletImage.frame=0)):e>=3.34?(amuletShotSpeedUpgrade=Math.round(baseChance+e),amuletShotSpeedUpgrade>amuletShotSpeed?(shotSpeed+=(amuletShotSpeedUpgrade-amuletShotSpeed)/2,amuletShotSpeed=amuletShotSpeedUpgrade,amuletImage.animations.stop(),amuletImage.frame=2,amuletPerkText.text="  Upgrade:",amuletPerkText2.text="   Shot Speed +"+amuletShotSpeed,amuletShotSpeedText.text="Amulet Shot Speed Bonus: "+amuletShotSpeed,increaseSFX.play(),t.bonusCheck()):(amuletPerkText.x=620,amuletPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,t.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),amuletImage.animations.stop(),amuletImage.frame=2)):(amuletBulletSpacingUpgrade=Math.round(baseChance+e),amuletBulletSpacingUpgrade>amuletBulletSpacing?(bulletSpacing-=(amuletBulletSpacingUpgrade-amuletBulletSpacing)/2.5,amuletBulletSpacing=amuletBulletSpacingUpgrade,amuletImage.animations.stop(),amuletImage.frame=4,amuletPerkText.text="  Upgrade:",amuletPerkText2.text="  Attack Speed +"+amuletBulletSpacing,amuletAttackSpeedText.text="Amulet Attack Speed Bonus: "+amuletBulletSpacing,increaseSFX.play()):(amuletPerkText.x=620,amuletPerkText.text="No upgrade this time",enchanterDropReward+=enchanterDRBoost,t.dropRewardDiminishingReturns(),enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,reduceSFX.play(),amuletImage.animations.stop(),amuletImage.frame=4))})}},trainerImprove:function(){game.time.now>trainerTimer&&population>=200?(baseChance=Math.round((.15*popScore+.25*trainer+.6*trainerDropReward)/2),game.add.sprite(100,250,"border"),skillImage=game.add.sprite(108,258,"skillAnimation"),skillImage.frame=0,skillImage.animations.add("spin",[0,1,2,3,4,5],10,!0),skillPerkButton=game.add.button(30,330,"blankButton",this.skillPerk,this),skillPerkText=game.add.bitmapText(100,350,"font","  Request",15),skillPerkText2=game.add.bitmapText(65,370,"font","       Skill Training",15),game.add.sprite(650,250,"border"),enduranceImage=game.add.sprite(658,258,"enduranceAnimation"),enduranceImage.frame=0,enduranceImage.animations.add("spin",[0,1,2,3,4,5],10,!0),endurancePerkButton=game.add.button(580,330,"blankButton",this.endurancePerk,this),endurancePerkText=game.add.bitmapText(650,350,"font","  Request",15),endurancePerkText2=game.add.bitmapText(615,370,"font","    Stamina Training",15)):population<200?(shopMessageBackground.x=196,shopMessageText.text="       Trainer Perks unlock at 200 population."):(shopMessageBackground.x=196,shopMessageText.text="   The Trainer offers upgrades every 30 minutes.")},skillPerk:function(){if(game.time.now>skillTimer){skillTimer=game.time.now+18e5,enduranceTimer>game.time.now&&skillTimer>game.time.now&&(trainerTimer=game.time.now+18e5);var e=5*Math.random();skillImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(skillShotPowerUpgrade=Math.round(baseChance+e),skillShotPowerUpgrade>skillShotPower?(shotPower+=.01*(skillShotPowerUpgrade-skillShotPower),skillShotPower=skillShotPowerUpgrade,skillImage.animations.stop(),skillImage.frame=0,skillPerkText.text="  Upgrade:",skillPerkText2.text="    Skill Power +"+skillShotPower,skillPowerText.text="Skill Power Bonus: "+skillShotPower,increaseSFX.play()):(skillPerkText.x=70,skillPerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,t.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),skillImage.animations.stop(),skillImage.frame=0)):e>=3.34?(skillMaxManaUpgrade=Math.round(baseChance+e),skillMaxManaUpgrade>skillMaxMana?(maxMana+=skillMaxManaUpgrade-skillMaxMana,skillMaxMana=skillMaxManaUpgrade,skillImage.animations.stop(),skillImage.frame=2,skillPerkText.text="  Upgrade:",skillPerkText2.text="    Max Mana +"+skillMaxMana,skillManaText.text="Skill Mana Bonus: "+skillMaxMana,increaseSFX.play()):(skillPerkText.x=70,skillPerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,t.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),skillImage.animations.stop(),skillImage.frame=2)):(skillKnockbackUpgrade=Math.round(baseChance+e),skillKnockbackUpgrade>skillKnockback?(knockback+=.1*(skillKnockbackUpgrade-skillKnockback),skillKnockback=skillKnockbackUpgrade,skillImage.animations.stop(),skillImage.frame=4,skillPerkText.text="  Upgrade:",skillPerkText2.text="   Knockback +"+skillKnockback,skillKnockbackText.text="Skill Knockback Bonus: "+skillKnockback,increaseSFX.play()):(skillPerkText.x=70,skillPerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,t.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),skillImage.animations.stop(),skillImage.frame=4))})}},endurancePerk:function(){if(game.time.now>enduranceTimer){enduranceTimer=game.time.now+18e5,enduranceTimer>game.time.now&&skillTimer>game.time.now&&(trainerTimer=game.time.now+18e5);var e=5*Math.random();enduranceImage.animations.play("spin"),slotMachineSFX.play();var t=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){e<=1.66?(enduranceRunSpeedUpgrade=Math.round(baseChance+e),enduranceRunSpeedUpgrade>enduranceRunSpeed?(runSpeed+=.1*(enduranceRunSpeedUpgrade-enduranceRunSpeed),enduranceRunSpeed=enduranceRunSpeedUpgrade,enduranceImage.animations.stop(),enduranceImage.frame=0,endurancePerkText.text="  Upgrade:",endurancePerkText2.text="   Run Speed +"+enduranceRunSpeed,staminaRunSpeedText.text="Stamina Run Speed Bonus: "+enduranceRunSpeed,increaseSFX.play()):(endurancePerkText.x=620,endurancePerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,t.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),enduranceImage.animations.stop(),enduranceImage.frame=0)):e>=3.34?(enduranceShotSpeedUpgrade=Math.round(baseChance+e),enduranceShotSpeedUpgrade>enduranceShotSpeed?(shotSpeed+=(enduranceShotSpeedUpgrade-enduranceShotSpeed)/2,enduranceShotSpeed=enduranceShotSpeedUpgrade,enduranceImage.animations.stop(),enduranceImage.frame=2,endurancePerkText.text="  Upgrade:",endurancePerkText2.text="   Shot Speed +"+enduranceShotSpeed,staminaShotSpeedText.text="Stamina Shot Speed Bonus: "+enduranceShotSpeed,increaseSFX.play(),t.bonusCheck()):(endurancePerkText.x=620,endurancePerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,t.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),enduranceImage.animations.stop(),enduranceImage.frame=2)):(enduranceBulletSpacingUpgrade=Math.round(baseChance+e),enduranceBulletSpacingUpgrade>enduranceBulletSpacing?(bulletSpacing-=(enduranceBulletSpacingUpgrade-enduranceBulletSpacing)/2.5,enduranceBulletSpacing=enduranceBulletSpacingUpgrade,enduranceImage.animations.stop(),enduranceImage.frame=4,endurancePerkText.text="  Upgrade:",endurancePerkText2.text="   Attack Speed +"+enduranceBulletSpacing,staminaAttackSpeedText.text="Stamina Attack Speed Bonus: "+enduranceBulletSpacing,increaseSFX.play()):(endurancePerkText.x=620,endurancePerkText.text="No upgrade this time",trainerDropReward+=trainerDRBoost,t.dropRewardDiminishingReturns(),trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,reduceSFX.play(),enduranceImage.animations.stop(),enduranceImage.frame=4))})}},collectSFX:function(){var e=game.add.audio("collect");e.play()},shopLeft:function(){switch(shop){case"castle":shop="trainer",this.create();break;case"housing":shop="castle",this.create();break;case"commercial":shop="housing",this.create();break;case"industrial":shop="commercial",this.create();break;case"education":shop="industrial",this.create();break;case"health":shop="education",this.create();break;case"justice":shop="health",this.create();break;case"defence":shop="justice",this.create();break;case"utilities":shop="defence",this.create();break;case"weaponsmith":shop="utilities",this.create();break;case"armourer":shop="weaponsmith",this.create();break;case"enchanter":shop="armourer",this.create();break;case"trainer":shop="enchanter",this.create()}},shopRight:function(){switch(shop){case"castle":shop="housing",this.create();break;case"housing":shop="commercial",this.create();break;case"commercial":shop="industrial",this.create();break;case"industrial":shop="education",this.create();break;case"education":shop="health",this.create();break;case"health":shop="justice",this.create();break;case"justice":shop="defence",this.create();break;case"defence":shop="utilities",this.create();break;case"utilities":shop="weaponsmith",this.create();break;case"weaponsmith":shop="armourer",this.create();break;case"armourer":shop="enchanter",this.create();break;case"enchanter":shop="trainer",this.create();break;case"trainer":shop="castle",this.create()}},shopTextSelect:function(){if("castle"==shop);else if(maxFunding||wellfunded)shopText.text=" Your Majesty!",shopText2.text="   Our funding levels",shopText3.text="     are most satisfactory.",shopText4.text="    We will endeavour to ",shopText5.text="      justify your faith",shopText6.text="         in us.";else if(priorityService)shopText.text=" Your Majesty!",shopText2.text=" We humbly request an",shopText3.text="    increase in funding. To",shopText4.text="provide an adequate service",shopText5.text="     we need a funding",shopText6.text="      level of "+happiness+".";else{if(happiness<100)var e=1;else e=0;shopText.text=" Your Majesty!",shopText2.text=" We humbly request an",shopText3.text="    increase in funding. To",shopText4.text="provide an adequate service",shopText5.text="     we need a funding",shopText6.text=" level of at least "+(averageFunding+e)+"."}},advertOptions:function(){if(1==advert){switch(shopText.text=" Your Majesty!",shopText2.text="  The Merchant Guild ",shopText3.text="   has offered to fund your",shopText4.text="  "+shop+" in return for",shopText5.text="     a few minutes of",shopText6.text="       your time.",addStartButton=game.add.button(80,115,"blankButton",this.adWatch,this),addStartText=game.add.bitmapText(110,135,"font","Yes, watch ad",16),shop){case"weaponsmith":addRejectButton=game.add.button(315,115,"blankButton",this.weaponsmithAdNo,this),addRejectText=game.add.bitmapText(350,135,"font","No, not now",16);break;case"armourer":addRejectButton=game.add.button(315,115,"blankButton",this.armourerAdNo,this),addRejectText=game.add.bitmapText(350,135,"font","No, not now",16);break;case"enchanter":addRejectButton=game.add.button(315,115,"blankButton",this.enchanterAdNo,this),addRejectText=game.add.bitmapText(350,135,"font","No, not now",16);break;case"trainer":addRejectButton=game.add.button(315,115,"blankButton",this.trainerAdNo,this),addRejectText=game.add.bitmapText(350,135,"font","No, not now",16)}addStartButton.scale.setTo(.75,.75),addRejectButton.scale.setTo(.75,.75)}},nextYearEstimate:function(){nextHousing=housing+(housingFunding-housing)/12,nextCommercial=commercial+(commercialFunding-commercial)/12,nextIndustrial=industrial+(industrialFunding-industrial)/12,nextEducation=education+(educationFunding-education)/12,nextPopHealth=popHealth+(healthFunding-popHealth)/12,nextJustice=justice+(justiceFunding-justice)/12,nextDefence=defence+(defenceFunding-defence)/12,nextUtilities=utilities+(utilitiesFunding-utilities)/12,nextWeaponsmith=weaponsmith+(weaponsmithFunding-weaponsmith)/12,nextArmourer=armourer+(armourerFunding-armourer)/12,nextEnchanter=enchanter+(enchanterFunding-enchanter)/12,nextTrainer=trainer+(trainerFunding-trainer)/12,nextPopulation=population,nextPopulation+=population*((nextHousing-33)/4e3),nextPopulation+=population*((nextEducation-33)/9e3),nextPopulation+=population*((nextPopHealth-33)/2e3),nextPopulation+=population*((nextJustice-33)/13e3),nextPopulation+=population*((nextDefence-33)/14e3),nextPopulation+=population*((nextUtilities-33)/9e3),nextPopulation+=population*((nextTrainer-33)/14300),nextPopulation-=population*((tax-30)/2e3),nextYear=year+1,nextPopulation+=year+1<=30?1+(year+1)/10:9-(year+1)/6,nextPopulation>5e6?(nextCoins+=nextPopulation-5e6,nextPopulation=5e6):nextPopulation=nextPopulation>0?Math.round(nextPopulation):0,nextHappiness=Math.round(20+questHappinessModifier+4*(nextHousing/15+nextCommercial/100+nextIndustrial/100+nextEducation/100+nextPopHealth/15+nextJustice/20+nextDefence/100+nextUtilities/80)),nextHappiness>100&&(nextHappiness=100),nextEconomyMod=1,nextEconomyMod+=(nextCommercial-34)/950,nextEconomyMod+=(nextIndustrial-34)/950,nextEconomyMod+=(nextEducation-34)/950,nextEconomyMod+=(nextJustice-34)/6e3,nextEconomyMod+=(nextWeaponsmith-34)/5e3,nextEconomyMod+=(nextArmourer-34)/5e3,nextEconomyMod+=(nextEnchanter-34)/5e3,nextEconomyMod+=(nextTrainer-34)/6e3,nextEconomyMod+=(nextUtilities-33)/9e3,nextEconomyMod-=(tax-30)/3e3,nextIncome=income,nextIncome=nextPopulation*nextEconomyMod*(1.17*tax),nextExpenditure=totalFunding*(4.45+(year+1)/22)+nextPopulation*(totalFunding/19),nextNetIncome=netIncome,nextNetIncome=nextIncome-nextExpenditure,nextCoins=coins,nextCoins+=Math.round(nextNetIncome),nextYearStatText.text="Year: "+nextYear,nextPopulationStatText.text="Population: "+nextPopulation,nextIncomeStatText.text="Income: "+Math.round(nextIncome),nextExpenditureStatText.text="Expenditure: "+Math.round(nextExpenditure),nextNetIncomeStatText.text="Net Income: "+Math.round(nextNetIncome),nextBalanceStatText.text="Balance: "+nextCoins},dropRewardDiminishingReturns:function(){weaponsmithDRBoost=weaponsmithDropReward<=10?1:weaponsmithDropReward<=25?.75:weaponsmithDropReward<=50?.5:weaponsmithDropReward<=100?.33:weaponsmithDropReward<=1e3?.25:.2,armourerDRBoost=armourerDropReward<=10?1:armourerDropReward<=25?.75:armourerDropReward<=50?.5:armourerDropReward<=100?.33:armourerDropReward<=1e3?.25:.2,enchanterDRBoost=enchanterDropReward<=10?1:enchanterDropReward<=25?.75:enchanterDropReward<=50?.5:enchanterDropReward<=100?.33:enchanterDropReward<=1e3?.25:.2,trainerDRBoost=trainerDropReward<=10?1:trainerDropReward<=25?.75:trainerDropReward<=50?.5:trainerDropReward<=100?.33:trainerDropReward<=1e3?.25:.2;
},adWatch:function(){addStartButton.destroy(),addStartText.destroy(),addRejectButton.destroy(),addRejectText.destroy(),advertImage=game.add.sprite(185,89,"advertImage"),adStopTime=game.time.now+14e3;var e={font:"21px sans-serif bold"};adTimeText=game.add.text(619,92,"",e);var t=this;"weaponsmith"==shop?game.time.events.add(14*Phaser.Timer.SECOND,function(){adCloseButton=game.add.button(618,89,"closeButton",t.weaponsmithAd,this)}):"armourer"==shop?game.time.events.add(14*Phaser.Timer.SECOND,function(){adCloseButton=game.add.button(618,89,"closeButton",t.armourerAd,this)}):"enchanter"==shop?game.time.events.add(14*Phaser.Timer.SECOND,function(){adCloseButton=game.add.button(618,89,"closeButton",t.enchanterAd,this)}):"trainer"==shop&&game.time.events.add(14*Phaser.Timer.SECOND,function(){adCloseButton=game.add.button(618,89,"closeButton",t.trainerAd,this)})},adTimeUpdate:function(){null!=adTimeText&&(adStopTime-game.time.now<9500&&adStopTime>game.time.now?adTimeText.text="0"+Math.round((adStopTime-game.time.now)/1e3):adStopTime>game.time.now?adTimeText.text=Math.round((adStopTime-game.time.now)/1e3):adTimeText.text="")},weaponsmithAd:function(){advertImage.destroy(),adCloseButton.kill(),weaponsmithDropReward+=5*weaponsmithDRBoost,weaponsmithSkillLevelText.text="Weaponsmith Skill Level: "+Math.round(10*weaponsmithDropReward)/10,weaponsmithTimer=game.time.now-10,wandTimer=game.time.now-10,shieldTimer=game.time.now-10,weaponsmithAdTimer=game.time.now+36e5,advert=!1,game.state.start("shop")},armourerAd:function(){advertImage.destroy(),adCloseButton.kill(),armourerDropReward+=5*armourerDRBoost,armourerSkillLevelText.text="Armourer Skill Level: "+Math.round(10*armourerDropReward)/10,armourerTimer=game.time.now-10,armourTimer=game.time.now-10,hatTimer=game.time.now-10,bootTimer=game.time.now-10,armourerAdTimer=game.time.now+36e5,advert=!1,game.state.start("shop")},enchanterAd:function(){advertImage.destroy(),adCloseButton.kill(),enchanterDropReward+=5*enchanterDRBoost,enchanterSkillLevelText.text="Enchanter Skill Level: "+Math.round(10*enchanterDropReward)/10,enchanterTimer=game.time.now-10,ringTimer=game.time.now-10,amuletTimer=game.time.now-10,enchanterAdTimer=game.time.now+36e5,advert=!1,game.state.start("shop")},trainerAd:function(){advertImage.destroy(),adCloseButton.kill(),trainerDropReward+=5*trainerDRBoost,trainerSkillLevelText.text="Trainer Skill Level: "+Math.round(10*trainerDropReward)/10,trainerTimer=game.time.now-10,skillTimer=game.time.now-10,enduranceTimer=game.time.now-10,trainerAdTimer=game.time.now+36e5,advert=!1,game.state.start("shop")},weaponsmithAdNo:function(){weaponsmithAdTimer=game.time.now+9e5,advert=!1,this.create()},armourerAdNo:function(){armourerAdTimer=game.time.now+9e5,advert=!1,this.create()},enchanterAdNo:function(){enchanterAdTimer=game.time.now+9e5,advert=!1,this.create()},trainerAdNo:function(){trainerAdTimer=game.time.now+9e5,advert=!1,this.create()},bonusUnlock:function(){game.add.button(350,469,"assistant",this.create,this),game.add.button(150,469,"speechBubble",this.create,this);switch(bonusType){case"beam":var e=game.add.bitmapText(200,477,"fontBorder","Great news!",15),t=game.add.bitmapText(170,494,"fontBorder","  Your artisans have ",15),a=game.add.bitmapText(158,509,"fontBorder","worked together to unlock ",15),n=game.add.bitmapText(158,524,"fontBorder","the power of beam magic. ",15),r=game.add.bitmapText(170,539,"fontBorder","  Press SPACE to use ",15),o=game.add.bitmapText(190,554,"fontBorder"," while questing!",15);beamUnlockShown=!0,beamWeapon=!0;break;case"manaRefill":e=game.add.bitmapText(200,477,"fontBorder","Great news!",15),t=game.add.bitmapText(170,494,"fontBorder","  Your artisans have ",15),a=game.add.bitmapText(158,509,"fontBorder","  worked together to unlock ",15),n=game.add.bitmapText(158,524,"fontBorder","  the power of mana refills. ",15),r=game.add.bitmapText(170,539,"fontBorder"," Press Q during a quest ",15),o=game.add.bitmapText(190,554,"fontBorder","to refill your mana.",15),manaRefillUnlockShown=!0,manaRefillAvailable=!0}e.tint=0,t.tint=0,a.tint=0,n.tint=0,r.tint=0,o.tint=0},bonusCheck:function(){wandShotSpeed+amuletShotSpeed+enduranceShotSpeed>30&&0==beamUnlockShown&&(bonusType="beam",this.bonusUnlock()),armourManaRegenInterval+hatManaRegenInterval+bootManaRegenInterval>40&&0==manaRefillUnlockShown&&(bonusType="manaRefill",this.bonusUnlock())}};