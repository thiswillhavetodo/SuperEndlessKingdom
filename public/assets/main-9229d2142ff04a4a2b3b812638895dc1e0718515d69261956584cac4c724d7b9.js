var platforms,player,playerLevel=1,facing,bullets,bulletTimer=0,bulletSpacing=525,beamWeapon=!1,shotSpeed=320,manaCost=5,flameBullets,flameBulletSpacing=4250,iceBeams,charges,waterShots,freezeTimer=0,invulnerableTimer=0,invulnerableSpacing=800,manaRegenTimer=0,manaRegenHolder=490,manaRegenEndLevelAdjust=0,manaRegenInterval=manaRegenHolder,manaRefillAvailable=!1,first=!0,timerBeam,timerBeamEvent,timerMana,timerManaEvent,baddies,flames,skeletons,swordZombies,mummies,evilwizards,zombieBirds,miniZombieBirds,spiders,swampCreatures,treeBeasts,evilRoots,vampires,decoys,bossZombies,bossZombieBirds,bossMummies,bossFinals,bossZombieKilled=!1,bossTreeBeastKilled=!1,bossSkeletonKilled=!1,bossZombieBirdKilled=!1,bossMummyKilled=!1,bossFinalKilled=!1,cursors,fireButton,wKey,aKey,sKey,dKey,qKey,stars,door,doorAvailable=!1,levelUpImage,coins=1500,stage=1,reward=0,hudDisplay,hpBar,manaBar,xpBar,hpCrop,manaCrop,xpCrop,stageText,coinDisplay,coinsText,healthText,resultBackground,levelRecordBackground,resultText,resultText2,resultText3,levelRecord,levelRecord2,levelRecord3,playerLevelText,xpText,manaText,beamSprite,beamText,bottleSprite,bottleText,xp=0,xpDisplay=0,nextLevelXp=10,nextLevelXpDisplay=10,health=3,maxHealth=3,mana=75,maxMana=75,starTotal=6,baddieTotal=7,baddieCount=7,baddieAdjuster=0,baddieDamageAdjuster=1,baddieHpAdjuster=1,baddieXpAdjuster=1,baddieSpeedAdjuster=1,baddieCreated=0,chestCreated=0,flameCount=0,evilwizardCount=0,zombieBirdCount=0,swampCreatureCount=0,shotPower=1.25,knockback=1,runSpeed=190,runSpeedEndLevelAdjust=0,nullArray=[66,67,68,69,70,71,79,80,81,82,83,84,92,93,94,95,96,97,105,106,107,108,109,110,118,119,120,121,122,123],array=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130],sceneryCount=0,backgroundScene="",gameMusic,advertImage,adStopTime,adTimeText,beamSFX,waterShotSFX,flameShot,zombieDeathSFX,shortExplodeSFX,collectSFX,pewSound,swordZombieTest=!1,playState={create:function(){for(game.world.removeAll(),game.time.advancedTiming=!0,game.physics.startSystem(Phaser.Physics.ARCADE),Math.random()>.66||60==stage?(game.add.sprite(0,0,"field"),backgroundScene="wasteland",gameMusic=game.add.audio("wastelandMusic"),gameMusic.play()):Math.random()<.34?(game.add.sprite(0,0,"stonepavingOvergrown"),backgroundScene="ruins",gameMusic=game.add.audio("ruinsMusic"),gameMusic.play()):(game.add.sprite(0,0,"forestBackground"),backgroundScene="forest",gameMusic=game.add.audio("forestMusic"),gameMusic.play()),coinsText=coins>=1e6?game.add.bitmapText(395,10,"font",Math.round(coins/1e3)/1e3+"M",30):game.add.bitmapText(395,10,"font",coins,30),hudDisplay=game.add.sprite(0,0,"hudDisplay"),hudDisplay.scale.setTo(1.1,1.1),hpBar=game.add.sprite(92,7,"hudBarRed"),hpBar.scale.setTo(1.1,1.1),hpCrop=new Phaser.Rectangle(0,0,88,15),hpBar.crop(hpCrop),healthText=game.add.bitmapText(93,7,"fontWhite","HP: "+health+"/"+maxHealth,15),manaBar=game.add.sprite(92,28,"hudBarBlue"),manaBar.scale.setTo(1.1,1.1),manaCrop=new Phaser.Rectangle(0,0,88,15),manaBar.crop(manaCrop),manaText=game.add.bitmapText(93,28,"fontWhite","MP: "+mana+"/"+maxMana,15),xpBar=game.add.sprite(92,50,"hudBarGreen"),xpBar.scale.setTo(1.1,1.1),xpCrop=new Phaser.Rectangle(0,0,88,15),xpBar.crop(xpCrop),xpText=game.add.bitmapText(93,50,"fontWhite","XP: "+xpDisplay+"/"+nextLevelXpDisplay,15),this.xpDisplayConvert(),playerLevelText=playerLevel>=100?game.add.bitmapText(9,23,"font",playerLevel,30):playerLevel>=10?game.add.bitmapText(18,23,"font",playerLevel,30):game.add.bitmapText(26,23,"font",playerLevel,30),stageText=game.add.bitmapText(600,10,"font","Stage: "+stage,30),coinsText.alpha=.7,xpText.alpha=.7,healthText.alpha=.7,manaText.alpha=.7,playerLevelText.alpha=.7,stageText.alpha=.7,coinDisplay=game.add.sprite(360,8,"coin"),coinDisplay.frame=0,player=game.add.sprite(16,game.world.height-50,"dude"),game.physics.arcade.enable(player),player.body.setSize(27,32,2,2),player.body.collideWorldBounds=!0,player.isAlive=!0,player.animations.add("left",[9,10,11],10,!0),player.animations.add("right",[3,4,5],10,!0),player.animations.add("up",[0,1,2],10,!0),player.animations.add("down",[6,7,8],10,!0),bullets=game.add.group(),bullets.enableBody=!0,bullets.createMultiple(90,"bullet"),pewSound=game.add.audio("pew"),shortExplodeSFX=game.add.audio("shortExplode"),flameBullets=game.add.group(),flameBullets.enableBody=!0,iceBeams=game.add.group(),iceBeams.enableBody=!0,iceBeams.createMultiple(110,"iceBeamMini"),charges=game.add.group(),charges.enableBody=!0,waterShots=game.add.group(),waterShots.enableBody=!0,waterShots.createMultiple(6,"waterShot"),miniZombieBirds=game.add.group(),miniZombieBirds.enableBody=!0,miniZombieBirds.createMultiple(23,"miniZombieBird"),skeletons=game.add.group(),skeletons.enableBody=!0,mummies=game.add.group(),mummies.enableBody=!0,baddies=game.add.group(),baddies.enableBody=!0,zombieDeathSFX=game.add.audio("zombieDeath"),zombieDeathSFX.allowMultiple=!0,swordZombies=game.add.group(),swordZombies.enableBody=!0,flames=game.add.group(),flames.enableBody=!0,evilwizards=game.add.group(),evilwizards.enableBody=!0,zombieBirds=game.add.group(),zombieBirds.enableBody=!0,spiders=game.add.group(),spiders.enableBody=!0,swampCreatures=game.add.group(),swampCreatures.enableBody=!0,treeBeasts=game.add.group(),treeBeasts.enableBody=!0,evilRoots=game.add.group(),evilRoots.enableBody=!0,bossZombies=game.add.group(),bossZombies.enableBody=!0,bossZombieBirds=game.add.group(),bossZombieBirds.enableBody=!0,bossMummies=game.add.group(),bossMummies.enableBody=!0,bossFinals=game.add.group(),bossFinals.enableBody=!0,vampires=game.add.group(),vampires.enableBody=!0,decoys=game.add.group(),decoys.enableBody=!0,platforms=game.add.group(),platforms.enableBody=!0,swordZombieTest&&(this.bossFinalCreate(600,300),beamSFX=game.add.audio("shotSFX"),baddieCreated=baddieTotal),stage-100*Math.floor(stage/100)==50&&0==bossZombieKilled&&(stage>=150?this.bossZombieCreate(760,200,"red"):this.bossZombieCreate(760,200,"green"),baddieCreated=baddieTotal,this.treeCreate(300,0),this.treeCreate(360,770),this.treeCreate(0,384),this.treeCreate(590,448)),stage-100*Math.floor(stage/100)==60&&0==bossTreeBeastKilled&&(this.treeBeastCreate(64,64),this.treeBeastCreate(448,54),this.treeBeastCreate(704,74),this.treeBeastCreate(192,128),this.treeBeastCreate(458,138),this.treeBeastCreate(438,192),this.treeBeastCreate(640,182),this.treeBeastCreate(128,256),this.treeBeastCreate(384,266),this.treeBeastCreate(128,320),this.treeBeastCreate(694,310),this.treeBeastCreate(512,384),this.treeBeastCreate(320,448),this.treeBeastCreate(650,512),baddieCreated=baddieTotal,baddieCount-=.1*stageMilestone,this.treeCreate(256,64),this.treeCreate(576,256),this.treeCreate(64,384),this.treeCreate(704,448),this.treeCreate(128,512),this.treeCreate(448,512),sceneryCount=28),stage-100*Math.floor(stage/100)==70&&0==bossSkeletonKilled&&(this.skeletonCreate(750,200,"redBoss"),flameShot=game.add.audio("flameShot"),baddieCreated=baddieTotal),stage-100*Math.floor(stage/100)==80&&0==bossZombieBirdKilled&&(this.bossZombieBirdCreate(750,200),baddieCreated=baddieTotal),stage-100*Math.floor(stage/100)==90&&0==bossMummyKilled&&(this.bossMummyCreate(750,200),baddieCreated=baddieTotal);baddieCreated<baddieTotal;){var e=array[Math.floor(Math.random()*array.length-1)];if(nullArray.indexOf(e)>=0);else if(array.indexOf(e)>=0&&Math.random()>.85-.01*stage){o=e%13,o<1&&(o=13);var a=64*(o-1),t=64*Math.floor((array[e]-1)/13);(t<0||t.isNaN)&&(t=0),Math.random()>.6&&baddieTotal>11&&.1*(baddieTotal-baddieCreated)>9?(this.vampireCreate(a,t),baddieCreated+=11,s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.6&&baddieTotal>10&&.13*(baddieTotal-baddieCreated)>9&&evilwizardCount<1?(this.evilwizardCreate(a,t),baddieCreated+=10,evilwizardCount++,beamSFX=game.add.audio("shotSFX"),s=array.indexOf(e),s>-1&&array.splice(s,1)):"wasteland"==backgroundScene&&baddieTotal>9&&.13*(baddieTotal-baddieCreated)>7.5?(this.treeBeastCreate(a,t),baddieCreated+=9,s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.55&&baddieTotal>9&&.13*(baddieTotal-baddieCreated)>7.5&&swampCreatureCount<1?(this.swampCreatureCreate(a,t),baddieCreated+=9,swampCreatureCount++,waterShotSFX=game.add.audio("bubble"),s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.5&&baddieTotal>8&&.14*(baddieTotal-baddieCreated)>6.5&&zombieBirdCount<=5?(this.zombieBirdCreate(a,t),baddieCreated+=8,zombieBirdCount++,s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.45&&baddieTotal>7&&.15*(baddieTotal-baddieCreated)>5.5?(this.mummyCreate(a,t),baddieCreated+=7,s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.4&&baddieTotal>6&&.2*(baddieTotal-baddieCreated)>5.5&&flameCount<=2?(this.flameCreate(a,t),baddieCreated+=6,flameCount+=1,flameShot=game.add.audio("flameShot"),s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.3&&baddieTotal>baddieCreated&&baddieTotal>5&&.17*(baddieTotal-baddieCreated)>3.5?(100*Math.random()>117-stage?this.skeletonCreate(a,t,"red"):this.skeletonCreate(a,t,"grey"),baddieCreated+=5,s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.25&&baddieTotal>baddieCreated&&baddieTotal>4&&.14*(baddieTotal-baddieCreated)>2?(100*Math.random()>108-stage?this.swordZombieCreate(a,t,"red"):this.swordZombieCreate(a,t,"green"),baddieCreated+=4,s=array.indexOf(e),s>-1&&array.splice(s,1)):Math.random()>.2&&baddieTotal>baddieCreated&&baddieTotal>3&&.2*(baddieTotal-baddieCreated)>2?(this.spiderCreate(a,t),baddieCreated+=3,s=array.indexOf(e),s>-1&&array.splice(s,1)):baddieTotal>baddieCreated&&(100*Math.random()>96-stage?this.baddieCreate(a,t,"red"):this.baddieCreate(a,t,"green"),baddieCreated++,s=array.indexOf(e),s>-1&&array.splice(s,1))}}for(stars=game.add.group(),stars.enableBody=!0,collectSFX=game.add.audio("collect");chestCreated+1<starTotal;){var i=780*Math.random(.05,1),r=580*Math.random(.1,1);starTotal-chestCreated>20?(this.coinCreate(i,r,"yellow"),chestCreated+=25):starTotal-chestCreated>10?(this.coinCreate(i,r,"green"),chestCreated+=10):starTotal-chestCreated>4?(this.coinCreate(i,r,"blue"),chestCreated+=5):(this.coinCreate(i,r,"red"),chestCreated+=2)}for(var e=0;e<117;e++)if(array.indexOf(e)>=0&&array[e]>14&&array[e]<117&&array[e]%13>1&&sceneryCount<28){var o=array[e]%13;o<1&&(o=13);var s,l=64*(o-1)+Math.round(10*Math.random()),d=64*Math.floor((array[e]-1)/13)+Math.round(10*Math.random()),m=1+(1-sceneryCount/28)+.001*stage;if(Math.random()<.1*m){if("wasteland"==backgroundScene){var n=platforms.create(l,d,"tree");n.body.setSize(35,20,0,33),n.body.immovable=!0,n.Shadow=n.addChild(game.add.sprite(-18,11,"treeShadow")),n.Shadow.alpha=.35}else if("ruins"==backgroundScene){var h=platforms.create(l,d,"statue");h.body.setSize(30,24,1,45),h.body.immovable=!0,h.frame=Math.floor(4.99*Math.random())}else{var c=platforms.create(l,d,"largeTree");c.body.setSize(36,21,10,50),c.body.immovable=!0}sceneryCount++,s=array.indexOf(e),s>-1&&array.splice(s,1)}else if(Math.random()>1-.1*m){if("wasteland"==backgroundScene){var p=platforms.create(l,d,"rock");p.body.immovable=!0,p.body.setSize(32,17,0,9)}else if("ruins"==backgroundScene){var y=platforms.create(l,d-8,"pillars");y.body.immovable=!0,y.body.setSize(32,32,0,64),y.frame=Math.floor(2.99*Math.random())}else{var b=platforms.create(l,d,"forestScenery");b.body.setSize(23,16,4,4),b.body.immovable=!0,b.frame=Math.floor(2.99*Math.random())}sceneryCount++,s=array.indexOf(e),s>-1&&array.splice(s,1)}else if(Math.random()>=.2&&Math.random()<.3*(m/3)){if("wasteland"==backgroundScene){var u=platforms.create(l,d,"gravestone");u.body.immovable=!0,u.body.setSize(19,10,0,18)}else if("ruins"==backgroundScene)h=platforms.create(l,d,"statue"),h.body.setSize(30,18,1,45),h.body.immovable=!0,h.frame=Math.floor(4.99*Math.random());else{var c=platforms.create(l,d,"largeTree");c.body.setSize(36,21,10,50),c.body.immovable=!0}sceneryCount++,s=array.indexOf(e),s>-1&&array.splice(s,1)}else if(28-sceneryCount>=116-array[e]){if("wasteland"==backgroundScene)n=platforms.create(l,d,"tree"),n.body.setSize(35,20,0,33),n.body.immovable=!0,n.Shadow=n.addChild(game.add.sprite(-18,11,"treeShadow")),n.Shadow.alpha=.35;else if("ruins"==backgroundScene)y=platforms.create(l,d-8,"pillars"),y.body.immovable=!0,y.body.setSize(32,32,0,64),y.frame=Math.floor(2.99*Math.random());else{var b=platforms.create(l,d,"forestScenery");b.body.setSize(23,16,4,4),b.body.immovable=!0,b.frame=Math.floor(2.99*Math.random())}sceneryCount++,s=array.indexOf(e),s>-1&&array.splice(s,1)}}if(cursors=game.input.keyboard.createCursorKeys(),fireButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),dKey=game.input.keyboard.addKey(Phaser.Keyboard.D),qKey=game.input.keyboard.addKey(Phaser.Keyboard.Q),1==beamUnlockShown){beamSprite=game.add.sprite(223,597,"beamIcon"),beamSprite.frame=1;var g={font:"18px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};beamText=game.add.text(230,604,"SPACE",g)}if(1==manaRefillUnlockShown){bottleSprite=game.add.sprite(535,597,"bottle"),bottleSprite.frame=1;var v={font:"24px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};bottleText=game.add.text(543,601,"Q",v)}resultBackground=game.add.sprite(-1e3,150,"scrollStrip"),levelRecordBackground=game.add.sprite(-1e3,370,"scrollStrip"),resultText=game.add.bitmapText(205,160,"font","",24),resultText2=game.add.bitmapText(250,190,"font","",18),resultText3=game.add.bitmapText(125,215,"font","",18),levelRecord=game.add.bitmapText(325,380,"font","",24),levelRecord2=game.add.bitmapText(310,410,"font","",18),levelRecord3=game.add.bitmapText(220,435,"font","",18)},update:function(){game.physics.arcade.collide(player,platforms),game.physics.arcade.collide(baddies,baddies),game.physics.arcade.collide(baddies,flames),game.physics.arcade.collide(flames,flames),game.physics.arcade.collide(skeletons,baddies),70!=stage&&game.physics.arcade.collide(skeletons,flames),game.physics.arcade.collide(skeletons,skeletons),game.physics.arcade.collide(mummies,baddies),game.physics.arcade.collide(mummies,flames),game.physics.arcade.collide(mummies,skeletons),game.physics.arcade.collide(mummies,spiders),game.physics.arcade.collide(mummies,mummies),game.physics.arcade.collide(vampires,baddies),game.physics.arcade.collide(vampires,flames),game.physics.arcade.collide(vampires,skeletons),game.physics.arcade.collide(vampires,spiders),game.physics.arcade.collide(vampires,mummies),game.physics.arcade.collide(vampires,vampires),game.physics.arcade.collide(vampires,decoys),game.physics.arcade.collide(swordZombies,baddies),game.physics.arcade.collide(swordZombies,flames),game.physics.arcade.collide(swordZombies,skeletons),game.physics.arcade.collide(swordZombies,spiders),game.physics.arcade.collide(swordZombies,mummies),game.physics.arcade.collide(swordZombies,vampires),game.physics.arcade.collide(swordZombies,decoys),game.physics.arcade.collide(decoys,baddies),game.physics.arcade.collide(decoys,flames),game.physics.arcade.collide(decoys,skeletons),game.physics.arcade.collide(decoys,spiders),game.physics.arcade.collide(decoys,mummies),game.physics.arcade.collide(decoys,decoys),game.physics.arcade.collide(spiders,baddies),game.physics.arcade.collide(spiders,spiders),game.physics.arcade.collide(spiders,flames),game.physics.arcade.collide(spiders,skeletons),game.physics.arcade.collide(zombieBirds,zombieBirds),game.physics.arcade.overlap(player,stars,this.collectStar,null,this),game.physics.arcade.overlap(door,stars,this.collectStar,null,this),baddieCount<=0&&game.physics.arcade.collide(player,door,this.doorOpen,null,this),game.time.now>invulnerableTimer?(player.alpha=1,game.physics.arcade.overlap(player,baddies,this.badTouch,null,this),game.physics.arcade.overlap(player,swordZombies,this.badTouch,null,this),game.physics.arcade.overlap(player,bossZombies,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,bossZombieBirds,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,bossMummies,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,bossFinals,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,flames,this.badTouch,null,this),game.physics.arcade.overlap(player,flameBullets,this.badTouch,null,this),game.physics.arcade.overlap(player,skeletons,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,mummies,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,iceBeams,this.badTouch,null,this),game.physics.arcade.overlap(player,iceBeams,this.freeze,null,this),game.physics.arcade.overlap(player,waterShots,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,zombieBirds,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,miniZombieBirds,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,spiders,this.badTouch,null,this),game.physics.arcade.overlap(player,treeBeasts,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,evilRoots,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,vampires,this.badTouchTwo,null,this),game.physics.arcade.overlap(player,decoys,this.badTouch,null,this),game.physics.arcade.overlap(player,swampCreatures,this.badTouch,null,this)):player.alpha=.5,game.physics.arcade.collide(bullets,baddies,this.badKill,null,this),game.physics.arcade.collide(bullets,bossZombies,this.bossZombieKill,null,this),game.physics.arcade.collide(bullets,bossZombieBirds,this.bossZombieBirdKill,null,this),game.physics.arcade.collide(bullets,bossMummies,this.bossMummyKill,null,this),game.physics.arcade.collide(bullets,bossFinals,this.bossFinalKill,null,this),game.physics.arcade.collide(bullets,flames,this.flameKill,null,this),game.physics.arcade.collide(bullets,skeletons,this.skeletonKill,null,this),game.physics.arcade.collide(bullets,mummies,this.mummyKill,null,this),game.physics.arcade.collide(bullets,spiders,this.spiderKill,null,this),game.physics.arcade.collide(bullets,evilwizards,this.evilwizardKill,null,this),game.physics.arcade.collide(bullets,swampCreatures,this.swampCreatureKill,null,this),game.physics.arcade.collide(bullets,zombieBirds,this.zombieBirdKill,null,this),game.physics.arcade.collide(bullets,miniZombieBirds,this.miniZombieBirdKill,null,this),game.physics.arcade.collide(bullets,platforms,this.bulletKill,null,this),game.physics.arcade.collide(bullets,treeBeasts,this.treeBeastKill,null,this),game.physics.arcade.collide(bullets,swordZombies,this.swordZombieKill,null,this),game.physics.arcade.collide(bullets,vampires,this.vampireKill,null,this),game.physics.arcade.collide(bullets,decoys,this.decoyKill,null,this),game.physics.arcade.overlap(skeletons,platforms,this.skeletonSmash,null,this),game.physics.arcade.overlap(mummies,platforms,this.mummySmash,null,this),game.physics.arcade.overlap(bossZombies,platforms,this.bossZombieSmash,null,this),game.physics.arcade.overlap(bossZombieBirds,platforms,this.bossZombieBirdSmash,null,this),game.physics.arcade.overlap(bossMummies,platforms,this.bossMummySmash,null,this),game.physics.arcade.overlap(spiders,platforms,this.spiderClimb,null,this),game.physics.arcade.collide(swordZombies,platforms,this.swordZombieSteer,null,this),game.physics.arcade.overlap(platforms,stars,this.moveStar,null,this),game.physics.arcade.overlap(platforms,flames,this.moveFlame,null,this),game.physics.arcade.overlap(platforms,evilwizards,this.moveEvilWizard,null,this),player.body.velocity.x=0,player.body.velocity.y=0,aKey.isDown?(player.body.velocity.x=-(runSpeed+runSpeedEndLevelAdjust),player.animations.play("left"),facing="left",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):dKey.isDown?(player.body.velocity.x=runSpeed+runSpeedEndLevelAdjust,player.animations.play("right"),facing="right",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):wKey.isDown?(player.body.velocity.y=-(runSpeed+runSpeedEndLevelAdjust),player.animations.play("up"),facing="up",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):sKey.isDown?(player.body.velocity.y=runSpeed+runSpeedEndLevelAdjust,player.animations.play("down"),facing="down",manaRegenInterval=manaRegenHolder-manaRegenEndLevelAdjust):(player.animations.stop(),manaRegenInterval=.25*(manaRegenHolder-manaRegenEndLevelAdjust)),fireButton.isDown&&1==beamWeapon&&this.beamWeaponActivate(),qKey.isDown&&1==manaRefillAvailable&&this.manaRefillActivate(),(cursors.right.isDown||cursors.left.isDown||cursors.up.isDown||cursors.down.isDown)&&game.time.now>bulletTimer&&player.isAlive&&mana>=manaCost&&(this.fire(),mana-=manaCost,manaText.text="MP: "+mana+"/"+maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop()),this.baddieUpdate(),this.spiderUpdate(),this.flameUpdate(),this.skeletonUpdate(),this.mummyUpdate(),this.evilwizardUpdate(),this.zombieBirdUpdate(),(zombieBirdCount>0||stage-100*Math.floor(stage/100)==80)&&this.miniZombieBirdUpdate(),this.swampCreatureUpdate(),this.treeBeastUpdate(),this.evilRootUpdate(),this.bossZombieUpdate(),this.bossZombieBirdUpdate(),this.bossMummyUpdate(),this.bossFinalUpdate(),this.manaRegen(),this.swordZombieUpdate(),this.adTimeUpdate(),this.vampireUpdate(),this.decoyUpdate(),this.beamTimerUpdate(),this.manaRefillTimerUpdate()},render:function(){game.debug.text(game.time.fps,800,14,"#00ff00")},baddieCreate:function(e,a,t){if("green"==t){var i=baddies.create(e,a,"baddie");i.health=4*baddieHpAdjuster,i.maxHealth=4*baddieHpAdjuster,i.colour="green"}else if("red"==t){var i=baddies.create(e,a,"zombieRed");i.health=6*baddieHpAdjuster,i.maxHealth=6*baddieHpAdjuster,i.colour="red"}game.physics.arcade.enable(i),i.body.collideWorldBounds=!0,i.healthBarBack=i.addChild(game.add.graphics(0,0)),i.healthBarBack.lineStyle(3,12203264,1),i.healthBarBack.moveTo(0,0),i.healthBarBack.lineTo(20,0),i.healthBar=i.addChild(game.add.graphics(0,0)),i.healthBar.lineStyle(3,16767232,1),i.healthBar.moveTo(0,0),i.healthBar.lineTo(20*(i.health/i.maxHealth),0),i.healthBarBack.visible=!1,i.healthBar.visible=!1,i.animations.add("baddieLeft",[0,1,2],15,!0),i.animations.add("baddieRight",[3,4,5],15,!0)},baddieUpdate:function(){baddies.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),"green"==e.colour?game.physics.arcade.moveToObject(e,player,130*baddieSpeedAdjuster):"red"==e.colour&&game.physics.arcade.moveToObject(e,player,155*baddieSpeedAdjuster),player.body.x<e.body.x?e.animations.play("baddieLeft"):e.animations.play("baddieRight")})},bossZombieCreate:function(e,a,t){if("green"==t){var i=bossZombies.create(e,a,"bossZombie");i.health=325*baddieHpAdjuster,i.maxHealth=325*baddieHpAdjuster,i.colour="green"}else"red"==t&&(i=bossZombies.create(e,a,"zombieRed"),i.health=400*baddieHpAdjuster,i.maxHealth=400*baddieHpAdjuster,i.colour="red");game.physics.arcade.enable(i),i.body.collideWorldBounds=!0,i.timer=game.time.now,i.interval=3e3,i.damageTimer=0,i.healthBarBack=i.addChild(game.add.graphics(0,0)),i.healthBarBack.lineStyle(3,12203264,1),i.healthBarBack.moveTo(0,0),i.healthBarBack.lineTo(20,0),i.healthBar=i.addChild(game.add.graphics(0,0)),i.healthBar.lineStyle(3,16767232,1),i.healthBar.moveTo(0,0),i.healthBar.lineTo(20*(i.health/i.maxHealth),0),i.healthBarBack.visible=!1,i.healthBar.visible=!1,i.animations.add("bossZombieLeft",[0,1,2],5,!0),i.animations.add("bossZombieRight",[3,4,5],5,!0)},bossZombieUpdate:function(){bossZombies.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),"green"==e.colour?game.physics.arcade.moveToObject(e,player,160*baddieSpeedAdjuster-e.health/baddieHpAdjuster*.1):"red"==e.colour&&game.physics.arcade.moveToObject(e,player,200*baddieSpeedAdjuster-e.health/baddieHpAdjuster*.1),player.body.x<e.body.x?e.animations.play("bossZombieLeft"):e.animations.play("bossZombieRight")})},bossZombieSmash:function(e,a){a.destroy();var t=game.add.audio("woodSmash");t.play();var i=this;game.time.events.add(.6*Phaser.Timer.SECOND,function(){i.rubbleCreate(a.x,a.y)})},rubbleCreate:function(e,a){var t=platforms.create(e,a,"rubble");t.body.setSize(32,16,0,16),t.body.immovable=!0},spiderCreate:function(e,a){var t=spiders.create(e,a,"spider");t.health=11*baddieHpAdjuster,t.maxHealth=11*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.collide=!1,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("spiderLeft",[6,7,8,9,10,11],10,!0),t.animations.add("spiderRight",[18,19,20,21,22,23],10,!0),t.animations.add("climbUp",[0,1,2,3,4,5],10,!0),t.animations.add("climbDown",[12,13,14,15,16,17],10,!0)},spiderUpdate:function(){spiders.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,e.collide?(game.physics.arcade.moveToObject(e,player,60*baddieSpeedAdjuster-e.health/baddieHpAdjuster),player.y>e.y?e.animations.play("climbDown"):e.animations.play("climbUp")):(game.physics.arcade.moveToObject(e,player,146*baddieSpeedAdjuster-2*e.health/baddieHpAdjuster),player.body.x<e.body.x?e.animations.play("spiderLeft"):e.animations.play("spiderRight"))})},spiderClimb:function(e){e.collide=!0,game.time.events.add(.5*Phaser.Timer.SECOND,function(){e.collide=!1})},swordZombieCreate:function(e,a,t){if("green"==t){var i=swordZombies.create(e,a,"swordZombie");i.health=14*baddieHpAdjuster,i.maxHealth=14*baddieHpAdjuster,i.colour="green"}else"red"==t&&(i=swordZombies.create(e,a,"swordZombie"),i.health=23*baddieHpAdjuster,i.maxHealth=23*baddieHpAdjuster,i.colour="red");game.physics.arcade.enable(i),i.body.collideWorldBounds=!0,i.isAlive=!0,i.collide=!1,i.collideTimer=0,i.healthBarBack=i.addChild(game.add.graphics(0,0)),i.healthBarBack.lineStyle(3,12203264,1),i.healthBarBack.moveTo(0,0),i.healthBarBack.lineTo(20,0),i.healthBar=i.addChild(game.add.graphics(0,0)),i.healthBar.lineStyle(3,16767232,1),i.healthBar.moveTo(0,0),i.healthBar.lineTo(20*(i.health/i.maxHealth),0),i.healthBarBack.visible=!1,i.healthBar.visible=!1,i.animations.add("swordZombieLeft",[0,1,2],15,!0),i.animations.add("swordZombieRight",[3,4,5],15,!0),i.animations.add("swordZombieLeftRed",[6,7,8],15,!0),i.animations.add("swordZombieRightRed",[9,10,11],15,!0)},swordZombieUpdate:function(){swordZombies.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),"green"==e.colour?(0==e.collide?game.physics.arcade.moveToObject(e,player,140*baddieSpeedAdjuster):game.physics.arcade.moveToXY(e,832-player.x+e.x,640-player.y+e.y,40),player.body.x<e.body.x?e.animations.play("swordZombieLeft"):e.animations.play("swordZombieRight")):"red"==e.colour&&(0==e.collide?game.physics.arcade.moveToObject(e,player,165*baddieSpeedAdjuster):game.physics.arcade.moveToXY(e,832-player.x+e.x,640-player.y+e.y,40),player.body.x<e.body.x?e.animations.play("swordZombieLeftRed"):e.animations.play("swordZombieRightRed"))})},swordZombieSteer:function(e){0==e.collide&&game.time.now>e.collideTimer&&(e.collideTimer=game.time.now+3e3,e.collide=!0,game.time.events.add(.65*Phaser.Timer.SECOND,function(){e.collide=!1}))},skeletonCreate:function(e,a,t){if("grey"==t){var i=skeletons.create(e,a,"skeleton");i.health=18*baddieHpAdjuster,i.maxHealth=18*baddieHpAdjuster,i.colour="grey"}else"red"==t?(i=skeletons.create(e,a,"skeleton"),i.health=28*baddieHpAdjuster,i.maxHealth=28*baddieHpAdjuster,i.colour="red",i.tint=12203264):"redBoss"==t&&(i=skeletons.create(e,a,"skeleton"),i.health=325*baddieHpAdjuster,i.maxHealth=325*baddieHpAdjuster,i.colour="redBoss",i.tint=12203264,i.scale.x=2.5,i.scale.y=2.5,i.bossTimer=0,i.bossDamageTimer=0,i.isAlive=!0);game.physics.arcade.enable(i),i.body.collideWorldBounds=!0,i.collide=!1,i.healthBarBack=i.addChild(game.add.graphics(0,0)),i.healthBarBack.lineStyle(3,12203264,1),i.healthBarBack.moveTo(0,0),i.healthBarBack.lineTo(20,0),i.healthBar=i.addChild(game.add.graphics(0,0)),i.healthBar.lineStyle(3,16767232,1),i.healthBar.moveTo(0,0),i.healthBar.lineTo(20*(i.health/i.maxHealth),0),i.healthBarBack.visible=!1,i.healthBar.visible=!1,i.animations.add("skeletonLeft",[3,4,5],10,!0),i.animations.add("skeletonRight",[6,7,8],10,!0),i.animations.add("stomp",[0,1,2],10,!0),i.animations.add("smash",[9,10],10,!0)},skeletonUpdate:function(){var e=this;skeletons.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),a.collide?(a.animations.stop(),a.animations.play("smash")):Math.abs(player.x-a.x)+Math.abs(player.y-a.y)<275||"redBoss"==a.colour?("grey"==a.colour?game.physics.arcade.moveToObject(a,player,178*baddieSpeedAdjuster-2*a.health/baddieHpAdjuster):"red"==a.colour?game.physics.arcade.moveToObject(a,player,232*baddieSpeedAdjuster-2*a.health/baddieHpAdjuster):"redBoss"==a.colour&&game.physics.arcade.moveToObject(a,player,190*baddieSpeedAdjuster-.1*a.health/baddieHpAdjuster),player.body.x<a.body.x?a.animations.play("skeletonLeft"):a.animations.play("skeletonRight")):a.health<a.maxHealth?("grey"==a.colour?game.physics.arcade.moveToObject(a,player,175*baddieSpeedAdjuster-2*a.health/baddieHpAdjuster):"red"==a.colour&&game.physics.arcade.moveToObject(a,player,223*baddieSpeedAdjuster-2*a.health/baddieHpAdjuster),player.body.x<a.body.x?a.animations.play("skeletonLeft"):a.animations.play("skeletonRight")):a.animations.play("stomp"),"redBoss"==a.colour&&a.bossTimer<game.time.now&&flameCount<3&&a.isAlive&&(e.flameCreate(a.x,a.y),flameCount++,baddieCount+=6,a.bossTimer=game.time.now+2e3)})},skeletonSmash:function(e,a){e.collide=!0,game.time.events.add(.5*Phaser.Timer.SECOND,function(){a.destroy();var t=game.add.audio("woodSmash");t.play(),e.collide=!1})},mummyCreate:function(e,a){if("wasteland"==backgroundScene){var t=mummies.create(e,a,"mummy");t.animations.add("mummyLeft",[9,10,11],10,!0),t.animations.add("mummyRight",[3,4,5],10,!0),t.animations.add("smash",[12,7],10,!0)}else{var t=mummies.create(e,a,"golem");t.animations.add("golemLeft",[9,10,11],10,!0),t.animations.add("golemRight",[6,7,8],10,!0),t.animations.add("smashLeft",[10,12],4,!0),t.animations.add("smashRight",[7,13],4,!0)}t.health=35*baddieHpAdjuster,t.maxHealth=35*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.collide=!1,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1},mummyUpdate:function(){mummies.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),e.collide?(e.animations.stop(),"wasteland"==backgroundScene?e.animations.play("smash"):e.x<player.x?e.animations.play("smashRight"):e.animations.play("smashLeft")):(baddieCount/baddieTotal<.75||Math.abs(player.x-e.x)+Math.abs(player.y-e.y)<150?game.physics.arcade.moveToObject(e,player,210*baddieSpeedAdjuster-4*e.health/baddieHpAdjuster):player.y<320?game.physics.arcade.moveToXY(e,player.x,player.y+150,225-4*e.health):game.physics.arcade.moveToXY(e,player.x,player.y-150,225-4*e.health),player.body.x<e.body.x?"wasteland"==backgroundScene?e.animations.play("mummyLeft"):e.animations.play("golemLeft"):"wasteland"==backgroundScene?e.animations.play("mummyRight"):e.animations.play("golemRight"))})},mummySmash:function(e,a){e.collide=!0,game.time.events.add(.5*Phaser.Timer.SECOND,function(){a.destroy();var t=game.add.audio("woodSmash");t.play(),e.collide=!1})},flameCreate:function(e,a){var t=flames.create(e,a,"flame");t.health=15*baddieHpAdjuster,t.maxHealth=15*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.body.immovable=!0,t.isAlive=!0,t.timer=10+1200*Math.random(),t.animations.add("flicker",[0,1,2,3,4,5,6,7,8,9,10,11],10,!0),t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1},flameUpdate:function(){flames.forEach(function(e){if(e.animations.play("flicker"),game.time.now>e.timer&&e.isAlive){
var a=flameBullets.create(e.x,e.y,"flame");a.animations.add("fire",[0],!0),game.physics.arcade.moveToXY(a,player.x,player.y,160),a.lifespan=6900,a.animations.play("fire"),e.timer=game.time.now+flameBulletSpacing,flameShot.play()}})},treeBeastCreate:function(e,a){var t=treeBeasts.create(e,a,"treeBeast");t.health=44*baddieHpAdjuster,t.maxHealth=44*baddieHpAdjuster,t.frame=0,t.shadow=t.addChild(game.add.sprite(17,11,"treeShadow")),t.shadow.alpha=.35,game.physics.arcade.enable(t),t.body.immovable=!0,t.isAlive=!0,t.active=!1,t.animations.add("reveal",[0,1,2],3,!1),t.animations.add("wiggle",[3,4,5,5,4,3],10,!0),t.rootTimer=game.time.now+1e3+5e3*Math.random(),t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1},evilRootWarning:function(e,a){var t=game.add.sprite(e,a,"evilRoot");t.animations.add("sprout",[0,0,0,1,2,3],4,!1),t.animations.play("sprout");var i=this;game.time.events.add(1.5*Phaser.Timer.SECOND,function(){t.destroy(),i.evilRootCreate(t.x,t.y)})},treeBeastUpdate:function(){var e=this;treeBeasts.forEach(function(a){if(1==a.active?a.animations.play("wiggle"):(Math.abs(player.x-(a.x+52))+Math.abs(player.y-(a.y+26))<110||a.health<a.maxHealth)&&0==a.active&&(a.animations.play("reveal"),game.time.events.add(1*Phaser.Timer.SECOND,function(){a.animations.stop(),a.active=!0,a.animations.play("wiggle")})),a.isAlive&&a.rootTimer<game.time.now){var t=Math.floor(20*Math.random())-10,i=t+player.x,r=t+player.y;e.evilRootWarning(i,r),a.rootTimer=game.time.now+15e3*Math.random()}})},evilRootCreate:function(e,a){var t=evilRoots.create(e,a,"evilRoot");t.animations.add("wave",[4,3,5,3,4],10,!0),t.animations.add("retreat",[3,2,1,0],4,!1),t.timer=game.time.now+5e3},evilRootUpdate:function(){evilRoots.forEach(function(e){e.timer>game.time.now?e.animations.play("wave"):(e.animations.play("retreat"),game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy()}))})},evilwizardCreate:function(e,a){var t=evilwizards.create(e,a,"evilWizard");t.health=37*baddieHpAdjuster,t.maxHealth=37*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.timer=game.time.now,t.chargeTimer=game.time.now+1e3,t.shotTimer=game.time.now+3e3,t.sfxTimer=t.shotTimer,t.stopTimer=game.time.now+7e3,t.isAlive=!0,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1},evilwizardUpdate:function(){evilwizards.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms);var a=0,t=0;if(a=player.x<400?player.x+100:player.x-100,t=player.y<300?player.y+100:player.y-100,game.time.now>e.timer&&e.isAlive){var i=game.add.audio("teleport");i.play(),e.x=a,e.y=t,e.timer=game.time.now+1e4}if(game.time.now>e.chargeTimer&&e.isAlive){if(4==e.frame)var r=game.add.sprite(16,18,"blueCharge");else r=game.add.sprite(0,18,"blueCharge");r.animations.add("chargeUp",[0,1,2,3,4,4],2,!1),r.animations.play("chargeUp"),e.addChild(r),e.chargeTimer=game.time.now+1e4,game.time.events.add(3*Phaser.Timer.SECOND,function(){e.removeChild(r),r.destroy()})}if(game.time.now>e.sfxTimer&&e.isAlive&&(beamSFX.play(),e.sfxTimer=game.time.now+1e4),game.time.now>e.shotTimer&&e.isAlive){var o=iceBeams.getFirstExists(!1);12==e.frame||4==e.frame?o.reset(e.x+12,e.y+12):o.reset(e.x+22,e.y+28),o.pivot.setTo(.25,.5),o.animations.add("beam",[0,1,2,3],4,!1),game.physics.arcade.moveToXY(o,player.x,player.y,600),o.rotation=game.physics.arcade.moveToXY(o,player.x,player.y,600),o.lifespan=1650,o.animations.play("beam"),e.shotTimer=game.time.now+120,game.time.events.add(4*Phaser.Timer.SECOND,function(){iceBeams.forEach(function(e){e.kill()})})}game.time.now>e.stopTimer&&(e.shotTimer=game.time.now+6e3,e.sfxTimer=e.shotTimer,e.stopTimer=game.time.now+1e4),player.body.x<e.body.x?e.shotTimer<game.time.now+121?e.frame=17:e.frame=10:e.shotTimer<game.time.now+121?e.frame=12:e.frame=4})},swampCreatureCreate:function(e,a){var t=swampCreatures.create(e,a,"swampCreature");t.health=35*baddieHpAdjuster,t.maxHealth=35*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.crouchTimer=game.time.now,t.jumpTimer=game.time.now+2e3,t.shotTimer1=game.time.now+5e3,t.shotTimer2=game.time.now+5500,t.shotTimer3=game.time.now+6e3,t.shotTimer4=game.time.now+6500,t.shotTimer5=game.time.now+7e3,t.isAlive=!0,t.body.immovable=!0,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("swampCreatureLeft",[9,10,11],10,!0),t.animations.add("swampCreatureRight",[3,4,5],10,!0)},swampCreatureUpdate:function(){swampCreatures.forEach(function(e){if(game.time.now>e.crouchTimer&&e.isAlive&&(e.body.velocity.x=0,e.body.velocity.y=0,e.animations.stop(),e.frame=6,e.crouchTimer=game.time.now+1e4),game.time.now>e.jumpTimer&&e.isAlive&&(e.body.immovable=!1,e.body.velocity.x=0,e.body.velocity.y=0,e.frame=7,game.physics.arcade.moveToXY(e,player.x,player.y,350),e.jumpTimer=game.time.now+1e4),game.time.now>e.shotTimer1&&e.isAlive){e.body.immovable=!0,e.body.velocity.x=0,e.body.velocity.y=0,player.body.x<e.body.x?e.frame=10:e.frame=4;var a=waterShots.getFirstExists(!1);a.reset(e.x+10,e.y+10),a.lifespan=3500,game.physics.arcade.moveToXY(a,player.x+25,player.y+15,300),a.rotation=game.physics.arcade.moveToXY(a,player.x,player.y,300),waterShotSFX.play(),e.shotTimer1=game.time.now+1e4}game.time.now>e.shotTimer2&&e.isAlive&&(e.body.velocity.x=0,e.body.velocity.y=0,a=waterShots.getFirstExists(!1),a.reset(e.x+10,e.y+10),a.lifespan=3500,game.physics.arcade.moveToXY(a,player.x+15,player.y+25,300),a.rotation=game.physics.arcade.moveToXY(a,player.x,player.y,300),waterShotSFX.play(),e.shotTimer2=game.time.now+1e4),game.time.now>e.shotTimer3&&e.isAlive&&(e.body.velocity.x=0,e.body.velocity.y=0,a=waterShots.getFirstExists(!1),a.reset(e.x+10,e.y+10),a.lifespan=3500,game.physics.arcade.moveToXY(a,player.x+5,player.y-15,300),a.rotation=game.physics.arcade.moveToXY(a,player.x,player.y,300),waterShotSFX.play(),e.shotTimer3=game.time.now+1e4),game.time.now>e.shotTimer4&&e.isAlive&&(e.body.velocity.x=0,e.body.velocity.y=0,a=waterShots.getFirstExists(!1),a.reset(e.x+10,e.y+10),a.lifespan=3500,game.physics.arcade.moveToXY(a,player.x-15,player.y-25,300),a.rotation=game.physics.arcade.moveToXY(a,player.x,player.y,300),waterShotSFX.play(),e.shotTimer4=game.time.now+1e4),game.time.now>e.shotTimer5&&e.isAlive&&(e.body.velocity.x=0,e.body.velocity.y=0,a=waterShots.getFirstExists(!1),a.reset(e.x+10,e.y+10),a.lifespan=3500,game.physics.arcade.moveToXY(a,player.x-25,player.y+15,300),a.rotation=game.physics.arcade.moveToXY(a,player.x,player.y,300),waterShotSFX.play(),e.shotTimer5=game.time.now+1e4)})},zombieBirdCreate:function(e,a){var t=zombieBirds.create(e,a,"zombieBird");t.health=13*baddieHpAdjuster,t.maxHealth=13*baddieHpAdjuster,t.scale.x=.4,t.scale.y=.4,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.moveRight=!0,t.moveRightTimer=game.time.now,t.moveLeftTimer=game.time.now+5e3,t.moveUp=!0,t.moveUpTimer=game.time.now,t.moveDownTimer=game.time.now+3e3,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.scale.x=2.5,t.healthBarBack.scale.y=2.5,t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.scale.x=2.5,t.healthBar.scale.y=2.5,t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("zombieBirdLeft",[0,1,2,3],10,!0),t.animations.add("zombieBirdRight",[4,5,6,7],10,!0)},zombieBirdUpdate:function(){zombieBirds.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),game.time.now>e.moveRightTimer&&(e.moveRight=!0,e.moveRightTimer=game.time.now+1e4),game.time.now>e.moveLeftTimer&&(e.moveRight=!1,e.moveLeftTimer=game.time.now+1e4),game.time.now>e.moveUpTimer&&(e.moveUp=!0,e.moveUpTimer=game.time.now+6e3),game.time.now>e.moveDownTimer&&(e.moveUp=!1,e.moveDownTimer=game.time.now+6e3),Math.abs(player.x-e.x)+Math.abs(player.y-e.y)<250?(game.physics.arcade.moveToObject(e,player,146*baddieSpeedAdjuster-2*e.health/baddieHpAdjuster),player.body.x<e.body.x?e.animations.play("zombieBirdLeft"):e.animations.play("zombieBirdRight")):0==e.moveRight?(e.animations.play("zombieBirdLeft"),0==e.moveRight&&(e.body.velocity.x-=50,1==e.moveUp?e.body.velocity.y+=15:e.body.velocity.y-=15)):(e.animations.play("zombieBirdRight"),e.moveRight&&(e.body.velocity.x+=50,1==e.moveUp?e.body.velocity.y+=15:e.body.velocity.y-=15))})},miniZombieBirdCreate:function(e,a){var t=miniZombieBirds.getFirstExists(!1);t.reset(e,a),t.health=10*baddieHpAdjuster,t.maxHealth=10*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("miniZombieBirdLeft",[0,1,2,3],10,!0),t.animations.add("miniZombieBirdRight",[4,5,6,7],10,!0)},miniZombieBirdUpdate:function(){miniZombieBirds.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),game.physics.arcade.moveToObject(e,player,201*baddieSpeedAdjuster-2*e.health/baddieHpAdjuster),player.body.x<e.body.x?e.animations.play("miniZombieBirdLeft"):e.animations.play("miniZombieBirdRight")})},bossZombieBirdCreate:function(e,a){var t=bossZombieBirds.create(e,a,"zombieBird");t.health=400*baddieHpAdjuster,t.maxHealth=400*baddieHpAdjuster,t.damageTimer=0,t.createMiniTimer=0,t.isAlive=!0,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("bossZombieBirdLeft",[0,1,2,3],10,!0),t.animations.add("bossZombieBirdRight",[4,5,6,7],10,!0)},bossZombieBirdUpdate:function(){var e=this;bossZombieBirds.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),game.physics.arcade.moveToObject(a,player,150*baddieSpeedAdjuster-.1*a.health/baddieHpAdjuster),player.body.x<a.body.x?a.animations.play("bossZombieBirdLeft"):a.animations.play("bossZombieBirdRight"),game.time.now>a.createMiniTimer&&a.isAlive&&(e.miniZombieBirdCreate(a.x,a.y),a.createMiniTimer=game.time.now+3e3,baddieCount+=2)})},bossZombieBirdSmash:function(e,a){a.destroy();var t=game.add.audio("woodSmash");t.play();var i=this;game.time.events.add(.6*Phaser.Timer.SECOND,function(){i.rubbleCreate(a.x,a.y)})},bossMummyCreate:function(e,a){var t=bossMummies.create(e,a,"mummy");t.health=750*baddieHpAdjuster,t.maxHealth=750*baddieHpAdjuster,t.scale.x=2,t.scale.y=2,t.damageTimer=0,t.summonTimer=game.time.now+1e3,t.isAlive=!0,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("bossMummyLeft",[9,10,11],10,!0),t.animations.add("bossMummyRight",[3,4,5],10,!0),t.animations.add("bossMummySummon",[7,12,12,7,12,12,7,12,12,12,12],22,!0)},bossMummyUpdate:function(){var e=this;bossMummies.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms),game.time.now>a.summonTimer&&a.isAlive&&player.isAlive&&(a.summon=!0,e.risenZombieCreate(0,0),e.risenZombieCreate(200,0),e.risenZombieCreate(400,0),e.risenZombieCreate(600,0),e.risenZombieCreate(800,0),e.risenZombieCreate(0,600),e.risenZombieCreate(200,600),e.risenZombieCreate(400,600),e.risenZombieCreate(600,600),e.risenZombieCreate(800,600),a.summonTimer=game.time.now+7500,game.time.events.add(.5*Phaser.Timer.SECOND,function(){a.summon=!1})),0==a.summon?(game.physics.arcade.moveToObject(a,player,185*baddieSpeedAdjuster-.1*a.health/baddieHpAdjuster),player.body.x<a.body.x?a.animations.play("bossMummyLeft"):a.animations.play("bossMummyRight")):a.animations.play("bossMummySummon")})},bossMummySmash:function(e,a){a.destroy();var t=game.add.audio("woodSmash");t.play();var i=this;game.time.events.add(.6*Phaser.Timer.SECOND,function(){i.rubbleCreate(a.x,a.y)})},risenZombieCreate:function(e,a){var t=game.add.sprite(e,a,"zombieRising");t.animations.add("rise",[3,4,5],3,!1),t.animations.play("rise");var i=this;game.time.events.add(1*Phaser.Timer.SECOND,function(){i.zombieRisingSFX(),i.baddieCreate(t.x,t.y,"red"),t.destroy(),baddieCount++})},vampireCreate:function(e,a){var t=vampires.create(e,a,"vampire");t.health=44*baddieHpAdjuster,t.maxHealth=44*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.visible=!0,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("vampireLeft",[9,10,11],15,!0),t.animations.add("vampireRight",[3,4,5],15,!0)},vampireUpdate:function(){vampires.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),game.physics.arcade.moveToObject(e,player,155*baddieSpeedAdjuster),player.body.x<e.body.x?e.animations.play("vampireLeft"):e.animations.play("vampireRight")})},vampireEvade:function(){var e=this;vampires.forEach(function(a){a.visible=!1;var t=game.add.sprite(a.x,a.y,"smokeAnimation");if(t.animations.add("disperse",[0,1,2,3],16,!0),t.animations.play("disperse"),player.x<600)var i=75*(1+Math.random());else i=-75*(1+Math.random());if(player.y<450)var r=75*(1+Math.random());else r=-75*(1+Math.random());game.time.events.add(.25*Phaser.Timer.SECOND,function(){t.destroy(),t=game.add.sprite(player.x+i,player.y+r,"smokeAnimation"),t.animations.add("disperse",[0,1,2,3],16,!0),t.animations.play("disperse"),e.decoyCreate(t.x+.5*i,t.y-.5*r),e.decoyCreate(t.x-.5*i,t.y+.5*r)}),game.time.events.add(.5*Phaser.Timer.SECOND,function(){t.destroy(),a.visible=!0,a.x=t.x,a.y=t.y})})},decoyCreate:function(e,a){var t=game.add.sprite(e,a,"smokeAnimation");t.animations.add("disperse",[0,1,2,3],16,!0),t.animations.play("disperse"),game.time.events.add(.25*Phaser.Timer.SECOND,function(){t.destroy();var i=decoys.create(e,a,"vampire");game.physics.arcade.enable(i),i.body.collideWorldBounds=!0,i.visible=!0,i.animations.add("decoyLeft",[9,10,11],15,!0),i.animations.add("decoyRight",[3,4,5],15,!0)})},decoyUpdate:function(){decoys.forEach(function(e){e.body.velocity.x=0,e.body.velocity.y=0,game.physics.arcade.collide(e,platforms),game.physics.arcade.moveToObject(e,player,155*baddieSpeedAdjuster),player.body.x<e.body.x?e.animations.play("decoyLeft"):e.animations.play("decoyRight")})},bossFinalCreate:function(e,a){var t=bossFinals.create(e,a,"evilWizard");t.health=999*baddieHpAdjuster,t.maxHealth=999*baddieHpAdjuster,game.physics.arcade.enable(t),t.body.collideWorldBounds=!0,t.timer=game.time.now,t.chargeTimer=game.time.now+1e3,t.shotTimer=game.time.now+3e3,t.sfxTimer=t.shotTimer,t.stopTimer=game.time.now+7e3,t.summonTimer=game.time.now+8e3,t.damageTimer=0,t.summoned=!1,t.isAlive=!0,t.scale.x=2,t.scale.y=2,t.healthBarBack=t.addChild(game.add.graphics(0,0)),t.healthBarBack.lineStyle(3,12203264,1),t.healthBarBack.moveTo(0,0),t.healthBarBack.lineTo(20,0),t.healthBar=t.addChild(game.add.graphics(0,0)),t.healthBar.lineStyle(3,16767232,1),t.healthBar.moveTo(0,0),t.healthBar.lineTo(20*(t.health/t.maxHealth),0),t.healthBarBack.visible=!1,t.healthBar.visible=!1,t.animations.add("bossFinalLeft",[3,4,5],10,!0),t.animations.add("bossFinalRight",[6,7,8],10,!0),t.animations.add("bossFinalSummonLeft",[17,16,18,19],16,!1),t.animations.add("bossFinalSummonRight",[12,13,14,15],16,!1)},bossFinalUpdate:function(){var e=this;bossFinals.forEach(function(a){a.body.velocity.x=0,a.body.velocity.y=0,game.physics.arcade.collide(a,platforms);var t=0,i=0;if(t=player.x<400?player.x+100:player.x-100,i=player.y<300?player.y+100:player.y-100,game.time.now>a.timer&&a.isAlive){var r=game.add.audio("teleport");r.play(),a.x=t,a.y=i,a.timer=game.time.now+1e4}if(game.time.now>a.chargeTimer&&a.isAlive){if(4==a.frame)var o=game.add.sprite(16,18,"blueCharge");else o=game.add.sprite(0,18,"blueCharge");o.animations.add("chargeUp",[0,1,2,3,4,4],2,!1),o.animations.play("chargeUp"),a.addChild(o),a.chargeTimer=game.time.now+1e4,game.time.events.add(3*Phaser.Timer.SECOND,function(){a.removeChild(o),o.destroy()})}if(game.time.now>a.sfxTimer&&a.isAlive&&(beamSFX.play(),a.sfxTimer=game.time.now+1e4),game.time.now>a.shotTimer&&a.isAlive){var s=iceBeams.getFirstExists(!1);12==a.frame||4==a.frame?s.reset(a.x+42,a.y+36):s.reset(a.x+10,a.y+56),s.pivot.setTo(.25,.5),s.animations.add("beam",[0,1,2,3],4,!1),game.physics.arcade.moveToXY(s,player.x,player.y,600),s.rotation=game.physics.arcade.moveToXY(s,player.x,player.y,600),s.lifespan=1650,s.animations.play("beam"),a.shotTimer=game.time.now+120,game.time.events.add(4*Phaser.Timer.SECOND,function(){iceBeams.forEach(function(e){e.kill()})})}game.time.now>a.summonTimer&&a.isAlive&&0==a.summoned&&(player.body.x<a.body.x?a.animations.play("bossFinalSummonLeft"):a.animations.play("bossFinalSummonRight"),a.summoned=!0,game.time.events.add(.25*Phaser.Timer.SECOND,function(){e.bossFinalSummon(),a.summonTimer=game.time.now+9750,a.summoned=!1})),game.time.now>a.stopTimer&&(a.shotTimer=game.time.now+6e3,a.sfxTimer=a.shotTimer,a.stopTimer=game.time.now+1e4),player.body.x<a.body.x&&0==a.summoned?a.shotTimer<game.time.now+121?a.frame=17:a.frame=10:player.body.x>a.body.x&&0==a.summoned&&(a.shotTimer<game.time.now+121?a.frame=12:a.frame=4)})},bossFinalSummon:function(){Math.random()>.66?(this.mummyCreate(400,0),this.skeletonCreate(400,580,"grey"),this.swordZombieCreate(780,300,"green"),baddieCount+=16):Math.random()>.33?(this.baddieCreate(400,0,"red"),this.skeletonCreate(400,580,"red"),this.swordZombieCreate(780,300,"red"),baddieCount+=10):(this.mummyCreate(400,0),this.mummyCreate(400,580),baddieCount+=14)},coinCreate:function(e,a,t){var i;"red"==t?(i=stars.create(e,a,"ChestRed"),i.contents=2):"blue"==t?(i=stars.create(e,a,"ChestBlue"),i.contents=5):"green"==t?(i=stars.create(e,a,"ChestGreen"),i.contents=10):"yellow"==t&&(i=stars.create(e,a,"ChestYellow"),i.contents=25)},collectStar:function(e,a){collectSFX.play();var t=1+5*Math.random(),i=Math.round(a.contents+t*a.contents),r=game.add.sprite(a.x,a.y,"coin");r.animations.add("rotate",[0,1,2,3,4,5,6,7,8,9,10,11],12,!0),r.animations.play("rotate");var o=game.add.bitmapText(r.x+6,r.y+8,"font","",12);o.text=i,o.tint="black",game.time.events.add(1*Phaser.Timer.SECOND,function(){if(r.destroy(),o.destroy(),t>1.24);else if(t<=1.06){var e=game.add.sprite(r.x,r.y,"wand"),a=game.add.bitmapText(e.x-6,e.y+12,"fontBorder","",13);a.text="Weaponsmith +",weaponsmithDropReward+=weaponsmithDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy(),a.text=""})}else if(t<=1.12){var i=game.add.sprite(r.x,r.y,"armour"),s=game.add.bitmapText(i.x,i.y+12,"fontBorder","",13);s.text="Armourer +",armourerDropReward+=armourerDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){i.destroy(),s.text=""})}else if(t<=1.18){var l=game.add.sprite(r.x,r.y,"ring"),d=game.add.bitmapText(l.x-2,l.y+12,"fontBorder","",13);d.text="Enchanter +",enchanterDropReward+=enchanterDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){l.destroy(),d.text=""})}else if(t<=1.24){var m=game.add.sprite(r.x,r.y,"buff"),n=game.add.bitmapText(m.x+4,m.y+12,"fontBorder","",13);n.text="Trainer +",trainerDropReward+=trainerDRBoost,game.time.events.add(1*Phaser.Timer.SECOND,function(){m.destroy(),n.text=""})}}),coins+=i,coins>=1e6?coinsText.text=Math.round(coins/1e3)/1e3+"M":coinsText.text=coins,mana++,manaText.text="MP: "+mana+"/"+maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop(),a.destroy()},badTouch:function(){var e=Math.floor((1+stage/32)*baddieDamageAdjuster);if(health>e){health-=e,hpCrop.x=80*(1-health/maxHealth),hpBar.updateCrop();var a=game.add.audio("grunt");a.play(),healthText.text="HP: "+health+"/"+maxHealth,invulnerableTimer=game.time.now+invulnerableSpacing}else this.playerDeath()},badTouchTwo:function(){var e=Math.floor((2+.04*stage)*baddieDamageAdjuster);if(health>e){health-=e,hpCrop.x=80*(1-health/maxHealth),hpBar.updateCrop();var a=game.add.audio("grunt");a.play(),healthText.text="HP: "+health+"/"+maxHealth,invulnerableTimer=game.time.now+invulnerableSpacing,50==stage&&0==bossZombieKilled&&this.badTouch()}else this.playerDeath()},freeze:function(){game.time.now>freezeTimer&&(runSpeed=2*(runSpeed/3),freezeTimer=game.time.now+4e3,game.time.events.add(3*Phaser.Timer.SECOND,function(){runSpeed*=1.5}))},moveStar:function(e,a){a.y+=50},moveEvilWizard:function(e,a){a.x+=20},fire:function(){var e=bullets.getFirstExists(!1);e.reset(player.x+10,player.y+15),e.animations.add("spin",[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],13,!0);var a=game.add.emitter(game.world.centerX,game.world.centerY,20);a.makeParticles("bulletParticles",[0,1,2,3]),a.gravity.y=0,a.forEach(function(e){e.body.allowGravity=!1},this),a.start(!1,500,50),e.addChild(a),game.time.events.add(.5*Phaser.Timer.SECOND,function(){a.destroy()}),a.x=0,a.y=0,e.scale.x=.8,e.scale.y=.8,e.lifespan=832/shotSpeed*1e3,cursors.left.isDown?(game.physics.arcade.moveToXY(e,0,e.y,shotSpeed),e.animations.play("spin"),e.travel="left",a.minParticleSpeed.set(-shotSpeed,0),a.maxParticleSpeed.set(-shotSpeed,0),a.rotation=3.14,a.x=-14,a.y=-8):cursors.right.isDown?(game.physics.arcade.moveToXY(e,832,e.y,shotSpeed),e.animations.play("spin"),e.travel="right",a.minParticleSpeed.set(shotSpeed,0),a.maxParticleSpeed.set(shotSpeed,0),a.rotation=3.14,a.x=14,a.y=-8):cursors.up.isDown?(game.physics.arcade.moveToXY(e,e.x,0,shotSpeed),e.animations.play("spin"),e.travel="up",a.minParticleSpeed.set(0,-shotSpeed),a.maxParticleSpeed.set(0,-shotSpeed),a.rotation=3.14,a.x=-8,a.y=-14):cursors.down.isDown&&(game.physics.arcade.moveToXY(e,e.x,600,shotSpeed),e.animations.play("spin"),e.travel="down",a.minParticleSpeed.set(0,shotSpeed),a.maxParticleSpeed.set(0,shotSpeed),a.rotation=3.14,a.x=-8,a.y=14),pewSound.play(),bulletTimer=game.time.now+bulletSpacing},sizzleSFX:function(){var e=game.add.audio("sizzle");e.play()},skeletonDeathSFX:function(){var e=game.add.audio("skeletonDeath");e.play()},spiderDeathSFX:function(){var e=game.add.audio("spiderDeath");e.play()},mummyDeathSFX:function(){var e=game.add.audio("mummyDeath");e.play()},zombieRisingSFX:function(){var e=game.add.audio("zombieRising");e.play()},maleDeathSFX:function(){var e=game.add.audio("maleDeath");e.play()},birdDeathSFX:function(){var e=game.add.audio("birdDeath");e.play()},woodSmashSFX:function(){var e=game.add.audio("woodSmash");e.play()},smallExplosion:function(e,a){var t=game.add.sprite(e,a,"explosionMini");t.animations.add("explosion",[0,1,2,3],30,!1),t.animations.play("explosion"),shortExplodeSFX.play(),game.time.events.add(.2*Phaser.Timer.SECOND,function(){t.destroy()})},bulletKill:function(e){e.kill()},badKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=knockback:"right"==e.travel?a.x+=knockback:"up"==e.travel?a.y-=knockback:"down"==e.travel&&(a.y+=knockback)),e.kill(),a.health<=shotPower){if(Math.random()>.85&&"red"==a.colour?this.coinCreate(a.x+5,a.y+5,"blue"):Math.random()>.9?this.coinCreate(a.x+5,a.y+5,"blue"):this.coinCreate(a.x,a.y,"red"),Math.random()>.8){var t=game.add.sprite(a.x,a.y,"zombieRising");t.animations.add("rise",[0,1,2],3,!1),t.animations.play("rise");var i=this;game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy(),i.zombieRisingSFX(),i.baddieCreate(a.x,a.y,"green"),baddieCount++})}a.destroy(),zombieDeathSFX.play();var r=game.add.sprite(a.x,a.y,"deathSheet");"red"==a.colour?(xp+=Math.floor(4*baddieXpAdjuster),r.frame=11):(xp+=Math.floor(3*baddieXpAdjuster),r.frame=10),game.time.events.add(1*Phaser.Timer.SECOND,function(){r.destroy()}),this.xpDisplayConvert(),baddieCount--,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},bossZombieKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=.1*knockback:"right"==e.travel?a.x+=.1*knockback:"up"==e.travel?a.y-=.1*knockback:"down"==e.travel&&(a.y+=.1*knockback)),e.kill(),game.time.now>a.damageTimer)if(a.damageTimer=game.time.now>a+400,a.health<=shotPower){this.coinCreate(a.x,a.y,"yellow"),this.coinCreate(a.x+15,a.y-2,"yellow"),this.coinCreate(a.x-15,a.y+2,"yellow");var t=game.add.sprite(a.x-10,a.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()});var i=game.add.sprite(a.x+10,a.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){i.destroy()});var r=game.add.sprite(a.x+10,a.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){r.destroy()});var o=game.add.sprite(a.x-10,a.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){o.destroy()}),Math.random()>.8&&"red"==a.colour?(this.coinCreate(a.x+5,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-5,"yellow")):Math.random()>.9&&(this.coinCreate(a.x+5,a.y+5,"green"),this.coinCreate(a.x-5,a.y-5,"green")),Math.random()>.8&&(this.baddieCreate(a.x,a.y,"red"),baddieCount++),a.destroy(),bossZombieKilled=!0,zombieDeathSFX.play();var s=game.add.sprite(a.x,a.y,"deathSheet");"red"==a.colour?(xp+=Math.floor(330*baddieXpAdjuster),s.frame=11):(xp+=Math.floor(220*baddieXpAdjuster),s.frame=10),s.scale.x=2.5,s.scale.y=2.5,game.time.events.add(1*Phaser.Timer.SECOND,function(){s.destroy()}),this.xpDisplayConvert(),baddieCount-=.1*stageMilestone+57,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.timer+a.interval<=game.time.now&&(this.baddieCreate(a.x,a.y,"red"),a.timer=game.time.now,baddieCount++),a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},bossZombieBirdKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=.1*knockback:"right"==e.travel?a.x+=.1*knockback:"up"==e.travel?a.y-=.1*knockback:"down"==e.travel&&(a.y+=.1*knockback)),e.kill(),game.time.now>a.damageTimer)if(a.damageTimer=game.time.now>a+400,a.health<=shotPower){this.coinCreate(a.x,a.y,"yellow"),this.coinCreate(a.x+15,a.y-2,"yellow"),this.coinCreate(a.x-15,a.y+2,"yellow"),this.coinCreate(a.x+5,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-5,"yellow");var t=game.add.sprite(a.x-10,a.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()});var i=game.add.sprite(a.x+10,a.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){i.destroy()});var r=game.add.sprite(a.x+10,a.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){r.destroy()});var o=game.add.sprite(a.x-10,a.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){o.destroy()}),Math.random()>.5&&(this.coinCreate(a.x+15,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-15,"yellow")),a.destroy(),a.isAlive=!1,this.birdDeathSFX();var s=game.add.sprite(a.x,a.y,"deathSheet");xp+=Math.floor(450*baddieXpAdjuster),s.frame=12,game.time.events.add(1*Phaser.Timer.SECOND,function(){s.destroy()}),this.xpDisplayConvert(),baddieCount-=.1*stageMilestone+45,this.checkLevelUp(),this.zombieBirdCreate(a.x,a.y),this.zombieBirdCreate(a.x+30,a.y),this.zombieBirdCreate(a.x,a.y+30),this.zombieBirdCreate(a.x+30,a.y+30),this.miniZombieBirdCreate(a.x,a.y),this.miniZombieBirdCreate(a.x+20,a.y),this.miniZombieBirdCreate(a.x+40,a.y),this.miniZombieBirdCreate(a.x,a.y+20),this.miniZombieBirdCreate(a.x+30,a.y+20)}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},bossMummyKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=.1*knockback:"right"==e.travel?a.x+=.1*knockback:"up"==e.travel?a.y-=.1*knockback:"down"==e.travel&&(a.y+=.1*knockback)),e.kill(),game.time.now>a.damageTimer)if(a.damageTimer=game.time.now>a+400,a.health<=shotPower){this.coinCreate(a.x,a.y,"yellow"),this.coinCreate(a.x+15,a.y-2,"yellow"),this.coinCreate(a.x-15,a.y+2,"yellow"),this.coinCreate(a.x+5,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-5,"yellow"),this.coinCreate(a.x-5,a.y,"yellow");var t=game.add.sprite(a.x-10,a.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()});var i=game.add.sprite(a.x+10,a.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){i.destroy()});var r=game.add.sprite(a.x+10,a.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){r.destroy()});var o=game.add.sprite(a.x-10,a.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){o.destroy()}),Math.random()>.5&&(this.coinCreate(a.x+15,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-15,"yellow"),this.coinCreate(a.x-15,a.y-15,"yellow")),a.destroy(),a.isAlive=!1,bossMummyKilled=!0,this.mummyDeathSFX();var s=game.add.sprite(a.x,a.y,"deathSheet");xp+=Math.floor(650*baddieXpAdjuster),s.frame=5,s.scale.x=2,s.scale.y=2,game.time.events.add(1*Phaser.Timer.SECOND,function(){s.destroy()}),this.xpDisplayConvert(),baddieCount-=.1*stageMilestone+97,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},bossFinalKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=.1*knockback:"right"==e.travel?a.x+=.1*knockback:"up"==e.travel?a.y-=.1*knockback:"down"==e.travel&&(a.y+=.1*knockback)),e.kill(),game.time.now>a.damageTimer)if(a.damageTimer=game.time.now>a+400,a.health<=shotPower){this.coinCreate(a.x,a.y,"yellow"),this.coinCreate(a.x+15,a.y-2,"yellow"),this.coinCreate(a.x-15,a.y+2,"yellow"),this.coinCreate(a.x+5,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-5,"yellow"),this.coinCreate(a.x-5,a.y,"yellow"),this.coinCreate(a.x-15,a.y-15,"yellow"),this.coinCreate(a.x-5,a.y-15,"yellow");var t=game.add.sprite(a.x-10,a.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()});var i=game.add.sprite(a.x+10,a.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){i.destroy()});var r=game.add.sprite(a.x+10,a.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){r.destroy()});var o=game.add.sprite(a.x-10,a.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){o.destroy()}),Math.random()>.5&&(this.coinCreate(a.x+15,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-15,"yellow"),this.coinCreate(a.x-15,a.y-15,"yellow"),this.coinCreate(a.x-5,a.y+10,"yellow")),
a.destroy(),a.isAlive=!1,bossFinalKilled=!0,this.maleDeathSFX();var s=game.add.sprite(a.x,a.y,"deathSheet");xp+=Math.floor(900*baddieXpAdjuster),s.frame=3,s.scale.x=2,s.scale.y=2,game.time.events.add(1*Phaser.Timer.SECOND,function(){s.destroy()}),this.xpDisplayConvert(),baddieCount-=100,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},spiderKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=knockback:"right"==e.travel?a.x+=knockback:"up"==e.travel?a.y-=knockback:"down"==e.travel&&(a.y+=knockback)),e.kill(),a.health<=shotPower){Math.random()>.85?this.coinCreate(a.x+5,a.y+5,"blue"):this.coinCreate(a.x,a.y,"red"),a.kill();var t=game.add.sprite(a.x,a.y,"deathSheet");t.frame=7,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()}),this.spiderDeathSFX(),xp+=Math.floor(5*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=3,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},swordZombieKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=knockback:"right"==e.travel?a.x+=knockback:"up"==e.travel?a.y-=knockback:"down"==e.travel&&(a.y+=knockback)),e.kill(),a.health<=shotPower){Math.random()>.7||"red"==a.colour?this.coinCreate(a.x+5,a.y+5,"blue"):this.coinCreate(a.x,a.y,"red"),a.kill(),a.isAlive=!1;var t=game.add.sprite(a.x,a.y,"deathSheet");"red"==a.colour?(t.frame=16,xp+=Math.floor(9*baddieXpAdjuster)):(t.frame=14,xp+=Math.floor(6*baddieXpAdjuster)),game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()}),zombieDeathSFX.play(),this.xpDisplayConvert(),baddieCount-=4,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},skeletonKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.66&&("left"==e.travel?a.x-=knockback:"right"==e.travel?a.x+=knockback:"up"==e.travel?a.y-=knockback:"down"==e.travel&&(a.y+=knockback)),e.kill(),"redBoss"!=a.colour||game.time.now>a.bossDamageTimer)if("redBoss"==a.colour&&(a.bossDamageTimer=game.time.now+400),a.health<=shotPower){if(this.coinCreate(a.x,a.y,"blue"),Math.random()>.7&&"grey"==a.colour)this.coinCreate(a.x+5,a.y+5,"red");else if(Math.random()>.6&&"red"==a.colour)this.coinCreate(a.x+5,a.y+5,"blue");else if("redBoss"==a.colour){this.coinCreate(a.x+5,a.y+5,"yellow"),this.coinCreate(a.x-5,a.y-5,"yellow"),this.coinCreate(a.x+15,a.y-2,"yellow"),this.coinCreate(a.x-15,a.y+2,"yellow");var t=game.add.sprite(a.x-10,a.y+10,"wand");weaponsmithDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()});var i=game.add.sprite(a.x+10,a.y+10,"armour");armourerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){i.destroy()});var r=game.add.sprite(a.x+10,a.y-10,"ring");enchanterDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){r.destroy()});var o=game.add.sprite(a.x-10,a.y-10,"buff");trainerDropReward++,game.time.events.add(1*Phaser.Timer.SECOND,function(){o.destroy()})}a.destroy();var s=game.add.sprite(a.x,a.y,"deathSheet");s.frame=6,game.time.events.add(1*Phaser.Timer.SECOND,function(){s.destroy()}),this.skeletonDeathSFX(),"red"==a.colour?(xp+=Math.floor(8*baddieXpAdjuster),s.tint=12203264):"redBoss"==a.colour?(a.isAlive=!1,xp+=Math.floor(325*baddieXpAdjuster),s.tint=12203264,s.scale.x=2.5,s.scale.y=2.5,bossSkeletonKilled=!0):xp+=Math.floor(6*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-="redBoss"==a.colour?.1*stageMilestone+77:5,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},flameKill:function(e,a){this.smallExplosion(e.x,e.y),e.kill(),a.health<=shotPower?(Math.random()>.65?this.coinCreate(a.x+5,a.y+5,"blue"):this.coinCreate(a.x,a.y,"red"),a.destroy(),a.isAlive=!1,this.sizzleSFX(),xp+=Math.floor(8*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=6,this.checkLevelUp(),this.checkStageComplete(),70==stage&&flameCount--):(a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0))},mummyKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.75&&("left"==e.travel?a.x-=knockback:"right"==e.travel?a.x+=knockback:"up"==e.travel?a.y-=knockback:"down"==e.travel&&(a.y+=knockback)),e.kill(),a.health<=shotPower){if(Math.random()>.67?this.coinCreate(a.x+5,a.y+5,"green"):this.coinCreate(a.x,a.y,"blue"),a.destroy(),"wasteland"==backgroundScene){var t=game.add.sprite(a.x,a.y,"deathSheet");t.frame=5}else{var t=game.add.sprite(a.x,a.y,"golem");t.frame=14}game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()}),this.mummyDeathSFX(),xp+=Math.floor(9*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=7,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},zombieBirdKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.5&&("left"==e.travel?a.x-=knockback:"right"==e.travel?a.x+=knockback:"up"==e.travel?a.y-=knockback:"down"==e.travel&&(a.y+=knockback)),e.kill(),a.health<=shotPower){this.miniZombieBirdCreate(a.x,a.y+50),this.miniZombieBirdCreate(a.x,a.y-50),player.x<a.x?this.miniZombieBirdCreate(a.x+50,a.y):this.miniZombieBirdCreate(a.x-50,a.y),Math.random()>.7?this.coinCreate(a.x+5,a.y+5,"green"):this.coinCreate(a.x,a.y,"blue"),a.destroy();var t=game.add.sprite(a.x,a.y,"deathSheet");t.frame=12,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()}),this.birdDeathSFX(),xp+=Math.floor(8*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=2,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},miniZombieBirdKill:function(e,a){if(this.smallExplosion(e.x,e.y),Math.random()>.4&&("left"==e.travel?a.x-=knockback:"right"==e.travel?a.x+=knockback:"up"==e.travel?a.y-=knockback:"down"==e.travel&&(a.y+=knockback)),e.kill(),a.health<=shotPower){Math.random()>.75?this.coinCreate(a.x+5,a.y+5,"green"):this.coinCreate(a.x,a.y,"blue"),a.kill(),a.healthBar.destroy(),a.healthBarBack.destroy();var t=game.add.sprite(a.x,a.y,"deathSheet");t.frame=4,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()}),this.birdDeathSFX(),xp+=Math.floor(6*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=2,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.children.length>0&&(a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0))},swampCreatureKill:function(e,a){if(this.smallExplosion(e.x,e.y),e.kill(),a.health<=shotPower){this.coinCreate(a.x,a.y,"green"),Math.random()>.5&&this.coinCreate(a.x+5,a.y+5,"blue"),a.destroy();var t=game.add.sprite(a.x,a.y,"deathSheet");t.frame=13,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()});var i=game.add.audio("swampCreatureDeath");i.play(),a.isAlive=!1,xp+=Math.floor(14*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=9,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},treeBeastKill:function(e,a){this.smallExplosion(e.x,e.y),e.kill(),a.health<=shotPower?(this.coinCreate(a.x,a.y,"green"),Math.random()>.5&&this.coinCreate(a.x+5,a.y+5,"blue"),a.destroy(),a.isAlive=!1,this.woodSmashSFX(),xp+=Math.floor(14*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=60==stage&&0==bossTreeBeastKilled?4.8:9,this.checkLevelUp(),this.checkStageComplete()):(a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0))},evilwizardKill:function(e,a){if(this.smallExplosion(e.x,e.y),e.kill(),a.health<=shotPower){this.coinCreate(a.x,a.y,"yellow"),Math.random()>.5&&this.coinCreate(a.x+5,a.y+5,"green"),a.destroy();var t=game.add.sprite(a.x,a.y,"deathSheet");t.frame=3,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()}),this.maleDeathSFX(),a.isAlive=!1,xp+=Math.floor(19*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=10,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},vampireKill:function(e,a){if(this.smallExplosion(e.x,e.y),e.kill(),a.visible)if(a.health<=shotPower){this.coinCreate(a.x-5,a.y-5,"green"),this.coinCreate(a.x,a.y,"yellow"),Math.random()>.4&&this.coinCreate(a.x+5,a.y+5,"yellow"),a.destroy();var t=game.add.sprite(a.x,a.y,"deathSheet");t.frame=15,game.time.events.add(1*Phaser.Timer.SECOND,function(){t.destroy()}),this.maleDeathSFX(),a.isAlive=!1,xp+=Math.floor(25*baddieXpAdjuster),this.xpDisplayConvert(),baddieCount-=11,this.checkLevelUp(),this.checkStageComplete()}else a.health-=shotPower,this.vampireEvade(),a.healthBarBack.visible=!0,a.healthBar.visible=!0,a.healthBar.clear(),a.healthBar.lineStyle(3,16767232,1),a.healthBar.moveTo(0,0),a.healthBar.lineTo(20*(a.health/a.maxHealth),0)},decoyKill:function(e,a){a.destroy()},checkStageComplete:function(){var e=!1;baddieCount<=0&&stage%100==0&&0==bossFinalKilled&&0==e?(this.finalBossIntro(),e=!0):baddieCount<=0&&0==doorAvailable&&(player.x<150&&player.y<250?(game.add.sprite(750,70,"doorway"),door=game.add.sprite(750,70,"animateddoor")):(game.add.sprite(5,70,"doorway"),door=game.add.sprite(5,70,"animateddoor")),doorAvailable=!0,manaRegenEndLevelAdjust=250,runSpeedEndLevelAdjust=100,door.animations.add("openDoor",[0,1,2,3],4,!1),game.physics.arcade.enable(door),door.body.immovable=!0,stage-100*Math.floor(stage/100)==60&&(bossTreeBeastKilled=!0),stage-100*Math.floor(stage/100)==80&&(bossZombieBirdKilled=!0),stage%100==0&&(e=!1))},finalBossIntro:function(){beamSFX=game.add.audio("shotSFX");var e=game.add.sprite(750,70,"animateddoor");flameShot=game.add.audio("flameShot");var a,t;game.time.events.add(1*Phaser.Timer.SECOND,function(){a=game.add.sprite(750,115,"flame"),a.scale.x=2,a.scale.y=1.5,a.animations.add("flicker",[0,1,2,3,4,5,6,7,8,9,10,11],10,!0),a.animations.play("flicker"),t=game.add.sprite(785,115,"flame"),t.scale.x=2,t.scale.y=1.5,t.animations.add("flicker",[0,1,2,3,4,5,6,7,8,9,10,11],10,!0),t.animations.play("flicker"),flameShot.play()}),game.time.events.add(3*Phaser.Timer.SECOND,function(){e.kill()});var i=this;game.time.events.add(4*Phaser.Timer.SECOND,function(){a.kill(),t.kill(),i.bossFinalCreate(832-player.x,640-player.y),baddieCount+=100})},doorOpen:function(){door.animations.play("openDoor");var e=game.add.audio("creakylightwoodendoor1");e.play(),manaRegenEndLevelAdjust=0,runSpeedEndLevelAdjust=0,player.kill(),door.destroy(),doorAvailable=!1;var a=this;game.time.events.add(2*Phaser.Timer.SECOND,function(){a.startNextLevel()})},manaRegen:function(){game.time.now>manaRegenTimer&&mana<maxMana&&(mana++,manaRegenTimer=game.time.now+manaRegenInterval,manaText.text="MP: "+mana+"/"+maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop())},questComplete:function(){questEndTime=game.time.now,null!=timerMana&&timerMana.running&&timerMana.stop(),null!=timerBeam&&timerBeam.running&&timerBeam.stop(),gameMusic.destroy(),game.world.removeAll(),game.state.start("city")},checkLevelUp:function(){for(;xp>=nextLevelXp;){levelUpImage=game.add.sprite(132,15,"levelUp"),levelUpImage.animations.add("flash",[0,1,2],6,!0),levelUpImage.animations.play("flash");var e=game.add.audio("levelUpSound");e.play(),game.time.events.add(1*Phaser.Timer.SECOND,function(){levelUpImage.destroy()}),xp-=nextLevelXp,nextLevelXp+=Math.round(9+.7*playerLevel),maxHealth++,maxMana++,shotPower+=.03,health++,hpCrop.x=80*(1-health/maxHealth),hpBar.updateCrop(),mana=maxMana,manaCrop.x=80*(1-mana/maxMana),manaBar.updateCrop(),playerLevel++,this.xpDisplayConvert(),manaText.text="MP: "+mana+"/"+maxMana,healthText.text="HP: "+health+"/"+maxHealth,playerLevelText.text=playerLevel}},startNextLevel:function(){gameMusic.destroy(),stage%100==0&&(baddieAdjuster+=90,baddieTotal-=baddieAdjuster,baddieDamageAdjuster++,baddieHpAdjuster++,baddieXpAdjuster+=.5,baddieSpeedAdjuster+=.1,bossZombieKilled=!1,bossTreeBeastKilled=!1,bossSkeletonKilled=!1,bossZombieBirdKilled=!1,bossMummyKilled=!1,bossFinalKilled=!1),stage++,starTotal+=.75,baddieTotal++,baddieCount=baddieTotal,baddieCreated=0,chestCreated=0,flameCount=0,evilwizardCount=0,zombieBirdCount=0,swampCreatureCount=0,game.world.removeAll(),array=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130],sceneryCount=0,this.create()},playerDeath:function(){player.kill(),gameMusic.destroy(),this.maleDeathSFX();var e=game.add.sprite(player.x,player.y,"deathSheet");e.frame=0;var a=game.add.audio("teleport");if(game.time.events.add(1*Phaser.Timer.SECOND,function(){e.destroy();var t=game.add.sprite(e.x+5,e.y+5,"playerTeleport");t.animations.add("teleport",[0,1,2,3],8,!1),t.animations.play("teleport"),a.play(),game.time.events.add(.5*Phaser.Timer.SECOND,function(){t.destroy()})}),player.isAlive=!1,healthText.text="HP: 0/"+maxHealth,stage>bestStage){for(;stage>bestStage;)bestStage++,reward+=bestStage;reward*=stage<50?1.1:.15+(500-stage)/500,levelRecordBackground.x=96,levelRecord.text="Congratulations!",levelRecord2.text="New Highest Stage Record!",levelRecord3.text="        You receive "+Math.floor(10*reward)+" XP and "+Math.floor(15*reward)+" Coins!",xp+=Math.round(10*floor),this.xpDisplayConvert(),this.checkLevelUp(),coins+=Math.round(15*floor),coins>=1e6?coinsText.text=Math.round(coins/1e3)/1e3+"M":coinsText.text=coins,reward=0}questEndCoins=coins,questTotalCoins=questEndCoins-questStartCoins,resultBackground.x=96,resultText.text=" Your Majesty, it is time to come home!",resultText2.text=" You found "+questTotalCoins+" coins on your quest.",resultText3.text="   The Merchant Guild will double your coins for a minute of your time.";game.add.button(190,250,"blankButton",this.adWatch,this),game.add.bitmapText(230,280,"font","Yes, watch ad",16),game.add.button(410,250,"blankButton",this.questComplete,this),game.add.bitmapText(450,280,"font","No, return to my City",16);1==first&&(assistant="welcomeBack",first=!1)},adWatch:function(){advertImage=game.add.sprite(185,89,"advertImage"),adStopTime=game.time.now+14e3;var e={font:"21px sans-serif bold"};adTimeText=game.add.text(619,92,"",e);var a=this;game.time.events.add(14*Phaser.Timer.SECOND,function(){game.add.button(618,89,"closeButton",a.adClose,this)})},adTimeUpdate:function(){null!=adTimeText&&(adStopTime-game.time.now<9500&&adStopTime>game.time.now?adTimeText.text="0"+Math.round(.001*(adStopTime-game.time.now)):adStopTime>game.time.now?adTimeText.text=Math.round(.001*(adStopTime-game.time.now)):adTimeText.text="")},adClose:function(){coins+=questTotalCoins,questEndTime=game.time.now,null!=timerMana&&timerMana.running&&timerMana.stop(),null!=timerBeam&&timerBeam.running&&timerBeam.stop(),game.world.removeAll(),game.state.start("city")},beamWeaponActivate:function(){manaCost=1,bulletSpacing/=13.5,shotPower+=.002*shotSpeed,beamWeapon=!1,beamSprite.frame=0;var e=this;game.time.events.add(4*Phaser.Timer.SECOND,function(){manaCost=5,bulletSpacing*=13.5,shotPower-=.002*shotSpeed,e.beamWeaponTimer()})},beamWeaponTimer:function(){timerBeam=game.time.create(),timerBeamEvent=timerBeam.add(5*Phaser.Timer.MINUTE,this.endBeamTimer,this),timerBeam.start(),timerBeam.updateTimer=0},beamTimerUpdate:function(){if(null!=timerBeam&&timerBeam.running&&game.time.now>timerBeam.updateTimer){beamSprite.frame=0;var e={font:"21px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};beamText.setStyle(e),beamText.x=234,beamText.y=602,beamText.text=this.formatTime(Math.round(.001*(timerBeamEvent.delay-timerBeam.ms))),timerBeam.updateTimer=game.time.now+1e3}},endBeamTimer:function(){timerBeam.stop(),beamWeapon=!0,beamSprite.frame=1;var e={font:"18px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};beamText.setStyle(e),beamText.x=230,beamText.y=604,beamText.text="SPACE",timerBeam.updateTimer=0},manaRefillActivate:function(){mana=maxMana,manaRefillAvailable=!1,bottleSprite.frame=0,bottleText.text="",this.manaRefillTimer()},manaRefillTimer:function(){timerMana=game.time.create(),timerManaEvent=timerMana.add(5*Phaser.Timer.MINUTE,this.endManaRefillTimer,this),timerMana.start(),timerMana.updateTimer=0},manaRefillTimerUpdate:function(){if(null!=timerMana&&timerMana.running&&game.time.now>timerMana.updateTimer){bottleSprite.frame=0,bottleText.x=532,bottleText.y=603;var e={font:"18px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};bottleText.setStyle(e),bottleText.text=this.formatTime(Math.round(.001*(timerManaEvent.delay-timerMana.ms))),timerMana.updateTimer=game.time.now+1e3}},endManaRefillTimer:function(){timerMana.stop(),manaRefillAvailable=!0,bottleSprite.frame=1,bottleText.x=543,bottleText.y=601;var e={font:"24px courier bolder",fill:"#f99a08",stroke:"black",strokeThickness:1.5};bottleText.setStyle(e),bottleText.text="Q",timerMana.updateTimer=0},formatTime:function(e){var a="0"+Math.floor(e/60),t="0"+(e-60*a);return a.substr(-2)+":"+t.substr(-2)},treeCreate:function(e,a){var t=platforms.create(e,a,"tree");t.body.setSize(35,20,0,33),t.body.immovable=!0,t.Shadow=t.addChild(game.add.sprite(-18,11,"treeShadow")),t.Shadow.alpha=.35},xpDisplayConvert:function(){xpDisplay=xp>=1e3?Math.round(xp/100)/10+"k":Math.round(xp),nextLevelXpDisplay=nextLevelXp>=1e3?Math.round(nextLevelXp/100)/10+"k":Math.round(nextLevelXp),xpText.text="XP: "+xpDisplay+"/"+nextLevelXpDisplay,xpCrop.x=80*(1-xp/nextLevelXp),xpBar.updateCrop()}};