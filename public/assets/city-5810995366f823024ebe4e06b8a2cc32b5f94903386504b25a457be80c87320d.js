var currentTime=0,year=0,population=100,happiness=44,happinessDisplay,popScore=1,popText,popDisplay,cityCoinsText,cityHappinessText,cityYearText,questStartTime=0,questEndTime=0,questYears=0,questStartCoins=0,questEndCoins=0,housing=25,commercial=25,industrial=25,education=25,popHealth=25,justice=25,defence=25,troopNumber=Math.round(defence/4),troopText,troopDisplay,utilities=25,weaponsmith=25,armourer=25,enchanter=25,trainer=25,income=0,expenditure=0,tax=40,economyMod=1,totalFunding,netIncome,previousPopulation=100,previousEconomyMod=0,previousIncome=0,previousExpenditure=0,previousNetIncome=0,previousCoins=0,residentialButton,industrialButton,commerceButton,educationButton,healthButton,justiceButton,armyButton,utilitiesButton,weaponerButton,armourerButton,magicGoodsButton,trainerButton,questButton,defendButton,castleButton,shop,defending=!0,defenceChance=0,educationHighlight,healthHighlight,townWoman1,townMan1,townWoman2,townMan2,warriorMan1,warriorWoman1,girl,boy,girlActive=!1,boyActive=!1,spaceBar,assistantChangeTimer=0,assistant="first",assistantSprite,assistantSpeechBubble,assistantText="",assistantText2="",assistantText3="",assistantText4="",assistantText5="",assistantText6="",tutorial=!0,debtWarnYear=0,xpReduction,xpReduction1,xpReduction2,xpReduction3,startingPopIncrease=0,startingPopIncrease1,startingPopIncrease2,startingPopIncrease3,startingGoldIncrease=0,startingGoldIncrease1,startingGoldIncrease2,startingGoldIncrease3,artisanIncrease,artisanIncrease1,artisanIncrease2,artisanIncrease3,deptEffectIncrease=0,deptEffectIncrease1,deptEffectIncrease2,deptEffectIncrease3,marriageOptions=!1,beamUnlockShown=!1,manaRefillUnlockShown=!1,questHappinessModifier=0,questsUndertaken=0,marriageOptionsPromptButton,marriageOptionsPromptText,marriageOptionsBackground,marriageOptionsText1,marriageOptionsText2,marriageOptionsText3,marriageOptionsDisplayButton,marriageOptionsDisplayText,marriageOptionsHideButton,marriageOptionsHideText,pauseUpdate=!1,cityMusic,cityMusicPlaying=!1,bestStage=0,stageMilestone=100*Math.floor(bestStage/100),cityState={create:function(){game.add.sprite(0,0,"stonepaving"),game.add.sprite(16,80,"shopBorder"),game.add.sprite(176,80,"shopBorder"),game.add.sprite(336,80,"shopBorder"),game.add.sprite(496,80,"shopBorder"),game.add.sprite(656,80,"shopBorder"),game.add.sprite(16,250,"shopBorder"),game.add.sprite(656,250,"shopBorder"),game.add.sprite(16,415,"shopBorder"),game.add.sprite(176,415,"shopBorder"),game.add.sprite(336,415,"shopBorder"),game.add.sprite(496,415,"shopBorder"),game.add.sprite(656,415,"shopBorder"),1!=cityMusicPlaying&&(cityMusic=game.add.audio("cityMusic"),cityMusic.allowMultiple=!1,cityMusic.play(),cityMusicPlaying=!0),residentialButton=game.add.button(32,40,"HousingDpt",this.resOptions,this),game.add.sprite(124,148,"barrel"),commerceButton=game.add.button(192,40,"CommerceDpt",this.comOptions,this),game.add.sprite(285,150,"chestWooden"),industrialButton=game.add.button(352,40,"IndustryDpt",this.indOptions,this),educationButton=game.add.button(512,40,"EducationDpt",this.eduOptions,this),healthButton=game.add.button(672,40,"HealthDpt",this.healthOptions,this),game.add.sprite(764,148,"barrel"),townWoman1=game.add.sprite(850*Math.random(),160,"townWoman"),game.physics.arcade.enable(townWoman1),townWoman1.animations.add("left",[9,10,11],10,!0),townWoman2=game.add.sprite(157,700*Math.random(),"townWoman"),game.physics.arcade.enable(townWoman2),townWoman2.animations.add("up",[0,1,2],10,!0),townMan1=game.add.sprite(850*Math.random(),170,"townMan"),game.physics.arcade.enable(townMan1),townMan1.animations.add("right",[3,4,5],10,!0),townMan2=game.add.sprite(641,700*Math.random(),"townMan"),game.physics.arcade.enable(townMan2),townMan2.animations.add("down",[6,7,8],10,!0),(housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12>60?(girlActive=!0,girl=game.add.sprite(0,12,"children"),girl.scale.x=.7,girl.scale.y=.7,girl.animations.add("right",[9,10,11],10,!0),girl.animations.add("down",[15,16,17],10,!0),girl.animations.add("up",[3,4,5],10,!0),girl.animations.add("left",[21,22,23],10,!0),game.add.tween(girl).to({x:490},3600).to({y:170},1200).to({x:0},3600).to({y:12},1200).loop().start()):girlActive=!1,(housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12>70?(boyActive=!0,boy=game.add.sprite(0,170,"children"),boy.scale.x=.7,boy.scale.y=.7,boy.animations.add("right",[6,7,8],10,!0),boy.animations.add("down",[12,13,14],10,!0),boy.animations.add("up",[0,1,2],10,!0),boy.animations.add("left",[18,19,20],10,!0),game.add.tween(boy).to({y:12},1200).to({x:490},3600).to({y:170},1200).to({x:0},3600).loop().start()):boyActive=!1,justiceButton=game.add.button(32,210,"JusticeDpt",this.justiceOptions,this),game.add.sprite(37,318,"barrel"),castleButton=game.add.button(290,180,"castle",this.castleOptions,this),armyButton=game.add.button(672,210,"DefenceDpt",this.armyOptions,this),warriorMan1=game.add.sprite(800*Math.random()-50,348,"warriorMan"),game.physics.arcade.enable(warriorMan1),warriorMan1.animations.add("right",[3,4,5],10,!0),warriorWoman1=game.add.sprite(warriorMan1.x-6,369,"warriorWoman"),game.physics.arcade.enable(warriorWoman1),warriorWoman1.animations.add("right",[3,4,5],10,!0),warriorWoman1.speechBubble=warriorWoman1.addChild(game.add.sprite(-195,-113,"speechBubble")),warriorWoman1.speech1=warriorWoman1.addChild(game.add.bitmapText(-145,-106,"fontBorder","    Testing...",15)),warriorWoman1.speech2=warriorWoman1.addChild(game.add.bitmapText(-175,-89,"fontBorder","           One...",15)),warriorWoman1.speech3=warriorWoman1.addChild(game.add.bitmapText(-187,-72,"fontBorder","              Two...",15)),warriorWoman1.speech4=warriorWoman1.addChild(game.add.bitmapText(-187,-55,"fontBorder","              Three...",15)),warriorWoman1.speech5=warriorWoman1.addChild(game.add.bitmapText(-175,-38,"fontBorder","           Err...",15)),warriorWoman1.speech6=warriorWoman1.addChild(game.add.bitmapText(-145,-21,"fontBorder","    Hello?",15)),warriorWoman1.speech1.tint=0,warriorWoman1.speech2.tint=0,warriorWoman1.speech3.tint=0,warriorWoman1.speech4.tint=0,warriorWoman1.speech5.tint=0,warriorWoman1.speech6.tint=0,utilitiesButton=game.add.button(32,375,"UtilitiesDpt",this.utilOptions,this),weaponerButton=game.add.button(192,375,"weaponsmith",this.weaponOptions,this),game.add.sprite(197,485,"chestWooden"),armourerButton=game.add.button(352,375,"armourer",this.armourOptions,this),magicGoodsButton=game.add.button(512,375,"enchanter",this.magicGoodsOptions,this),trainerButton=game.add.button(672,375,"trainer",this.trainerOptions,this),""!=assistant||(0==defending?questButton=game.add.button(115,540,"questButton",this.quest,this):defendButton=game.add.button(0,540,"defendButton",this.defend,this)),"first"!=assistant&&(educationFunding<=40||healthFunding<=40)&&this.highlight(),popDisplay=game.add.sprite(10,6,"townWoman"),popDisplay.frame=7,popText=game.add.bitmapText(50,10,"font",population,26),troopDisplay=game.add.sprite(160,6,"warriorMan"),troopDisplay.frame=7,troopText=game.add.bitmapText(200,10,"font",troopNumber,26),coinDisplay=game.add.sprite(310,8,"coin"),coinDisplay.frame=0,cityCoinsText=game.add.bitmapText(340,10,"font",coins,26),happinessDisplay=game.add.sprite(510,8,"smileyFace"),cityHappinessText=game.add.bitmapText(550,10,"font",happiness,26),cityYearText=game.add.bitmapText(700,10,"font","Year: "+year,26),assistantSpeechBubble=game.add.button(-200,469,"speechBubble",this.assistantChange,this),assistantText=game.add.bitmapText(200,477,"fontBorder","",15),assistantText2=game.add.bitmapText(170,494,"fontBorder","",15),assistantText3=game.add.bitmapText(158,509,"fontBorder","",15),assistantText4=game.add.bitmapText(158,524,"fontBorder","",15),assistantText5=game.add.bitmapText(170,539,"fontBorder","",15),assistantText6=game.add.bitmapText(190,554,"fontBorder","",15),assistantText.tint=0,assistantText2.tint=0,assistantText3.tint=0,assistantText4.tint=0,assistantText5.tint=0,assistantText6.tint=0,this.warriorWomanAdvice(),this.assistantShow(),1==marriageOptions&&(marriageOptionsPromptButton=game.add.button(10,50,"blankButton",this.marriageOptionsChoose,this),marriageOptionsPromptText=game.add.bitmapText(50,75,"font","View Alliance Offers",16)),spaceBar=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)},update:function(){pauseUpdate||(this.timeCheck(),this.assistantShow(),townWoman1.body.velocity.x=-40,townWoman1.animations.play("left"),townWoman1.x<-50&&(townWoman1.x=900),townWoman2.body.velocity.y=-50,townWoman2.animations.play("up"),townWoman2.y<-50&&(townWoman2.y=700),townMan1.body.velocity.x=50,townMan1.animations.play("right"),townMan1.x>850&&(townMan1.x=-50),townMan2.body.velocity.y=50,townMan2.animations.play("down"),townMan2.y>700&&(townMan2.y=-50),warriorWoman1.body.velocity.x=55,warriorWoman1.animations.play("right"),warriorWoman1.x>850&&(warriorWoman1.x=-50),warriorMan1.body.velocity.x=55,warriorMan1.animations.play("right"),warriorMan1.x>850&&(warriorMan1.x=-50),1==girlActive&&(12==girl.y&&girl.x<490?girl.animations.play("right"):girl.y<170&&490==girl.x?girl.animations.play("down"):170==girl.y&&girl.x>0?girl.animations.play("left"):girl.y>12&&0==girl.x&&girl.animations.play("up")),1==boyActive&&(12==boy.y&&boy.x<490?boy.animations.play("right"):boy.y<170&&490==boy.x?boy.animations.play("down"):170==boy.y&&boy.x>0?boy.animations.play("left"):boy.y>12&&0==boy.x&&boy.animations.play("up")),(housing+commercial+industrial+education+popHealth+justice+defence+utilities+weaponsmith+armourer+enchanter+trainer)/12>95&&0==marriageOptions&&(this.marriageOptionsPrompter(),marriageOptions=!0),spaceBar.isDown&&""!=assistant&&game.time.now>assistantChangeTimer&&(this.assistantChange(),assistantChangeTimer=game.time.now+1e3))},timeCheck:function(){for(questStartTime<questEndTime&&(questYears=Math.round((questEndTime-questStartTime)/25e4),questYears>10&&(questYears=10),questStartTime=0,questEndTime=0);game.time.now>currentTime+3e4||questYears>0;)year++,housing+=(housingFunding-housing)/12,commercial+=(commercialFunding-commercial)/12,industrial+=(industrialFunding-industrial)/12,education+=(educationFunding-education)/12,popHealth+=(healthFunding-popHealth)/12,justice+=(justiceFunding-justice)/12,defence+=(defenceFunding-defence)/12,utilities+=(utilitiesFunding-utilities)/12,weaponsmith+=(weaponsmithFunding-weaponsmith)/12,armourer+=(armourerFunding-armourer)/12,enchanter+=(enchanterFunding-enchanter)/12,trainer+=(trainerFunding-trainer)/12,previousPopulation=population,population+=population*((housing-33)/4e3),population+=population*((education-33)/9e3),population+=population*((popHealth-33)/2e3),population+=population*((justice-33)/13e3),population+=population*((defence-33)/14e3),population+=population*((utilities-33)/9e3),population+=population*((trainer-33)/14300),population-=population*((1.05*tax-.5*happiness)/2e3),population+=year<=30?1+year/10:9-year/6,population>999999?(coins+=population-999999,population=999999):population=population>0?Math.round(population):0,questHappinessModifier=Math.floor(stage/20)+questsUndertaken,happiness=Math.round(20+questHappinessModifier+4*(housing/15+commercial/100+industrial/100+education/100+popHealth/15+justice/20+defence/100+utilities/80)),happiness>100&&(happiness=100),previousEconomyMod=economyMod,economyMod=1,economyMod+=(commercial-34)/950,economyMod+=(industrial-34)/950,economyMod+=(education-34)/950,economyMod+=(justice-34)/6e3,economyMod+=(weaponsmith-34)/5e3,economyMod+=(armourer-34)/5e3,economyMod+=(enchanter-34)/5e3,economyMod+=(trainer-34)/6e3,economyMod+=(utilities-33)/9e3,economyMod-=(tax-30)/3e3,previousIncome=income,income=population*economyMod*(1.17*tax),averageFunding=Math.round((housingFunding+commercialFunding+industrialFunding+educationFunding+healthFunding+justiceFunding+defenceFunding+utilitiesFunding+weaponsmithFunding+armourerFunding+enchanterFunding+trainerFunding)/12),totalFunding=housingFunding+commercialFunding+industrialFunding+educationFunding+healthFunding+justiceFunding+defenceFunding+utilitiesFunding+weaponsmithFunding+armourerFunding+enchanterFunding+trainerFunding,previousExpenditure=expenditure,expenditure=totalFunding*(4.45+year/22)+population*(totalFunding/19),previousNetIncome=netIncome,netIncome=income-expenditure,previousCoins=coins,coins=Math.round(coins+income-expenditure),currentTime=game.time.now,questYears>0&&questYears--,Math.random()>.9-defenceChance/10&&(defending=!0,defenceChance=0,game.world.removeAll(),this.create());popText.text=population,troopNumber=Math.round(defence/4),troopText.text=troopNumber,coins>=1e6?cityCoinsText.text=Math.round(coins/1e3)/1e3+"M":cityCoinsText.text=coins,cityHappinessText.text=happiness,cityYearText.text="Year: "+year,this.popScoreCalc(),coins<=0&&year>debtWarnYear+1&&(assistant="debt",debtWarnYear=year+3,tax<100&&tax++,housingFunding>0&&housingFunding--,justiceFunding>0&&justiceFunding--,utilitiesFunding>0&&utilitiesFunding--,coins-=Math.round(.05*coins)),this.save()},popScoreCalc:function(){for(var e=100,t=population;t>e;)popScore+=.1,t-=e,e+=100;popScore>100&&(popScore=100)},castleOptions:function(){game.world.removeAll(),shop="castle",game.state.start("shop")},resOptions:function(){coins>=0?(game.world.removeAll(),shop="housing",game.state.start("shop")):this.shopClosed()},comOptions:function(){coins>=0?(game.world.removeAll(),shop="commercial",game.state.start("shop")):this.shopClosed()},indOptions:function(){coins>=0?(game.world.removeAll(),shop="industrial",game.state.start("shop")):this.shopClosed()},eduOptions:function(){coins>=0||educationFunding<=40?(game.world.removeAll(),shop="education",game.state.start("shop")):this.shopClosed()},healthOptions:function(){coins>=0||healthFunding<=40?(game.world.removeAll(),shop="health",game.state.start("shop")):this.shopClosed()},justiceOptions:function(){coins>=0?(game.world.removeAll(),shop="justice",game.state.start("shop")):this.shopClosed()},armyOptions:function(){coins>=0?(game.world.removeAll(),shop="defence",game.state.start("shop")):this.shopClosed()},utilOptions:function(){coins>=0?(game.world.removeAll(),shop="utilities",game.state.start("shop")):this.shopClosed()},weaponOptions:function(){coins>=0?(game.world.removeAll(),shop="weaponsmith",game.state.start("shop")):this.shopClosed()},armourOptions:function(){coins>=0?(game.world.removeAll(),shop="armourer",game.state.start("shop")):this.shopClosed()},magicGoodsOptions:function(){coins>=0?(game.world.removeAll(),shop="enchanter",game.state.start("shop")):this.shopClosed()},trainerOptions:function(){coins>=0?(game.world.removeAll(),shop="trainer",game.state.start("shop")):this.shopClosed()},quest:function(){game.world.removeAll(),cityMusic.destroy(),cityMusicPlaying=!1,stage=5*Math.floor(stage/5),stage<stageMilestone+1&&(stage=stageMilestone+1),baddieTotal=stage+6-baddieAdjuster,baddieCount=baddieTotal,baddieCreated=0,chestCreated=0,flameCount=0,evilwizardCount=0,zombieBirdCount=0,swampCreatureCount=0,starTotal=.75*(stage-1)+6,health=maxHealth,mana=maxMana,array=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130],sceneryCount=0,1==beamUnlockShown&&(beamWeapon=!0),1==manaRefillUnlockShown&&(manaRefillAvailable=!0),defenceChance++,questsUndertaken++,questStartTime=game.time.now,questStartCoins=coins,game.world.removeAll(),game.state.start("play")},defend:function(){cityMusic.destroy(),cityMusicPlaying=!1,game.world.removeAll(),health=maxHealth,mana=maxMana,attackerCount=attackStrength,defenceStrength=Math.round(defence/4),defenderCount=Math.round(defence/4),"first"==tutorialDefence?(cityMusicPlaying=!1,game.world.removeAll(),game.state.start("tutorial")):(cityMusicPlaying=!1,game.world.removeAll(),game.state.start("defence"))},collectSFX:function(){var e=game.add.audio("collect");e.play()},assistantShow:function(){switch(assistant){case"first":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text="Your Majesty!",assistantText2.text="   This year's census is ",assistantText3.text="very worrying. Your people's",assistantText4.text="   health and education is",assistantText5.text=" in decline. <Click> or",assistantText6.text="   press SPACE.";break;case"second":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text="  We must do",assistantText2.text=" something. You should",assistantText3.text="    increase the budgets",assistantText4.text="     of the Departments  ",assistantText5.text="       of Health and ",assistantText6.text="     Education.";break;case"defend":educationFunding>40&&healthFunding>40&&(assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text="     Our city is under",assistantText3.text="    attack. You must lead",assistantText4.text="        the Army in our",assistantText5.text="          Defence.",assistantText6.text="");break;case"tutorialEnd":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Excellent work,",assistantText2.text=" Your Majesty. However ",assistantText3.text=" we cannot just wait for the",assistantText4.text=" next attack. Your city needs",assistantText5.text="you to undertake a quest",assistantText6.text="  to raise funds.";break;case"welcomeBack":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Marvellous,",assistantText2.text="Your Majesty. Songs will ",assistantText3.text="be sung of your deeds down",assistantText4.text=" the ages. Now to share the",assistantText5.text="  treasure among your ",assistantText6.text=" offices of state.";break;case"debt":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Our funds",assistantText2.text=" are gone. Our enemies",assistantText3.text=" see our weakness and we",assistantText4.text=" cannot pay our troops. You",assistantText5.text="  must undertake a quest",assistantText6.text=" to raise funds.";break;case"marriage":assistantSprite=game.add.sprite(350,469,"assistant"),assistantSpeechBubble.x=150,assistantText.text=" Your Majesty!",assistantText2.text=" Your people are happy.",assistantText3.text=" Your borders are secure.",assistantText4.text=" Your neighbours are lining",assistantText5.text=" up to offer alliances on",assistantText6.text=" generous terms."}},assistantChange:function(){switch(assistant){case"first":assistant="second",this.create(),this.assistantShow();break;case"second":assistant="defend",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.highlight(),this.assistantShow();break;case"defend":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"tutorialEnd":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"welcomeBack":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"debt":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"marriage":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create();break;case"":assistant="",assistantSprite.kill(),assistantSpeechBubble.kill(),assistantText.text="",assistantText2.text="",assistantText3.text="",assistantText4.text="",assistantText5.text="",assistantText6.text="",this.create()}},highlight:function(){educationFunding>40||0==first||(educationHighlight=game.add.sprite(510,56,"deptHighlight"),educationHighlight.alpha=.1,game.add.tween(educationHighlight).to({alpha:1},700,Phaser.Easing.Quadratic.In,!0,0,Number.MAX_VALUE,!0)),healthFunding>40||0==first||(healthHighlight=game.add.sprite(670,56,"deptHighlight"),healthHighlight.alpha=.1,game.add.tween(healthHighlight).to({alpha:1},700,Phaser.Easing.Quadratic.In,!0,0,Number.MAX_VALUE,!0))},save:function(){var e={};e.time=game.time.now,e.playerLevel=playerLevel,e.bulletSpacing=bulletSpacing,e.invulnerableSpacing=invulnerableSpacing,e.shotSpeed=shotSpeed,e.manaRegenHolder=manaRegenHolder,e.bossZombieKilled=bossZombieKilled,e.bossTreeBeastKilled=bossTreeBeastKilled,e.bossSkeletonKilled=bossSkeletonKilled,e.bossZombieBirdKilled=bossZombieBirdKilled,e.bossMummyKilled=bossMummyKilled,e.bossFinalKilled=bossFinalKilled,e.coins=coins,e.stage=stage,e.stageMilestone=stageMilestone,e.bestStage=bestStage,e.xp=xp,e.nextLevelXp=nextLevelXp,e.maxHealth=maxHealth,e.maxMana=maxMana,e.shotPower=shotPower,e.knockback=knockback,e.runSpeed=runSpeed,e.currentTime=currentTime,e.year=year,e.population=population,e.happiness=happiness,e.popScore=popScore,e.housing=housing,e.commercial=commercial,e.industrial=industrial,e.education=education,e.popHealth=popHealth,e.justice=justice,e.defence=defence,e.utilities=utilities,e.weaponsmith=weaponsmith,e.armourer=armourer,e.enchanter=enchanter,e.trainer=trainer,e.tax=tax,e.income=income,e.expenditure=expenditure,e.totalFunding=totalFunding,e.netIncome=netIncome,e.defending=defending,e.defenceChance=defenceChance,e.assistant=assistant,e.tutorial=tutorial,e.tutorialDefence=tutorialDefence,e.first=first,e.housingFunding=housingFunding,e.commercialFunding=commercialFunding,e.industrialFunding=industrialFunding,e.educationFunding=educationFunding,e.healthFunding=healthFunding,e.justiceFunding=justiceFunding,e.defenceFunding=defenceFunding,e.utilitiesFunding=utilitiesFunding,e.weaponsmithFunding=weaponsmithFunding,e.armourerFunding=armourerFunding,e.enchanterFunding=enchanterFunding,e.trainerFunding=trainerFunding,e.averageFunding=averageFunding,e.weaponsmithDropReward=weaponsmithDropReward,e.weaponsmithTimer=weaponsmithTimer,e.wandTimer=wandTimer,e.wandShotPower=wandShotPower,e.wandShotSpeed=wandShotSpeed,e.wandBulletSpacing=wandBulletSpacing,e.shieldTimer=shieldTimer,e.shieldKnockback=shieldKnockback,e.shieldMaxHealth=shieldMaxHealth,e.shieldInvulnerableSpacing=shieldInvulnerableSpacing,e.armourerDropReward=armourerDropReward,e.armourerTimer=armourerTimer,e.armourTimer=armourTimer,e.armourMaxHealth=armourMaxHealth,e.armourManaRegenInterval=armourManaRegenInterval,e.armourInvulnerableSpacing=armourInvulnerableSpacing,e.hatTimer=hatTimer,e.hatMaxHealth=hatMaxHealth,e.hatManaRegenInterval=hatManaRegenInterval,e.hatMaxMana=hatMaxMana,e.bootTimer=bootTimer,e.bootRunSpeed=bootRunSpeed,e.bootManaRegenInterval=bootManaRegenInterval,e.bootInvulnerableSpacing=bootInvulnerableSpacing,e.enchanterDropReward=enchanterDropReward,e.enchanterTimer=enchanterTimer,e.ringTimer=ringTimer,e.ringShotPower=ringShotPower,e.ringMaxMana=ringMaxMana,e.ringKnockback=ringKnockback,e.amuletTimer=amuletTimer,e.amuletRunSpeed=amuletRunSpeed,e.amuletShotSpeed=amuletShotSpeed,e.amuletBulletSpacing=amuletBulletSpacing,e.trainerDropReward=trainerDropReward,e.trainerTimer=trainerTimer,e.skillTimer=skillTimer,e.skillShotPower=skillShotPower,e.skillMaxMana=skillMaxMana,e.skillKnockback=skillKnockback,e.enduranceTimer=enduranceTimer,e.enduranceRunSpeed=enduranceRunSpeed,e.enduranceShotSpeed=enduranceShotSpeed,e.enduranceBulletSpacing=enduranceBulletSpacing,e.attackStrength=attackStrength,e.tutorialDefence=tutorialDefence,e.weaponsmithUpgradeCost=weaponsmithUpgradeCost,e.armourerUpgradeCost=armourerUpgradeCost,e.enchanterUpgradeCost=enchanterUpgradeCost,e.trainerUpgradeCost=trainerUpgradeCost,e.previousPopulation=previousPopulation,e.previousEconomyMod=previousEconomyMod,e.previousIncome=previousIncome,e.previousExpenditure=previousExpenditure,e.previousNetIncome=previousNetIncome,e.previousCoins=previousCoins,e.startingGoldIncrease=startingGoldIncrease,e.startingPopIncrease=startingPopIncrease,e.deptEffectIncrease=deptEffectIncrease,e.beamUnlockShown=beamUnlockShown,e.manaRefillUnlockShown=manaRefillUnlockShown,e.weaponsmithAdTimer=weaponsmithAdTimer,e.armourerAdTimer=armourerAdTimer,e.enchanterAdTimer=enchanterAdTimer,e.trainerAdTimer=trainerAdTimer,e.baddieAdjuster=baddieAdjuster,e.baddieDamageAdjuster=baddieDamageAdjuster,e.baddieHpAdjuster=baddieHpAdjuster,e.baddieXpAdjuster=baddieXpAdjuster,e.baddieSpeedAdjuster=baddieSpeedAdjuster,localStorage.setItem("save",JSON.stringify(e))},restart:function(){this.assistantChange(),bossZombieKilled=!1,bossTreeBeastKilled=!1,bossSkeletonKilled=!1,bossZombieBirdKilled=!1,bossMummyKilled=!1,bossFinalKilled=!1,coins=1500+startingGoldIncrease,stageMilestone=100*Math.floor(bestStage/100),stage=stageMilestone+Math.floor((bestStage-stageMilestone)/4),bestStage=0,year=0,population=100+startingPopIncrease,happiness=44,popScore=0,housing=25+deptEffectIncrease/10,commercial=25+deptEffectIncrease/10,industrial=25+deptEffectIncrease/10,education=25+deptEffectIncrease/10,popHealth=25+deptEffectIncrease/10,justice=25+deptEffectIncrease/10,defence=25+deptEffectIncrease/10,utilities=25+deptEffectIncrease/10,weaponsmith=25+deptEffectIncrease/10,armourer=25+deptEffectIncrease/10,enchanter=25+deptEffectIncrease/10,trainer=25+deptEffectIncrease/10,tax=40,income=0,expenditure=0,defending=!0,defenceChance=0,housingFunding=40,commercialFunding=40,industrialFunding=40,educationFunding=40,healthFunding=40,justiceFunding=40,defenceFunding=40,utilitiesFunding=40,weaponsmithFunding=40,armourerFunding=40,enchanterFunding=40,trainerFunding=40,averageFunding=40,attackStrength=8,weaponsmithUpgradeCost=200,armourerUpgradeCost=200,enchanterUpgradeCost=200,trainerUpgradeCost=200,questHappinessModifier=0,questsUndertaken=0,nextLevelXp=Math.floor(nextLevelXp*(1-xpReduction/100)),weaponsmithDropReward+=artisanIncrease,armourerDropReward+=artisanIncrease,enchanterDropReward+=artisanIncrease,trainerDropReward+=artisanIncrease,marriageOptions=!1,pauseUpdate=!1,cityMusic.destroy(),game.world.removeAll(),game.state.start("reset")},marriageOptionsPrompter:function(){assistant="marriage",marriageOptionsPromptButton=game.add.button(10,50,"blankButton",this.marriageOptionsChoose,this),marriageOptionsPromptText=game.add.bitmapText(50,75,"font","View Alliance Offers",16)},marriageOptionsChoose:function(){marriageOptionsBackground=game.add.sprite(96,150,"scrollStrip"),marriageOptionsText1=game.add.bitmapText(300,160,"font","Choose an Alliance?",24),marriageOptionsText2=game.add.bitmapText(220,190,"font","Your city, gold and stage progress will be reset,",18),marriageOptionsText3=game.add.bitmapText(220,215,"font","    but you will be rewarded very generously.",18),marriageOptionsDisplayButton=game.add.button(190,250,"blankButton",this.marriageOptions,this),marriageOptionsDisplayText=game.add.bitmapText(280,280,"font","Yes",16),marriageOptionsHideButton=game.add.button(410,250,"blankButton",this.marriageOptionsHide,this),marriageOptionsHideText=game.add.bitmapText(480,280,"font","No, not yet",16)},marriageOptionsHide:function(){marriageOptionsBackground.kill(),marriageOptionsText1.text="",marriageOptionsText2.text="",marriageOptionsText3.text="",marriageOptionsDisplayButton.kill(),marriageOptionsDisplayText.text="",marriageOptionsHideButton.kill(),marriageOptionsHideText.text=""},marriageOptions:function(){this.marriageOptionsHide(),pauseUpdate=!0,boy.kill(),girl.kill();var e=[" Princess Elsbeth","Princess Anastasia"," Princess Matthe","  Princess Susan","   Princess Bob","Princess Esmerelda","  Princess Leia"," Princess Victoria","Princess Alexandra","Princess Emmeline","Princess Christabel","Princess Buttercup","Princess Cassandra"," Princess Correen"],t=["   Of Dunnovia"," Of Somethingia","  Of Madeupistan","Of Nextdoorbutone","  Of Farfaraway","Of The Silly Isles","    Of Belgium"];game.add.button(48,150,"ui_213x255",this.choiceOne,this);var a=e[Math.floor(13.99*Math.random())];game.add.bitmapText(96,162,"font",a,14);var n=t[Math.floor(6.99*Math.random())];game.add.bitmapText(100,180,"font",n,14);var i=game.add.sprite(125,200,"princesses");i.frame=Math.floor(23.99*Math.random()),xpReduction1=Math.round(20*Math.random())+20,startingPopIncrease1=Math.floor(6*Math.random())-3,startingGoldIncrease1=Math.round(150*Math.random())-50,artisanIncrease1=Math.floor(3*Math.random())-1,deptEffectIncrease1=Math.round(10*Math.random())-5,startingPopIncrease1<0&&(startingPopIncrease1=0),startingGoldIncrease1<0&&(startingGoldIncrease1=0),artisanIncrease1<0&&(artisanIncrease1=0),deptEffectIncrease1<0&&(deptEffectIncrease1=0),game.add.bitmapText(110,280,"font","Alliance Dowry: ",14),game.add.bitmapText(60,300,"font","Level Up XP Reduction: "+xpReduction1+"%",14),game.add.bitmapText(60,315,"font","Starting Population: + "+startingPopIncrease1,14),game.add.bitmapText(60,330,"font","Starting Gold: + "+startingGoldIncrease1,14),game.add.bitmapText(60,345,"font","Artisan Effectiveness: + "+artisanIncrease1,14),game.add.bitmapText(60,360,"font","Starting Govt Dept Level: + "+deptEffectIncrease1,14),game.add.button(309,150,"ui_213x255",this.choiceTwo,this);var s=e[Math.floor(13.99*Math.random())];game.add.bitmapText(347,162,"font",s,14);var r=t[Math.floor(6.99*Math.random())];game.add.bitmapText(351,180,"font",r,14);var o=game.add.sprite(386,200,"princesses");o.frame=Math.floor(23.99*Math.random()),xpReduction2=Math.round(20*Math.random())+20,startingPopIncrease2=Math.floor(6*Math.random())-3,startingGoldIncrease2=Math.round(300*Math.random())-100,artisanIncrease2=Math.floor(3*Math.random())-1,deptEffectIncrease2=Math.round(10*Math.random())-5,startingPopIncrease2<0&&(startingPopIncrease2=0),startingGoldIncrease2<0&&(startingGoldIncrease2=0),artisanIncrease2<0&&(artisanIncrease2=0),deptEffectIncrease2<0&&(deptEffectIncrease2=0),game.add.bitmapText(371,280,"font","Alliance Dowry: ",14),game.add.bitmapText(321,300,"font","Level Up XP Reduction: "+xpReduction2+"%",14),game.add.bitmapText(321,315,"font","Starting Population: + "+startingPopIncrease2,14),game.add.bitmapText(321,330,"font","Starting Gold: + "+startingGoldIncrease2,14),game.add.bitmapText(321,345,"font","Artisan Effectiveness: + "+artisanIncrease2,14),game.add.bitmapText(321,360,"font","Starting Govt Dept Level: + "+deptEffectIncrease2,14),game.add.button(570,150,"ui_213x255",this.choiceThree,this);var d=e[Math.floor(13.99*Math.random())];game.add.bitmapText(608,162,"font",d,14);var p=t[Math.floor(6.99*Math.random())];game.add.bitmapText(612,180,"font",p,14);var c=game.add.sprite(647,200,"princesses");c.frame=Math.floor(23.99*Math.random()),xpReduction3=Math.round(20*Math.random())+20,startingPopIncrease3=Math.floor(9*Math.random())-4,startingGoldIncrease3=Math.round(350*Math.random())-150,artisanIncrease3=Math.floor(3*Math.random())-1,deptEffectIncrease3=Math.round(14*Math.random())-6,startingPopIncrease3<0&&(startingPopIncrease3=0),startingGoldIncrease3<0&&(startingGoldIncrease3=0),artisanIncrease3<0&&(artisanIncrease3=0),deptEffectIncrease3<0&&(deptEffectIncrease3=0),game.add.bitmapText(632,280,"font","Alliance Dowry: ",14),game.add.bitmapText(582,300,"font","Level Up XP Reduction: "+xpReduction3+"%",14),game.add.bitmapText(582,315,"font","Starting Population: + "+startingPopIncrease3,14),game.add.bitmapText(582,330,"font","Starting Gold: + "+startingGoldIncrease3,14),game.add.bitmapText(582,345,"font","Artisan Effectiveness: + "+artisanIncrease3,14),game.add.bitmapText(582,360,"font","Starting Govt Dept Level: + "+deptEffectIncrease3,14)},choiceOne:function(){xpReduction=xpReduction1,startingPopIncrease+=startingPopIncrease1,startingGoldIncrease+=startingGoldIncrease1,artisanIncrease=artisanIncrease1,deptEffectIncrease+=deptEffectIncrease1,this.restart()},choiceTwo:function(){xpReduction=xpReduction2,startingPopIncrease+=startingPopIncrease2,startingGoldIncrease+=startingGoldIncrease2,artisanIncrease=artisanIncrease2,deptEffectIncrease+=deptEffectIncrease2,
this.restart()},choiceThree:function(){xpReduction=xpReduction3,startingPopIncrease+=startingPopIncrease3,startingGoldIncrease+=startingGoldIncrease3,artisanIncrease=artisanIncrease3,deptEffectIncrease+=deptEffectIncrease3,this.restart()},warriorWomanAdvice:function(){var e=Math.floor(9.99*Math.random());switch(e){case 0:warriorWoman1.speech1.text="   Opening",warriorWoman1.speech2.text=" chests while questing",warriorWoman1.speech3.text="   gives gold and artisan ",warriorWoman1.speech4.text=" materials but also a small",warriorWoman1.speech5.text="  mana boost. Use it",warriorWoman1.speech6.text="     wisely.";break;case 1:warriorWoman1.speech1.text="       Mana",warriorWoman1.speech2.text="  recharges much faster",warriorWoman1.speech3.text="      while standing still,",warriorWoman1.speech4.text="    and even faster when",warriorWoman1.speech5.text="   a stage is cleared of",warriorWoman1.speech6.text="   enemies.";break;case 2:warriorWoman1.speech1.text="      Your",warriorWoman1.speech2.text="  level and any Artisan",warriorWoman1.speech3.text="  bonuses will pass to your",warriorWoman1.speech4.text="  children, should you have",warriorWoman1.speech5.text="             any.",warriorWoman1.speech6.text="";break;case 3:warriorWoman1.speech1.text="     If your",warriorWoman1.speech2.text=" approval rating reaches ",warriorWoman1.speech3.text="   at least 95, neighbouring",warriorWoman1.speech4.text="   kingdoms may offer you ",warriorWoman1.speech5.text="         an alliance.",warriorWoman1.speech6.text="";break;case 4:warriorWoman1.speech1.text="   Alliances",warriorWoman1.speech2.text="  with neighbours are ",warriorWoman1.speech3.text="  often sealed by marriage.",warriorWoman1.speech4.text="   The dowries can be very",warriorWoman1.speech5.text="          generous.",warriorWoman1.speech6.text="";break;case 5:warriorWoman1.speech1.text="     Special",warriorWoman1.speech2.text="    materials found in ",warriorWoman1.speech3.text="    chests can boost your",warriorWoman1.speech4.text="   artisans' skill level and",warriorWoman1.speech5.text="  increase the power of",warriorWoman1.speech6.text="   their perks.";break;case 6:warriorWoman1.speech1.text="   Taxes can ",warriorWoman1.speech2.text=" fund services and help ",warriorWoman1.speech3.text=" your kingdom grow. But if ",warriorWoman1.speech4.text=" they are too high they may ",warriorWoman1.speech5.text="    drive people away.",warriorWoman1.speech6.text="";break;case 7:warriorWoman1.speech1.text="   The years ",warriorWoman1.speech2.text="      still pass in the ",warriorWoman1.speech3.text="    city while you are out ",warriorWoman1.speech4.text="      questing, but at a ",warriorWoman1.speech5.text="        slower rate.",warriorWoman1.speech6.text="";break;case 8:warriorWoman1.speech1.text="  Your artisans ",warriorWoman1.speech2.text="can add potent perks to",warriorWoman1.speech3.text="weapons and armour as the",warriorWoman1.speech4.text=" city grows. Higher funding",warriorWoman1.speech5.text="  and better materials",warriorWoman1.speech6.text="   will help.";break;case 9:warriorWoman1.speech1.text=" Reward chests ",warriorWoman1.speech2.text="come in different colours.",warriorWoman1.speech3.text=" Red chests give least, blue ",warriorWoman1.speech4.text="  then green give more. A",warriorWoman1.speech5.text="  yellow chest contains",warriorWoman1.speech6.text="   the most."}},shopClosed:function(){var e=game.add.sprite(310,245,"ui_213x150"),t=game.add.bitmapText(313,265,"font","CLOSED",50),a=game.add.bitmapText(350,325,"font","Due to lack",26),n=game.add.bitmapText(360,355,"font"," of funds",26);game.time.events.add(3*Phaser.Timer.SECOND,function(){e.destroy(),t.destroy(),a.destroy(),n.destroy()})}};